<?xml version="1.0"?>
<ESBMessagePipelineStorage xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <Id>3a4425e7-850d-4e3c-a99d-ca32d65d4461</Id>
  <Version>983a5b0b-c00d-4514-aa28-843b5ab36a72</Version>
  <BusinessFlows />
  <Description />
  <Name>Process_GetLocalServiceURI - New</Name>
  <IsSystemObject>false</IsSystemObject>
  <IsPrivate>false</IsPrivate>
  <Category>General</Category>
  <IsEncrypted>true</IsEncrypted>
  <Path>New Data Enhancement Functions</Path>
  <PipelineBlob>&lt;ESBMessagePipeline xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://schemas.neuronesb.com/pipelines/"&gt;&lt;Category&gt;General&lt;/Category&gt;&lt;Description i:nil="true" /&gt;&lt;GlobalProperties xmlns:d2p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Name&gt;Process_GetLocalServiceURI - New&lt;/Name&gt;&lt;Properties xmlns:d2p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;ReferencedAssemblies xmlns:d2p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" i:nil="true" /&gt;&lt;Steps&gt;&lt;ESBMessagePipelineStep i:type="ExceptionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d4p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;13469a39-da23-4af8-8465-27c1314a1407&lt;/Id&gt;&lt;Name&gt;Exception&lt;/Name&gt;&lt;Uniquename&gt;2247bf33-6d44-4df2-b2ce-1daf7f7faacc&lt;/Uniquename&gt;&lt;Catch&gt;&lt;Bindings xmlns:d5p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;f86d2726-3c95-49a1-93b4-9100a5c49b6e&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;d4785404-88f5-4408-a6c5-ef0c455c780c&lt;/Id&gt;&lt;Name&gt;Exception Catch&lt;/Name&gt;&lt;Uniquename&gt;0b06fe0d-105d-4fba-8001-469327f8d059&lt;/Uniquename&gt;&lt;BreakPointLines xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;	PipelineException parentEx = (PipelineException)context.Properties["PipelineException"];

	string newExceptionMessag = String.Format(System.Globalization.CultureInfo.InvariantCulture,
	            "Pipeline Error - Type: {0} Message: {1} \r\nSource Pipeline: {2}\r\nSource Pipeline Step: {3}\r\nSource Error Message: {4}",
	                                    	parentEx.InnerException.GetType().ToString(),
											parentEx.Message,
	                                        parentEx.Pipeline, 
	                                        parentEx.PipelineStep, 
	                                        (parentEx.InnerException != null ? parentEx.InnerException.Message : ""));
	
	context.Instance.TraceInformation(newExceptionMessag);

	&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d7p1:string&gt;Neuron&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Pipelines&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Esb&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d7p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typec181a9d4b224c7289e7791a0b89f38&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="RethrowPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;673a1625-e3e6-4043-9e44-8ca6d0cc9b07&lt;/Id&gt;&lt;Name&gt;Rethrow&lt;/Name&gt;&lt;Uniquename&gt;f998da7f-15bd-4ddb-8b69-b04acd9dc7b9&lt;/Uniquename&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Catch&gt;&lt;Finally&gt;&lt;Bindings xmlns:d5p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;c54cf413-8204-4e2a-a5d6-2ccc43103919&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children /&gt;&lt;/Finally&gt;&lt;Try&gt;&lt;Bindings xmlns:d5p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;d41bdcb8-03b5-4c52-9e9c-21c162d4ce22&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;3f6988ae-4a41-40be-b14b-cd75cc40ad26&lt;/Id&gt;&lt;Name&gt;Title Trace&lt;/Name&gt;&lt;Uniquename&gt;2936f8cc-0b15-4ca5-8d40-ac58398a2eb4&lt;/Uniquename&gt;&lt;BreakPointLines xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// This process is a sub process and is expected to be called from one or more parent processes.  It interacts with the Neo PLM Global
// Integration Service, for the purpose of:
// 	  1) Determining if the Source System ID and Plant Code ID, provided on the message, can be resolved to a facility, known to Neo PLM.
//		2) Enhancing the incoming message with the Neo PLM facility context, for use in downstream processing.

// This process with accept an XML message in the form of 
// &amp;lt;FacilityLookup&amp;gt;
// 		&amp;lt;SourceSystemID&amp;gt;Europe2&amp;lt;/SourceSystemID&amp;gt;
//		&amp;lt;PlantID&amp;gt;BEP7&amp;lt;/PlantID&amp;gt;
// &amp;lt;/FacilityLookup&amp;gt;

// It will return an XML message in the form of 
// &amp;lt;Facility&amp;gt;
//			&amp;lt;UID&amp;gt;12345678-1234-1234-1234-123456789012&amp;lt;/UID&amp;gt;
// &amp;lt;/Facility&amp;gt;

// In the event of a messaging failure between Neuron ESB and Neo PLM Global Integration service, an exception will be generated by this 
// Sub Process.  It will be assumed that this type of exception will be handled by the parent (calling) process.

// There are two optional arguments that may be supplied as message properties, attached to the incoming message to this sub process.
//     1) EmptyGuidIsValid - A property that contains either the string "True" or "False".  If the referenced property exists, and is 
//        set to True, then returned value may contain an Empty Guid.  Otherwise, a failed lookup will result in a business exception on 
//				the message, and as such will result in a business notification to interested users.  
//		 2) InputMessageItem - A property that contains the original business Input Message Item, such as a material definition, a material lot,
//        etc. from which the look up data was extracted.  This information is used to create a meaningful error message, to be returned
//				to a business user.

context.Instance.TraceInformation ("   *****************************************");
context.Instance.TraceInformation ("   Get Local Service URI - Message ID: " + context.Data.Header.MessageId.ToString());
context.Instance.TraceInformation ("");
context.Instance.TraceInformation ("  Get Local Service URI - Message ID: " + context.Data.Header.MessageId.ToString() + " Input Message: " + context.Data.Text);&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d7p1:string&gt;Neuron&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Pipelines&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Esb&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typeaab60b377a04e118aae4aa7c56a7cd&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageSchemaValidationPipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;5f908fb1-60b7-4f12-8ee1-6294157cd0ae&lt;/Id&gt;&lt;Name&gt;Validation Message Schema&lt;/Name&gt;&lt;Uniquename&gt;d67f4639-004c-4324-9b4c-41b13c418bbb&lt;/Uniquename&gt;&lt;OnInvalid&gt;&lt;Bindings xmlns:d8p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;38ea2a9c-fb78-487d-a541-77822a96a028&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="RethrowPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d10p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;8c5ac698-4506-4fd0-8745-5f4eefcdb364&lt;/Id&gt;&lt;Name&gt;Rethrow the Schema Validation Error&lt;/Name&gt;&lt;Uniquename&gt;c0acaf04-d7c5-42bb-a303-40eaf35bae62&lt;/Uniquename&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/OnInvalid&gt;&lt;OnValid&gt;&lt;Bindings xmlns:d8p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;f78058b7-c493-43e7-acf4-fc0fa59c14da&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="DecisionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d10p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;e329d946-67fb-484d-8c01-0c30dde7312d&lt;/Id&gt;&lt;Name&gt;Expected Message?&lt;/Name&gt;&lt;Uniquename&gt;92f9acb1-bc36-4d13-91de-2d27103dec71&lt;/Uniquename&gt;&lt;Branches&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="CodeBranchConditionOfESBMessagexAPWb1W4"&gt;&lt;Code&gt;System.Xml.XmlDocument xDoc = context.Data.ToXmlDocument();

string messageType = xDoc.DocumentElement.LocalName;

if (messageType == "LocalServiceURIRequest")
	return true;
else
	return false;
&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d13p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d13p1:string&gt;Neuron&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Neuron.Pipelines&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Neuron.Esb&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d13p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Expected Message Type&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d13p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;79134b31-cab7-48cf-8213-5b12f39cd3b2&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="d6p1:JsonXmlProcessStep"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;e45f9a6f-3220-4e75-848d-ad1e5161d349&lt;/Id&gt;&lt;Name&gt;JsonXmlProcessStep&lt;/Name&gt;&lt;Uniquename&gt;deed57f2-448f-4574-b745-d63704a7a4a5&lt;/Uniquename&gt;&lt;d6p1:ConversionTo&gt;JSON&lt;/d6p1:ConversionTo&gt;&lt;d6p1:DateTimeConvertFormat&gt;yyyy-MM-ddTHH:mm:ss.fffffffzzz&lt;/d6p1:DateTimeConvertFormat&gt;&lt;d6p1:ExcludeXmlRoot&gt;true&lt;/d6p1:ExcludeXmlRoot&gt;&lt;d6p1:IncludeObjectTypes&gt;false&lt;/d6p1:IncludeObjectTypes&gt;&lt;d6p1:IncludeXmlDeclaration&gt;true&lt;/d6p1:IncludeXmlDeclaration&gt;&lt;d6p1:RemoveXmlNamespaces&gt;true&lt;/d6p1:RemoveXmlNamespaces&gt;&lt;d6p1:Root i:nil="true" /&gt;&lt;d6p1:TreatNullHandling&gt;None&lt;/d6p1:TreatNullHandling&gt;&lt;d6p1:TypeName i:nil="true" /&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;fa90408b-83f4-4758-9235-a75427ed4ca5&lt;/Id&gt;&lt;Name&gt;Setup Facility Request&lt;/Name&gt;&lt;Uniquename&gt;5658a2ac-6749-4cc2-94de-020ea6213c25&lt;/Uniquename&gt;&lt;BreakPointLines xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;
Newtonsoft.Json.Linq.JObject inputMessage = context.Data.ToJObject();

var localURI = inputMessage.ToObject &amp;lt;dynamic&amp;gt; ();

context.Instance.TraceInformation("   Get Local Service URI - Message ID: " + context.Data.Header.MessageId.ToString() + " NeoPLM Facility UID: " + localURI.NeoPLMFacilityUID);

//Save Original Message Context 
if (context.Properties.ContainsKey("LocalServiceURIInput"))
{
	context.Properties.Remove ("LocalServiceURIInput");
	context.Properties.Add ("LocalServiceURIInput", context.Data.Clone(true));
}
else
{
	context.Properties.Add ("LocalServiceURIInput", context.Data.Clone(true));
}

// Setup Communication Retry Properties
context.Data.SetProperty ("Neo", "CommSuccess", "false");
context.Data.SetProperty ("Neo", "RetryCount", "0");&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d15p1:string&gt;Neuron&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Pipelines&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Esb&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typea37db829afc4c968cf801137229c84&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="RestPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;552aa864-257c-4f69-92b9-23b2694e83ff&lt;/Id&gt;&lt;Name&gt;Setup Rest Call Context&lt;/Name&gt;&lt;Uniquename&gt;ddda9d2f-1e42-4a32-a36f-05839004466d&lt;/Uniquename&gt;&lt;SerializableCurrentRestRequest&gt;&amp;lt;?xml version="1.0" encoding="utf-16"?&amp;gt;&amp;lt;RestRequest xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&amp;gt;&amp;lt;Method&amp;gt;GET&amp;lt;/Method&amp;gt;&amp;lt;URI&amp;gt;IntegrationDirectory/GetLocalIntegrationDataServiceUri&amp;lt;/URI&amp;gt;&amp;lt;Body /&amp;gt;&amp;lt;BodyType&amp;gt;Raw&amp;lt;/BodyType&amp;gt;&amp;lt;BodyFormat&amp;gt;XML&amp;lt;/BodyFormat&amp;gt;&amp;lt;DeleteMessageBody&amp;gt;true&amp;lt;/DeleteMessageBody&amp;gt;&amp;lt;DeleteResponseBody&amp;gt;false&amp;lt;/DeleteResponseBody&amp;gt;&amp;lt;Parameters&amp;gt;&amp;lt;ParameterDataElement&amp;gt;&amp;lt;Key&amp;gt;facilityUid&amp;lt;/Key&amp;gt;&amp;lt;Value&amp;gt;{#JObject.NeoPLMFacilityUID}&amp;lt;/Value&amp;gt;&amp;lt;/ParameterDataElement&amp;gt;&amp;lt;/Parameters&amp;gt;&amp;lt;Headers&amp;gt;&amp;lt;HeaderDataElement&amp;gt;&amp;lt;Key&amp;gt;Accept&amp;lt;/Key&amp;gt;&amp;lt;Value&amp;gt;application/xml&amp;lt;/Value&amp;gt;&amp;lt;/HeaderDataElement&amp;gt;&amp;lt;/Headers&amp;gt;&amp;lt;AdapterEndpointProperties /&amp;gt;&amp;lt;BodyProperties&amp;gt;&amp;lt;BodyDataElement&amp;gt;&amp;lt;Key&amp;gt;sourceSystemID&amp;lt;/Key&amp;gt;&amp;lt;Value&amp;gt;{#JObject.SourceSystemID}&amp;lt;/Value&amp;gt;&amp;lt;/BodyDataElement&amp;gt;&amp;lt;BodyDataElement&amp;gt;&amp;lt;Key&amp;gt;plantID&amp;lt;/Key&amp;gt;&amp;lt;Value&amp;gt;{#JObject.PlantID}&amp;lt;/Value&amp;gt;&amp;lt;/BodyDataElement&amp;gt;&amp;lt;/BodyProperties&amp;gt;&amp;lt;TestEnabled&amp;gt;FALSE&amp;lt;/TestEnabled&amp;gt;&amp;lt;TestFormat&amp;gt;TEXT&amp;lt;/TestFormat&amp;gt;&amp;lt;MaxPoolSize&amp;gt;1&amp;lt;/MaxPoolSize&amp;gt;&amp;lt;PoolTimeOut&amp;gt;1000&amp;lt;/PoolTimeOut&amp;gt;&amp;lt;AuditRequest&amp;gt;false&amp;lt;/AuditRequest&amp;gt;&amp;lt;AuditResponses&amp;gt;false&amp;lt;/AuditResponses&amp;gt;&amp;lt;AuditFailures&amp;gt;false&amp;lt;/AuditFailures&amp;gt;&amp;lt;/RestRequest&amp;gt;&lt;/SerializableCurrentRestRequest&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="WhilePipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;e0647e48-30bb-448b-825d-4334c1d60486&lt;/Id&gt;&lt;Name&gt;While Comm Failed&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="ExceptionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d17p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;4ad4d362-e2ed-420c-8cf4-e307164aad0b&lt;/Id&gt;&lt;Name&gt;Exception&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Catch&gt;&lt;Bindings xmlns:d18p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;96e4361b-320d-4a10-bb50-8ca6018ff7e1&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="DecisionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;be9c9903-d4fc-4476-b302-e9ab1b5e40ee&lt;/Id&gt;&lt;Name&gt;Retry Count&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Branches&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="CodeBranchConditionOfESBMessagexAPWb1W4"&gt;&lt;Code&gt;int count = System.Convert.ToInt32 (context.Data.GetProperty ("Neo", "RetryCount"));
int numRetries = System.Convert.ToInt32 (context.EnvironmentVariables["NeoServicesNumberofRetries"]);

if (count &amp;lt; numRetries)
{	
	// Increment counter
	count = count + 1;
	context.Data.SetProperty ("Neo", "RetryCount", count.ToString());
	context.Instance.TraceInformation ("Communication Failed.  Start of Retry Cycle " + count);
	
	return true;
}
else
{
	context.Instance.TraceInformation ("Communication Failed.  Retries Exhausted.  Rethrow Exception");
	return false;
}&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d23p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d23p1:string&gt;Neuron&lt;/d23p1:string&gt;&lt;d23p1:string&gt;Neuron.Pipelines&lt;/d23p1:string&gt;&lt;d23p1:string&gt;Neuron.Esb&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d23p1:string&gt;&lt;d23p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d23p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;If&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d23p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;8b9fa6cf-db7e-4d9f-a2c6-2bd88eac1d57&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d25p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;4cf9b104-a854-45ea-b16c-07afe633952e&lt;/Id&gt;&lt;Name&gt;Wait Time and Retry&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d25p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;int timeoutValue = System.Convert.ToInt32 (context.EnvironmentVariables["NeoServicesRetryInterval"]) * 1000;

System.Threading.Thread.Sleep (timeoutValue);

context.Instance.TraceInformation ("Communications Failure with Neo PLM.  Retrying....");&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d25p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d25p1:string&gt;Neuron&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Neuron.Pipelines&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Neuron.Esb&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d25p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typecde6b061d0f411596a785fde1d8e73&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="AlwaysBranchConditionOfESBMessagexAPWb1W4" /&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Else&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d23p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;8ae63085-8c44-4b20-88d4-c74bd0f64d83&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="RethrowPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d25p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;319e9c92-2802-40e1-ae7a-26b132886c28&lt;/Id&gt;&lt;Name&gt;Rethrow&lt;/Name&gt;&lt;Uniquename /&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;/Branches&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Catch&gt;&lt;Finally&gt;&lt;Bindings xmlns:d18p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;e465e1af-fe06-40c4-b952-dad681bb5ee2&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children /&gt;&lt;/Finally&gt;&lt;Try&gt;&lt;Bindings xmlns:d18p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;0a7c05db-8590-472a-b14a-0cfa1f2375bc&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageServiceEndpointPipelineStep"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;64be31a1-f45d-4074-9cbd-7ff55e021e6f&lt;/Id&gt;&lt;Name&gt;Get Local Service URI Endpoint&lt;/Name&gt;&lt;Uniquename&gt;efd5253d-954e-46ae-bd07-a34fc30b9073&lt;/Uniquename&gt;&lt;d6p1:Category&gt;General&lt;/d6p1:Category&gt;&lt;d6p1:Description&gt;This service serves as a proxy for the external service that is provided by Neo PLM, Inc.  It is here for ease of configuration only.  Nothing is ever processed by this item.&lt;/d6p1:Description&gt;&lt;d6p1:MaxServiceInstances&gt;100&lt;/d6p1:MaxServiceInstances&gt;&lt;d6p1:MessagePattern&gt;Request-Reply&lt;/d6p1:MessagePattern&gt;&lt;d6p1:Policy&gt;Service Proxy Policy&lt;/d6p1:Policy&gt;&lt;d6p1:ServiceBinding&gt;REST&lt;/d6p1:ServiceBinding&gt;&lt;d6p1:ServiceConnector&gt;NeoPLM Global Integration Service - Rest Transaction Proxy&lt;/d6p1:ServiceConnector&gt;&lt;d6p1:ServiceId&gt;9411f3f1-3ad4-4801-a45d-85c0e34bb1c1&lt;/d6p1:ServiceId&gt;&lt;d6p1:ServicePoolTimeout&gt;PT1M&lt;/d6p1:ServicePoolTimeout&gt;&lt;d6p1:ServiceUrl&gt;http://build.neoplm.com/&lt;/d6p1:ServiceUrl&gt;&lt;d6p1:ThrowExceptionOnFault&gt;true&lt;/d6p1:ThrowExceptionOnFault&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;1ac85ff0-4429-4bd5-b038-0f6a1eb508a3&lt;/Id&gt;&lt;Name&gt;Set Comm Successful&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d20p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Set Communication Success
context.Data.SetProperty ("Neo", "CommSuccess", "true");

context.Instance.TraceInformation ("Communication Success.");
&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d20p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d20p1:string&gt;Neuron&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Neuron.Pipelines&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Neuron.Esb&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d20p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typed86a6fa43014865a8da4028bd205e3&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Try&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;Condition&gt;&lt;Code&gt;//if (context.Data.GetProperty("Neo", "CommSuccess") == "false")
//	return true;
//else
//	return false;
return context.Data.GetProperty("Neo", "CommSuccess") != "true";&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d16p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d16p1:string&gt;Neuron&lt;/d16p1:string&gt;&lt;d16p1:string&gt;Neuron.Pipelines&lt;/d16p1:string&gt;&lt;d16p1:string&gt;Neuron.Esb&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d16p1:string&gt;&lt;d16p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d16p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;TurnOffTrackExecution&gt;false&lt;/TurnOffTrackExecution&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;70f5c6db-4d8c-4e70-8823-10d3a6edbf24&lt;/Id&gt;&lt;Name&gt;Facility Response&lt;/Name&gt;&lt;Uniquename&gt;95faecd4-8754-47b1-99c6-0a12f779a89f&lt;/Uniquename&gt;&lt;BreakPointLines xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Raw response message is in xml format
System.Xml.XmlDocument xDoc = context.Data.ToXmlDocument();
string responseURL;

responseURL = xDoc.DocumentElement.FirstChild.InnerText;

// Restore Input Message	
context.Data = (ESBMessage) context.Properties["LocalServiceURIInput"];	
	
context.Instance.TraceInformation ("Get Local Service URI - Message ID: " + context.Data.Header.MessageId.ToString() + " Local Service URI: " + responseURL);

// Make a dynamic object out of the original message
Newtonsoft.Json.Linq.JObject inputMessage = context.Data.ToJObject();
var localServiceURIRequest = inputMessage.ToObject &amp;lt;dynamic&amp;gt; ();
	
// Retrieve the response template message
string localServiceURIResponseTemplate = context.Configuration.XmlDocs["LocalServiceURIResponse"].Xml;
	
// Create the response message
string localServiceURIResponse = string.Format(localServiceURIResponseTemplate, localServiceURIRequest.TransactionID, localServiceURIRequest.NeoPLMFacilityUID, responseURL);

//Send the trace message to document the response message.
context.Instance.TraceInformation ("Get LocalService URI - Message ID: " + context.Data.Header.MessageId.ToString() + " Response Message: " + localServiceURIResponse);
	
// Set message context to the response message 	
context.Data.Text = localServiceURIResponse;

// Set a message property to control the optional message routing, based on data in the input message.
context.Data.SetProperty ("NeoPLM", "LocalServiceURI", responseURL);
context.Data.SetProperty ("NeoPLM", "OriginalMessage", localServiceURIRequest.OriginalMessage.ToString());
	&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d15p1:string&gt;Neuron&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Pipelines&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Esb&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type2d667d49de04a2aa74cf0506c2b222&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="DecisionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;c9743ee7-8bd4-4b5f-8c9d-c8e73ba7268b&lt;/Id&gt;&lt;Name&gt;Disposition Response Message&lt;/Name&gt;&lt;Uniquename&gt;0938be3e-f88f-4298-9984-ac5dfb16fcb1&lt;/Uniquename&gt;&lt;Branches&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="CodeBranchConditionOfESBMessagexAPWb1W4"&gt;&lt;Code&gt;if (context.Data.GetProperty("NeoPLM", "LocalServiceURI") != "")
{
    context.Data.SetProperty("NeoPLM", "LookupError", "False");
	return true;
}
else
{
	context.Data.SetProperty("NeoPLM", "LookupError", "True");
	return false;
}&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d18p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d18p1:string&gt;Neuron&lt;/d18p1:string&gt;&lt;d18p1:string&gt;Neuron.Pipelines&lt;/d18p1:string&gt;&lt;d18p1:string&gt;Neuron.Esb&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d18p1:string&gt;&lt;d18p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d18p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Lookup Successful&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d18p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;0c57d1e8-0314-40fd-84e1-db02b023ab92&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children /&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="AlwaysBranchConditionOfESBMessagexAPWb1W4" /&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Unable to Resolve&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d18p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;3c69d2f5-4a57-4a99-85c5-9c3dc716a3d6&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="PushContextPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;1547d253-6bd9-4e8a-89d9-7aca3cf07df4&lt;/Id&gt;&lt;Name&gt;PushContext&lt;/Name&gt;&lt;Uniquename /&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="d6p1:JsonXmlProcessStep"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;98f12b46-8a8e-43f0-81f4-ae7b3e8d846d&lt;/Id&gt;&lt;Name&gt;JsonXmlProcessStep&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d6p1:ConversionTo&gt;JSON&lt;/d6p1:ConversionTo&gt;&lt;d6p1:DateTimeConvertFormat&gt;yyyy-MM-ddTHH:mm:ss.fffffffzzz&lt;/d6p1:DateTimeConvertFormat&gt;&lt;d6p1:ExcludeXmlRoot&gt;true&lt;/d6p1:ExcludeXmlRoot&gt;&lt;d6p1:IncludeObjectTypes&gt;false&lt;/d6p1:IncludeObjectTypes&gt;&lt;d6p1:IncludeXmlDeclaration&gt;true&lt;/d6p1:IncludeXmlDeclaration&gt;&lt;d6p1:RemoveXmlNamespaces&gt;true&lt;/d6p1:RemoveXmlNamespaces&gt;&lt;d6p1:Root i:nil="true" /&gt;&lt;d6p1:TreatNullHandling&gt;None&lt;/d6p1:TreatNullHandling&gt;&lt;d6p1:TypeName i:nil="true" /&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;c95799dd-ddfe-4dc6-8015-405cdc7356af&lt;/Id&gt;&lt;Name&gt;Create Error Message&lt;/Name&gt;&lt;Uniquename&gt;1d410ffd-c6b4-4871-9313-b1a12c9d4e91&lt;/Uniquename&gt;&lt;BreakPointLines xmlns:d20p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;context.Instance.TraceInformation ("Get FacilityUID - Message ID: " + context.Data.Header.MessageId.ToString() + " The facility UID could not be resolved.  Send Business Error Message and Stop processing.");

// Make a dynamic object out of the original message
Newtonsoft.Json.Linq.JObject inputMessage = context.Data.ToJObject();
var facilityResponse = inputMessage.ToObject &amp;lt;dynamic&amp;gt; ();

// Get the data together to send the Business Error Message
string endpointAddress = context.Data.Header.Action;
string eSBAction = context.Data.Header.Action;
string eSBTopic = context.Data.Header.Topic;
eSBTopic = eSBTopic.Replace("Enrich_", "") + "-Errors";
string sourceSystemID = facilityResponse.SourceSystemID; 
string plantID = facilityResponse.PlantID;
string transactionID = facilityResponse.TransactionID;
string messageDate = context.Data.Header.Created.ToString("yyyy-MM-ddTHH:mm:ssZ");
string errorCode = "1006";
string errorParameter = "Source System ID: " + facilityResponse.SourceSystemID + ", Plant ID: " + facilityResponse.PlantID;
string errorMessage = "The Neo PLM Local Service URI could not be found based on the Source System ID and the PlantID provided.";
string originalMessage = System.Net.WebUtility.HtmlEncode (context.Data.GetProperty ("NeoPLM", "OriginalMessage"));

// Get the business error template
string errorTemplate = context.Configuration.XmlDocs["ESB Business Error Message"].Xml;

string eSBErrorMessage = string.Format(errorTemplate, endpointAddress, eSBAction, eSBTopic, sourceSystemID, plantID, transactionID, messageDate, errorCode, errorMessage, originalMessage);

//Set Values for Error Properties
context.Properties["ErrorMessage"] = eSBErrorMessage;
context.Properties["ErrorTypeID"] = errorCode;
context.Properties["ErrorParameter"] = errorParameter;

context.Data.Text = eSBErrorMessage;	
&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d20p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d20p1:string&gt;Neuron&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Neuron.Pipelines&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Neuron.Esb&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d20p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typefe031f105404189bcaba2e2f628f34&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessagePublishPipelineStep"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;true&lt;/Disable&gt;&lt;Id&gt;cf9ac116-ce50-4c32-9480-5ab95cbdf907&lt;/Id&gt;&lt;Name&gt;Publish&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d6p1:Semantic&gt;Multicast&lt;/d6p1:Semantic&gt;&lt;d6p1:Timeout&gt;0&lt;/d6p1:Timeout&gt;&lt;d6p1:TopicSelector i:type="d6p1:ESBMessageConstTopicSelector"&gt;&lt;d6p1:Topic&gt;ESBError&lt;/d6p1:Topic&gt;&lt;/d6p1:TopicSelector&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessagePipelineExecutionPipelineStep"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;780f91d7-a2bf-4ab5-8a06-ac4235df662b&lt;/Id&gt;&lt;Name&gt;ODBC Logging&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d6p1:FileName i:nil="true" /&gt;&lt;d6p1:MaxInstances&gt;100&lt;/d6p1:MaxInstances&gt;&lt;d6p1:PipelineName&gt;ODBC Business Error Publisher&lt;/d6p1:PipelineName&gt;&lt;d6p1:PoolTimeout&gt;PT1M&lt;/d6p1:PoolTimeout&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="PopContextPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;3973f51a-3063-4521-9b23-0595b69bfcbb&lt;/Id&gt;&lt;Name&gt;PopContext&lt;/Name&gt;&lt;Uniquename /&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessagePipelineExecutionPipelineStep"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;8e25417d-6eb0-43db-813e-a7c84833537a&lt;/Id&gt;&lt;Name&gt;Set Workflow Error Properties&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d6p1:FileName i:nil="true" /&gt;&lt;d6p1:MaxInstances&gt;100&lt;/d6p1:MaxInstances&gt;&lt;d6p1:PipelineName&gt;SetWorkflowErrorProperties&lt;/d6p1:PipelineName&gt;&lt;d6p1:PoolTimeout&gt;PT1M&lt;/d6p1:PoolTimeout&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;/Branches&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="AlwaysBranchConditionOfESBMessagexAPWb1W4" /&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Else&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d13p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;599e47c5-548f-4cac-ac04-d73313b5484f&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;95cec2bb-479f-4573-a477-0b346a341e0a&lt;/Id&gt;&lt;Name&gt;Invalid Message - Throw Exception&lt;/Name&gt;&lt;Uniquename&gt;1d410ffd-c6b4-4871-9313-b1a12c9d4e91&lt;/Uniquename&gt;&lt;BreakPointLines xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;System.Xml.Schema.XmlSchemaException xMlex= new System.Xml.Schema.XmlSchemaException("   Get FacilityUID - Message ID: " + context.Data.Header.MessageId.ToString() + " - message received did not match expected type of FacilityRequest \n\n.  Message = " + context.Data.Text);

throw xMlex;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d15p1:string&gt;Neuron&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Pipelines&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Esb&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d15p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typefe031f105404189bcaba2e2f628f34&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;/Branches&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/OnValid&gt;&lt;Properties xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Schemas xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;ValidationFlags&gt;ReportValidationWarnings&lt;/ValidationFlags&gt;&lt;d6p1:SchemaLocation i:nil="true" /&gt;&lt;d6p1:SchemaNames&gt;EnterpriseHelper;Guid&lt;/d6p1:SchemaNames&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Try&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Steps&gt;&lt;/ESBMessagePipeline&gt;</PipelineBlob>
  <IsProcessFlow>false</IsProcessFlow>
</ESBMessagePipelineStorage>