<?xml version="1.0"?>
<ESBMessagePipelineStorage xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <Id>bc56ad1f-783d-48e4-b1b9-02c19719ba2a</Id>
  <Version>c486e17b-c7e8-4825-94d7-3c33b4d110de</Version>
  <BusinessFlows />
  <Description />
  <Name>SendPVApproval</Name>
  <IsSystemObject>false</IsSystemObject>
  <IsPrivate>false</IsPrivate>
  <Category>General</Category>
  <IsEncrypted>true</IsEncrypted>
  <Path>New Data Enhancement Functions</Path>
  <PipelineBlob>&lt;ESBMessagePipeline xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://schemas.neuronesb.com/pipelines/"&gt;&lt;Category&gt;General&lt;/Category&gt;&lt;Description i:nil="true" /&gt;&lt;GlobalProperties xmlns:d2p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Name&gt;SendPVApproval&lt;/Name&gt;&lt;Properties xmlns:d2p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;ReferencedAssemblies xmlns:d2p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" i:nil="true" /&gt;&lt;Steps&gt;&lt;ESBMessagePipelineStep i:type="ExceptionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d4p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;1f9dbd00-4b2a-4b96-ab4e-1c9f2be1ec72&lt;/Id&gt;&lt;Name&gt;Exception&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Catch&gt;&lt;Bindings xmlns:d5p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;0025b336-49ca-47e6-a831-0959001fa70c&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;734ee5b6-440a-4965-8a38-6cc87b83bf72&lt;/Id&gt;&lt;Name&gt;Trace Exception&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;PipelineException parentEx = (PipelineException)context.Properties["PipelineException"];

string newExceptionMessag = String.Format(System.Globalization.CultureInfo.InvariantCulture,
	         "Pipeline Error - Type: {0} Message: {1} \r\nSource Pipeline: {2}\r\nSource Pipeline Step: {3}\r\nSource Error Message: {4}",
	                                    	parentEx.InnerException.GetType().ToString(),
											parentEx.Message,
	                                        parentEx.Pipeline, 
	                                        parentEx.PipelineStep, 
	                                        (parentEx.InnerException != null ? parentEx.InnerException.Message : ""));
	
context.Instance.TraceInformation(newExceptionMessag);&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d7p1:string&gt;Neuron&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Pipelines&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Esb&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Newtonsoft.Json, Version=12.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d7p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type37932796d7549439d140f25ff87e8f&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;ff87d3a2-5dec-476d-a281-d0629c6b8d03&lt;/Id&gt;&lt;Name&gt;Trace the Available Information on the Exception&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;PipelineException parentEx = (PipelineException) context.Properties["PipelineException"];

System.Exception baseException = parentEx.GetBaseException();

context.Instance.TraceError ("******************** Message Error ******************************");
context.Instance.TraceError ("Parent Base Exception: " + baseException.ToString());
context.Instance.TraceError ("Parent Base Exception Type: " + baseException.GetType().ToString());
context.Instance.TraceError ("Parent Base Exception Message: " + baseException.Message.ToString());

context.Instance.TraceError ("Parent Line Number: " + parentEx.LineNumber.ToString());
context.Instance.TraceError ("Parent Message: " + parentEx.Message.ToString());
context.Instance.TraceError ("Parent Pipe Line: " + parentEx.Pipeline.ToString());
context.Instance.TraceError ("Parent Pipe Line Step: " + parentEx.PipelineStep.ToString());

if (parentEx.StackTrace != null)
{
	context.Instance.TraceError ("Parent Stack Trace: " + parentEx.StackTrace.ToString());
}

if (parentEx.InnerException != null)
{
	context.Instance.TraceError ("Inner Exception Message: " + parentEx.InnerException.Message.ToString());
}&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d7p1:string&gt;Neuron&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Pipelines&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Esb&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d7p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type704279b027f4124a01e147e3dd82da&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;4cfe0bd3-9f4d-41ac-a351-97cdbba3b096&lt;/Id&gt;&lt;Name&gt;Create System Error&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;PipelineException parentEx = (PipelineException) context.Properties["PipelineException"];

System.Exception baseException = parentEx.GetBaseException();

string errorMessage = "System Error: ";

errorMessage = errorMessage + "\tParent Base Exception: " + baseException.ToString() + "\r\n\r\n";
errorMessage = errorMessage + "\tParent Base Exception Type: " + baseException.GetType().ToString() + "\r\n\r\n";
errorMessage = errorMessage + "\tParent Base Exception Message: " + baseException.Message.ToString() + "\r\n\r\n";

errorMessage = errorMessage + "\tParent Line Number: " + parentEx.LineNumber.ToString() + "\r\n\r\n";
errorMessage = errorMessage + "\tParent Message: " + parentEx.Message.ToString() + "\r\n\r\n";
errorMessage = errorMessage + "\tParent Pipe Line: " + parentEx.Pipeline.ToString() + "\r\n\r\n";
errorMessage = errorMessage + "\tParent Pipe Line Step: " + parentEx.PipelineStep.ToString() + "\r\n\r\n";
errorMessage = errorMessage + "\tParent Stack Trace: " + parentEx.StackTrace.ToString() + "\r\n\r\n";

errorMessage = errorMessage + "\tInner Exception Message: " + parentEx.InnerException.Message.ToString() + "\r\n\r\n";


// Get the data together to send the Business Error Message
string endpointAddress = context.Data.Header.To;
string eSBAction = context.Data.Header.Action;
string eSBTopic = context.Data.Header.Topic;

eSBTopic = "PV_Approval_Send_Process" + "-Errors";
string sourceSystemID = ""; 
string plantID = "";
string transactionID = "";
//string transactionID = "";
string messageDate = context.Data.Header.Created.ToString("yyyy-MM-ddTHH:mm:ssZ");
string errorCode = "1000";
string originalMessage = "";

// Get the business error template
string errorTemplate = context.Configuration.XmlDocs["ESB System Error Message"].Xml;

string eSBErrorMessage = string.Format(errorTemplate, endpointAddress, eSBAction, eSBTopic, sourceSystemID, plantID, transactionID, messageDate, errorCode, errorMessage, originalMessage);

context.Instance.TraceInformation ("System Error: " + eSBErrorMessage);

//Set Values for Error Properties
context.Properties.Add("ErrorDetail", originalMessage);
context.Properties.Add("ErrorMessage", errorMessage);
context.Properties.Add("ErrorTypeID", errorCode);

context.Data.Text = eSBErrorMessage;

context.Data.SetProperty ("NeoPLM", "BaseException", baseException.GetType().ToString());
context.Data.SetProperty ("NeoPLM", "BaseExceptionMessage", baseException.Message.ToString());&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d7p1:string&gt;Neuron&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Pipelines&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Esb&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d7p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type11624a5a2154ce58811e380fbf8048&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;796a3d40-c8ea-45b9-86ca-89cab891faf9&lt;/Id&gt;&lt;Name&gt;Create Email&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;//Newtonsoft.Json.Linq.JObject inputMessage = context.Data.ToJObject();
//var ESBError = inputMessage.ToObject &amp;lt;dynamic&amp;gt; ();

context.Properties["EmailAddressString"] = context.EnvironmentVariables["DefaultAdminEmailAddressString"].ToString();
var emailList = context.Properties["EmailAddressString"].ToString();
var emailSender = context.EnvironmentVariables["SmtpSendAddress"];

//var sourceID = ESBError.EndpointAddress;
//var action = ESBError.ESBAction;
//var creationDate = ESBError.MessageDate;
//var messageID = ESBError.TransactionID;

//var emailSubject = string.Format("A System Error Has Occurred on Neo PLM Integration Endpoint: {0} Method: {1}", sourceID, action);

var emailSubject = "An error has occured in the Neo PLM Integration System. Send Production Version Approval process failed.";

//context.Properties["ErrorDetail"] = context.Properties["PVAS_EmailBody"].ToString();

var emailTemplate = context.Configuration.TextDocs["SchemaValidationTemplate"].Text;
emailTemplate = emailTemplate.Replace("${ErrorMessage}", context.Properties["ErrorMessage"].ToString());
emailTemplate = emailTemplate.Replace("${ErrorDetail}", context.Properties["ErrorDetail"].ToString());

context.Instance.TraceInformation(string.Format("Sending email '{2}' from {0} to {1}",emailSender,emailList,emailSubject));
context.Data.SetProperty("smtp", "To", emailList);
context.Instance.TraceInformation("SMTP TO: " + emailList);
context.Data.SetProperty("smtp", "From", emailSender);
context.Instance.TraceInformation("SMTP FROM: " + emailSender);
context.Data.SetProperty("smtp", "Subject", emailSubject);
context.Instance.TraceInformation("SUBJECT: " + emailSubject);
context.Data.SetProperty("smtp", "Body", emailTemplate);
context.Instance.TraceInformation("BODY: " + emailTemplate);
context.Data.SetProperty("smtp", "BodyAsAttachment", false.ToString());
//context.Data.SetProperty("smtp", "FileName", string.Format("{0}.txt","NeoError"));
context.Data.SetProperty("smtp", "IsBodyHtml", true.ToString());

context.Data.Header.SourceId = "B2MML_ERP_Publisher";
context.Data.Text = context.Properties["ErrorMessage"].ToString();&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d7p1:string&gt;Neuron&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Pipelines&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Esb&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type27803a7f60b4c3991ff5504dd4dfc0&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessagePublishPipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;e4cb79fc-c164-413f-a6cd-eaa1cf9a289e&lt;/Id&gt;&lt;Name&gt;Publish to EmailNotification&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d6p1:Semantic&gt;Multicast&lt;/d6p1:Semantic&gt;&lt;d6p1:Timeout&gt;60&lt;/d6p1:Timeout&gt;&lt;d6p1:TopicSelector i:type="d6p1:ESBMessageConstTopicSelector"&gt;&lt;d6p1:Topic&gt;EmailNotification&lt;/d6p1:Topic&gt;&lt;/d6p1:TopicSelector&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Catch&gt;&lt;Finally&gt;&lt;Bindings xmlns:d5p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;18f954cf-548b-429f-960d-8daf5942040d&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children /&gt;&lt;/Finally&gt;&lt;Try&gt;&lt;Bindings xmlns:d5p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;4366ef1d-d2a2-42dd-b038-383cf9e531a9&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;5eecaa33-360e-468a-9031-de8cef4f1aa4&lt;/Id&gt;&lt;Name&gt;Init Step&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;context.Instance.TraceInformation(" SEND PV CALLED. CONTEXT DATA : " + context.Data.Text);

context.Properties.Add("PVS_OrigMessage", "");
context.Properties.Add("PVS_PlantCodeUID","");
context.Properties.Add("PVS_UID","");
context.Properties.Add("PVAS_PlantId","");
context.Properties.Add("PVASFinalMessage","");
context.Properties.Add("PVAS_PVID", "");
context.Properties.Add("PVAS_PVUID", "");
context.Properties.Add("PVAS_EmailBody","");
context.Properties.Add("PVAS_MaterialID", "");&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d7p1:string&gt;Neuron&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Pipelines&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Esb&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Newtonsoft.Json, Version=12.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d7p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typed8a051498d34e76801152a3f01fe7c&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;eed47c8b-4cfd-4def-bc09-31894d18f19d&lt;/Id&gt;&lt;Name&gt;Map To Local URI&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Retrieve the response template message
string localServiceURIRequestTemplate = context.Configuration.XmlDocs["LocalServiceURIRequest"].Xml;
	
// Create the request message
string localServiceURIRequest = string.Format(localServiceURIRequestTemplate, "dummyTransaction", System.Guid.NewGuid() , "dummyMessage");

//Send the trace message to document the request message.
context.Instance.TraceInformation ("PVAR Validate LocalURI - Message ID: " + context.Data.Header.MessageId.ToString() + " Request Message: " + localServiceURIRequest);
	
// Set message context to the request message 	
context.Data.Text = localServiceURIRequest;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d7p1:string&gt;Neuron&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Pipelines&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Esb&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d7p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type462126ea05c4d04b42064c3255e287&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessagePipelineExecutionPipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;a46cbe5a-0462-4163-86a7-c80e467f6b4b&lt;/Id&gt;&lt;Name&gt;Local URI&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d6p1:FileName i:nil="true" /&gt;&lt;d6p1:MaxInstances&gt;100&lt;/d6p1:MaxInstances&gt;&lt;d6p1:PipelineName&gt;Process_GetLocalServiceURI - New&lt;/d6p1:PipelineName&gt;&lt;d6p1:PoolTimeout&gt;PT1M&lt;/d6p1:PoolTimeout&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;6174dca8-7ce5-4ba3-980b-0222b3678b20&lt;/Id&gt;&lt;Name&gt;Map From Local URI&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;string localServiceURI = context.Data.ToXmlDocument().SelectSingleNode("/*[local-name()='LocalServiceURIResponse' and namespace-uri()='http://NeoPLM.com/EnterpriseIntegration']/*[local-name()='LocalServiceURI' and namespace-uri()='http://NeoPLM.com/EnterpriseIntegration']").InnerText;

context.Properties ["LocalServiceURI"] = localServiceURI;

context.Instance.TraceInformation ("LocalServiceURI in PV SEND : " + context.Properties["LocalServiceURI"]);

context.Data.SetProperty("NeoPLM","LocalServiceURI", context.Properties ["LocalServiceURI"].ToString() + "ERPProductionVersions/getPVIsApprovedList");

// Setup Communication Retry Properties
context.Data.SetProperty("Neo", "CommSuccess", "false");
context.Data.SetProperty("Neo", "RetryCount", "0");&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d7p1:string&gt;Neuron&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Pipelines&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Esb&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d7p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type9b5f9b02d894592bae05ea79ecad56&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="RestPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;8362dd36-e2d2-40d2-8b18-373e0474208f&lt;/Id&gt;&lt;Name&gt;Setup Local API Call&lt;/Name&gt;&lt;Uniquename&gt;ddda9d2f-1e42-4a32-a36f-05839004466d&lt;/Uniquename&gt;&lt;SerializableCurrentRestRequest&gt;&amp;lt;?xml version="1.0" encoding="utf-16"?&amp;gt;&amp;lt;RestRequest xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&amp;gt;&amp;lt;Method&amp;gt;GET&amp;lt;/Method&amp;gt;&amp;lt;URI&amp;gt;{#NeoPLM.LocalServiceURI}&amp;lt;/URI&amp;gt;&amp;lt;Body /&amp;gt;&amp;lt;BodyType&amp;gt;Raw&amp;lt;/BodyType&amp;gt;&amp;lt;BodyFormat&amp;gt;XML&amp;lt;/BodyFormat&amp;gt;&amp;lt;DeleteMessageBody&amp;gt;true&amp;lt;/DeleteMessageBody&amp;gt;&amp;lt;DeleteResponseBody&amp;gt;false&amp;lt;/DeleteResponseBody&amp;gt;&amp;lt;Parameters /&amp;gt;&amp;lt;Headers&amp;gt;&amp;lt;HeaderDataElement&amp;gt;&amp;lt;Key&amp;gt;Accept&amp;lt;/Key&amp;gt;&amp;lt;Value&amp;gt;application/xml&amp;lt;/Value&amp;gt;&amp;lt;/HeaderDataElement&amp;gt;&amp;lt;/Headers&amp;gt;&amp;lt;AdapterEndpointProperties /&amp;gt;&amp;lt;BodyProperties&amp;gt;&amp;lt;BodyDataElement&amp;gt;&amp;lt;Key&amp;gt;sourceSystemID&amp;lt;/Key&amp;gt;&amp;lt;Value&amp;gt;{#JObject.SourceSystemID}&amp;lt;/Value&amp;gt;&amp;lt;/BodyDataElement&amp;gt;&amp;lt;BodyDataElement&amp;gt;&amp;lt;Key&amp;gt;plantID&amp;lt;/Key&amp;gt;&amp;lt;Value&amp;gt;{#JObject.PlantID}&amp;lt;/Value&amp;gt;&amp;lt;/BodyDataElement&amp;gt;&amp;lt;/BodyProperties&amp;gt;&amp;lt;TestEnabled&amp;gt;FALSE&amp;lt;/TestEnabled&amp;gt;&amp;lt;TestFormat&amp;gt;TEXT&amp;lt;/TestFormat&amp;gt;&amp;lt;MaxPoolSize&amp;gt;1&amp;lt;/MaxPoolSize&amp;gt;&amp;lt;PoolTimeOut&amp;gt;1000&amp;lt;/PoolTimeOut&amp;gt;&amp;lt;AuditRequest&amp;gt;false&amp;lt;/AuditRequest&amp;gt;&amp;lt;AuditResponses&amp;gt;false&amp;lt;/AuditResponses&amp;gt;&amp;lt;AuditFailures&amp;gt;false&amp;lt;/AuditFailures&amp;gt;&amp;lt;/RestRequest&amp;gt;&lt;/SerializableCurrentRestRequest&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="WhilePipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;0b3921cb-c4c6-4557-b762-daa1bfeb9db8&lt;/Id&gt;&lt;Name&gt;While Comm Failed&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="ExceptionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d9p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;e0a3a30b-17ca-40a9-88b0-866b1c28289a&lt;/Id&gt;&lt;Name&gt;Exception&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Catch&gt;&lt;Bindings xmlns:d10p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;eee5402b-9468-403e-990a-bddddc552965&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="DecisionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d12p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;6af9e65d-6e78-4516-a6a1-1c109bada0a4&lt;/Id&gt;&lt;Name&gt;Retry Count&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Branches&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="CodeBranchConditionOfESBMessagexAPWb1W4"&gt;&lt;Code&gt;int count = System.Convert.ToInt32 (context.Data.GetProperty ("Neo", "RetryCount"));
int numRetries = System.Convert.ToInt32 (context.EnvironmentVariables["NeoServicesNumberofRetries"]);

if (count &amp;lt; numRetries)
{	
	// Increment counter
	count = count + 1;
	context.Data.SetProperty ("Neo", "RetryCount", count.ToString());
	context.Instance.TraceInformation ("Communication Failed.  Start of Retry Cycle " + count);
	
	return true;
}
else
{
	context.Instance.TraceInformation ("Communication Failed.  Retries Exhausted.  Rethrow Exception");
	return false;
}&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d15p1:string&gt;Neuron&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Pipelines&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Esb&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d15p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;If&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;109499d0-5e13-4301-b4a1-54f36ea9dc42&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d16p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d16p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d17p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;20d33acb-36dc-4376-838d-7c51584fcf7b&lt;/Id&gt;&lt;Name&gt;Wait Time and Retry&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d17p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;int timeoutValue = System.Convert.ToInt32 (context.EnvironmentVariables["NeoServicesRetryInterval"]) * 1000;

System.Threading.Thread.Sleep (timeoutValue);

context.Instance.TraceInformation ("Communications Failure with Neo PLM.  Retrying....");&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d17p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d17p1:string&gt;Neuron&lt;/d17p1:string&gt;&lt;d17p1:string&gt;Neuron.Pipelines&lt;/d17p1:string&gt;&lt;d17p1:string&gt;Neuron.Esb&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d17p1:string&gt;&lt;d17p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d17p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typecde6b061d0f411596a785fde1d8e73&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="AlwaysBranchConditionOfESBMessagexAPWb1W4" /&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Else&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;ca41a44c-e105-4198-aca3-6b90d73fa86f&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="RethrowPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d17p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;0dae4815-b708-4f5d-8d0c-feb452bb4184&lt;/Id&gt;&lt;Name&gt;Rethrow&lt;/Name&gt;&lt;Uniquename /&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;/Branches&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Catch&gt;&lt;Finally&gt;&lt;Bindings xmlns:d10p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;d0eb5c29-89ac-4a81-9318-0657355e0214&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children /&gt;&lt;/Finally&gt;&lt;Try&gt;&lt;Bindings xmlns:d10p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;4d9f367c-9fcc-4d09-a54a-dbb4ac1d82df&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d11p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d11p1:EsbMessageServiceEndpointPipelineStep"&gt;&lt;Bindings xmlns:d12p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;fc7fe0b6-2494-4c2e-b15a-2afb635992f4&lt;/Id&gt;&lt;Name&gt;Get IsApproved Records&lt;/Name&gt;&lt;Uniquename&gt;efd5253d-954e-46ae-bd07-a34fc30b9073&lt;/Uniquename&gt;&lt;d11p1:Category&gt;General&lt;/d11p1:Category&gt;&lt;d11p1:Description&gt;This service serves as a proxy for the external service that is provided by Neo PLM, Inc.  It is here for ease of configuration only.  Nothing is ever processed by this item.&lt;/d11p1:Description&gt;&lt;d11p1:MaxServiceInstances&gt;100&lt;/d11p1:MaxServiceInstances&gt;&lt;d11p1:MessagePattern&gt;Request-Reply&lt;/d11p1:MessagePattern&gt;&lt;d11p1:Policy&gt;Service Proxy Policy&lt;/d11p1:Policy&gt;&lt;d11p1:ServiceBinding&gt;REST&lt;/d11p1:ServiceBinding&gt;&lt;d11p1:ServiceConnector&gt;NeoPLM Local Integration Service - Rest Transaction Proxy&lt;/d11p1:ServiceConnector&gt;&lt;d11p1:ServiceId&gt;afd7e3f1-61d8-432b-aa89-f6df498f1d2a&lt;/d11p1:ServiceId&gt;&lt;d11p1:ServicePoolTimeout&gt;PT1M&lt;/d11p1:ServicePoolTimeout&gt;&lt;d11p1:ServiceUrl&gt;http://BogusServer/&lt;/d11p1:ServiceUrl&gt;&lt;d11p1:ThrowExceptionOnFault&gt;true&lt;/d11p1:ThrowExceptionOnFault&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d11p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d11p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d12p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;e95a1d4f-c4fb-4cca-9efe-55235a78e4c7&lt;/Id&gt;&lt;Name&gt;Set Comm Successful&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d12p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Set Communication Success
context.Data.SetProperty ("Neo", "CommSuccess", "true");

context.Instance.TraceInformation ("Communication Success.");
&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d12p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d12p1:string&gt;Neuron&lt;/d12p1:string&gt;&lt;d12p1:string&gt;Neuron.Pipelines&lt;/d12p1:string&gt;&lt;d12p1:string&gt;Neuron.Esb&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d12p1:string&gt;&lt;d12p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d12p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typed86a6fa43014865a8da4028bd205e3&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Try&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;Condition&gt;&lt;Code&gt;//if (context.Data.GetProperty("Neo", "CommSuccess") == "false")
//	return true;
//else
//	return false;
return context.Data.GetProperty("Neo", "CommSuccess") != "true";&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d8p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d8p1:string&gt;Neuron&lt;/d8p1:string&gt;&lt;d8p1:string&gt;Neuron.Pipelines&lt;/d8p1:string&gt;&lt;d8p1:string&gt;Neuron.Esb&lt;/d8p1:string&gt;&lt;d8p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d8p1:string&gt;&lt;d8p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d8p1:string&gt;&lt;d8p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d8p1:string&gt;&lt;d8p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d8p1:string&gt;&lt;d8p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d8p1:string&gt;&lt;d8p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d8p1:string&gt;&lt;d8p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d8p1:string&gt;&lt;d8p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d8p1:string&gt;&lt;d8p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d8p1:string&gt;&lt;d8p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d8p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;TurnOffTrackExecution&gt;false&lt;/TurnOffTrackExecution&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;9c98e851-8fa0-406d-b838-bfe214f6699a&lt;/Id&gt;&lt;Name&gt;List Response&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;context.Instance.TraceInformation("Response from IsApproved : " + context.Data.Text);

System.Xml.XmlDocument xDoc = context.Data.ToXmlDocument();

string encodedResponseText = xDoc.DocumentElement.FirstChild.InnerText;

string decodedResponseText = System.Net.WebUtility.HtmlDecode (encodedResponseText) ;

context.Instance.TraceInformation( " DECODED RESPONSE : " + decodedResponseText);

context.Properties["PVAS_EmailBody"] = decodedResponseText;

context.Data.Text = decodedResponseText;

context.Instance.TraceInformation("FINAL BEFORE SPLIT " + context.Data.Text);&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d7p1:string&gt;Neuron&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Pipelines&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Esb&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Newtonsoft.Json, Version=12.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d7p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type14319b688cb4f25860c22f90919431&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="SplitterPipelineStepOfESBMessageESBMessageu6r3vdAt"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;09877064-db14-41c2-8507-72ea5e968c45&lt;/Id&gt;&lt;Name&gt;Split and Join&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Aggregator i:type="NullAggregatorOfESBMessageESBMessageu6r3vdAt" /&gt;&lt;Executor i:type="SynchronousSplitExecutorOfESBMessagexAPWb1W4" /&gt;&lt;ForEach&gt;&lt;Bindings xmlns:d8p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;0316fc5b-89d3-44a9-a6c9-3086355f4c54&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d9p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d9p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d10p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;c41fd1e2-22d7-4e62-a1ec-f5b604902ccb&lt;/Id&gt;&lt;Name&gt;Map to Get PV_IDOC&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d10p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;context.Instance.TraceInformation(" PV AFTER SPLIT : " + context.Data.Text);

System.Xml.XmlDocument xDoc = context.Data.ToXmlDocument();

string pvID = xDoc.DocumentElement.FirstChild.InnerText;
context.Properties["PVAS_PVID"] = pvID;

string materialID = xDoc.SelectSingleNode("ProductionVersion/ItemCode").InnerText;
context.Properties["PVAS_MaterialID"] = materialID;

string uid = xDoc.SelectSingleNode("ProductionVersion/UID").InnerText;
context.Properties["PVAS_PVUID"] = uid;

//foreach(System.Xml.XmlNode node in xDoc.ChildNodes) {
//	if(node.Name == "ProductionVersionID") { context.Properties["PVAS_PVID"] = node.InnerText; break; }
//	if(node.Name == "UID") { context.Properties["PVAS_PVUID"] = node.InnerText; break; }
//	if(node.Name == "ItemCode") { context.Properties["PVAS_MaterialID"] = node.InnerText; break; }
//}

context.Instance.TraceInformation("PVAS_PVID : " + context.Properties["PVAS_PVID"]);
context.Instance.TraceInformation("PVAS_PVUID : " + context.Properties["PVAS_PVUID"].ToString());
context.Instance.TraceInformation("PVAS_MaterialID : " + context.Properties["PVAS_MaterialID"].ToString());

// Setup Communication Retry Properties
context.Data.SetProperty("Neo", "CommSuccess", "false");
context.Data.SetProperty("Neo", "RetryCount", "0");&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d10p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d10p1:string&gt;Neuron&lt;/d10p1:string&gt;&lt;d10p1:string&gt;Neuron.Pipelines&lt;/d10p1:string&gt;&lt;d10p1:string&gt;Neuron.Esb&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;Newtonsoft.Json, Version=12.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d10p1:string&gt;&lt;d10p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d10p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type65f2da08a2f4a08bffa3026c9d7ca1&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="RestPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d10p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;8362dd36-e2d2-40d2-8b18-373e0474208f&lt;/Id&gt;&lt;Name&gt;Setup IDOC Req&lt;/Name&gt;&lt;Uniquename&gt;ddda9d2f-1e42-4a32-a36f-05839004466d&lt;/Uniquename&gt;&lt;SerializableCurrentRestRequest&gt;&amp;lt;?xml version="1.0" encoding="utf-16"?&amp;gt;&amp;lt;RestRequest xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&amp;gt;&amp;lt;Method&amp;gt;GET&amp;lt;/Method&amp;gt;&amp;lt;URI&amp;gt;PVARStageIntegrations&amp;lt;/URI&amp;gt;&amp;lt;Body /&amp;gt;&amp;lt;BodyType&amp;gt;Raw&amp;lt;/BodyType&amp;gt;&amp;lt;BodyFormat&amp;gt;XML&amp;lt;/BodyFormat&amp;gt;&amp;lt;DeleteMessageBody&amp;gt;true&amp;lt;/DeleteMessageBody&amp;gt;&amp;lt;DeleteResponseBody&amp;gt;false&amp;lt;/DeleteResponseBody&amp;gt;&amp;lt;Parameters&amp;gt;&amp;lt;ParameterDataElement&amp;gt;&amp;lt;Key&amp;gt;id&amp;lt;/Key&amp;gt;&amp;lt;Value&amp;gt;{#GUID}&amp;lt;/Value&amp;gt;&amp;lt;/ParameterDataElement&amp;gt;&amp;lt;ParameterDataElement&amp;gt;&amp;lt;Key&amp;gt;pvarID&amp;lt;/Key&amp;gt;&amp;lt;Value&amp;gt;{#context(PVAS_PVID)}&amp;lt;/Value&amp;gt;&amp;lt;/ParameterDataElement&amp;gt;&amp;lt;/Parameters&amp;gt;&amp;lt;Headers&amp;gt;&amp;lt;HeaderDataElement&amp;gt;&amp;lt;Key&amp;gt;Accept&amp;lt;/Key&amp;gt;&amp;lt;Value&amp;gt;application/xml&amp;lt;/Value&amp;gt;&amp;lt;/HeaderDataElement&amp;gt;&amp;lt;/Headers&amp;gt;&amp;lt;AdapterEndpointProperties /&amp;gt;&amp;lt;BodyProperties&amp;gt;&amp;lt;BodyDataElement&amp;gt;&amp;lt;Key&amp;gt;sourceSystemID&amp;lt;/Key&amp;gt;&amp;lt;Value&amp;gt;{#JObject.SourceSystemID}&amp;lt;/Value&amp;gt;&amp;lt;/BodyDataElement&amp;gt;&amp;lt;BodyDataElement&amp;gt;&amp;lt;Key&amp;gt;plantID&amp;lt;/Key&amp;gt;&amp;lt;Value&amp;gt;{#JObject.PlantID}&amp;lt;/Value&amp;gt;&amp;lt;/BodyDataElement&amp;gt;&amp;lt;/BodyProperties&amp;gt;&amp;lt;TestEnabled&amp;gt;FALSE&amp;lt;/TestEnabled&amp;gt;&amp;lt;TestFormat&amp;gt;TEXT&amp;lt;/TestFormat&amp;gt;&amp;lt;MaxPoolSize&amp;gt;1&amp;lt;/MaxPoolSize&amp;gt;&amp;lt;PoolTimeOut&amp;gt;1000&amp;lt;/PoolTimeOut&amp;gt;&amp;lt;AuditRequest&amp;gt;false&amp;lt;/AuditRequest&amp;gt;&amp;lt;AuditResponses&amp;gt;false&amp;lt;/AuditResponses&amp;gt;&amp;lt;AuditFailures&amp;gt;false&amp;lt;/AuditFailures&amp;gt;&amp;lt;/RestRequest&amp;gt;&lt;/SerializableCurrentRestRequest&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="WhilePipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d10p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;0b3921cb-c4c6-4557-b762-daa1bfeb9db8&lt;/Id&gt;&lt;Name&gt;While Comm Failed&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="ExceptionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d12p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;e0a3a30b-17ca-40a9-88b0-866b1c28289a&lt;/Id&gt;&lt;Name&gt;Exception&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Catch&gt;&lt;Bindings xmlns:d13p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;eee5402b-9468-403e-990a-bddddc552965&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="DecisionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;6af9e65d-6e78-4516-a6a1-1c109bada0a4&lt;/Id&gt;&lt;Name&gt;Retry Count&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Branches&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="CodeBranchConditionOfESBMessagexAPWb1W4"&gt;&lt;Code&gt;int count = System.Convert.ToInt32 (context.Data.GetProperty ("Neo", "RetryCount"));
int numRetries = System.Convert.ToInt32 (context.EnvironmentVariables["NeoServicesNumberofRetries"]);

if (count &amp;lt; numRetries)
{	
	// Increment counter
	count = count + 1;
	context.Data.SetProperty ("Neo", "RetryCount", count.ToString());
	context.Instance.TraceInformation ("Communication Failed.  Start of Retry Cycle " + count);
	
	return true;
}
else
{
	context.Instance.TraceInformation ("Communication Failed.  Retries Exhausted.  Rethrow Exception");
	return false;
}&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d18p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d18p1:string&gt;Neuron&lt;/d18p1:string&gt;&lt;d18p1:string&gt;Neuron.Pipelines&lt;/d18p1:string&gt;&lt;d18p1:string&gt;Neuron.Esb&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d18p1:string&gt;&lt;d18p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d18p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;If&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d18p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;109499d0-5e13-4301-b4a1-54f36ea9dc42&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d19p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d19p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;20d33acb-36dc-4376-838d-7c51584fcf7b&lt;/Id&gt;&lt;Name&gt;Wait Time and Retry&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d20p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;int timeoutValue = System.Convert.ToInt32 (context.EnvironmentVariables["NeoServicesRetryInterval"]) * 1000;

System.Threading.Thread.Sleep (timeoutValue);

context.Instance.TraceInformation ("Communications Failure with Neo PLM.  Retrying....");&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d20p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d20p1:string&gt;Neuron&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Neuron.Pipelines&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Neuron.Esb&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d20p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typecde6b061d0f411596a785fde1d8e73&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="AlwaysBranchConditionOfESBMessagexAPWb1W4" /&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Else&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d18p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;ca41a44c-e105-4198-aca3-6b90d73fa86f&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="RethrowPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;0dae4815-b708-4f5d-8d0c-feb452bb4184&lt;/Id&gt;&lt;Name&gt;Rethrow&lt;/Name&gt;&lt;Uniquename /&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;/Branches&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Catch&gt;&lt;Finally&gt;&lt;Bindings xmlns:d13p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;d0eb5c29-89ac-4a81-9318-0657355e0214&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children /&gt;&lt;/Finally&gt;&lt;Try&gt;&lt;Bindings xmlns:d13p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;4d9f367c-9fcc-4d09-a54a-dbb4ac1d82df&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d14p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d14p1:EsbMessageServiceEndpointPipelineStep"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;fc7fe0b6-2494-4c2e-b15a-2afb635992f4&lt;/Id&gt;&lt;Name&gt;Get PV_IDOC&lt;/Name&gt;&lt;Uniquename&gt;efd5253d-954e-46ae-bd07-a34fc30b9073&lt;/Uniquename&gt;&lt;d14p1:Category&gt;General&lt;/d14p1:Category&gt;&lt;d14p1:Description&gt;This service serves as a proxy for the external service that is provided by Neo PLM, Inc.  It is here for ease of configuration only.  Nothing is ever processed by this item.&lt;/d14p1:Description&gt;&lt;d14p1:MaxServiceInstances&gt;100&lt;/d14p1:MaxServiceInstances&gt;&lt;d14p1:MessagePattern&gt;Request-Reply&lt;/d14p1:MessagePattern&gt;&lt;d14p1:Policy&gt;Service Proxy Policy&lt;/d14p1:Policy&gt;&lt;d14p1:ServiceBinding&gt;REST&lt;/d14p1:ServiceBinding&gt;&lt;d14p1:ServiceConnector&gt;NeoPLM Global Integration Service - Rest Transaction Proxy&lt;/d14p1:ServiceConnector&gt;&lt;d14p1:ServiceId&gt;9411f3f1-3ad4-4801-a45d-85c0e34bb1c1&lt;/d14p1:ServiceId&gt;&lt;d14p1:ServicePoolTimeout&gt;PT1M&lt;/d14p1:ServicePoolTimeout&gt;&lt;d14p1:ServiceUrl&gt;http://build.neoplm.com/&lt;/d14p1:ServiceUrl&gt;&lt;d14p1:ThrowExceptionOnFault&gt;true&lt;/d14p1:ThrowExceptionOnFault&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d14p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d14p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;e95a1d4f-c4fb-4cca-9efe-55235a78e4c7&lt;/Id&gt;&lt;Name&gt;Set Comm Successful&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Set Communication Success
context.Data.SetProperty ("Neo", "CommSuccess", "true");

context.Instance.TraceInformation ("Communication Success.");
&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d15p1:string&gt;Neuron&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Pipelines&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Esb&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d15p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typed86a6fa43014865a8da4028bd205e3&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Try&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;Condition&gt;&lt;Code&gt;//if (context.Data.GetProperty("Neo", "CommSuccess") == "false")
//	return true;
//else
//	return false;
return context.Data.GetProperty("Neo", "CommSuccess") != "true";&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d11p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d11p1:string&gt;Neuron&lt;/d11p1:string&gt;&lt;d11p1:string&gt;Neuron.Pipelines&lt;/d11p1:string&gt;&lt;d11p1:string&gt;Neuron.Esb&lt;/d11p1:string&gt;&lt;d11p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d11p1:string&gt;&lt;d11p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d11p1:string&gt;&lt;d11p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d11p1:string&gt;&lt;d11p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d11p1:string&gt;&lt;d11p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d11p1:string&gt;&lt;d11p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d11p1:string&gt;&lt;d11p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d11p1:string&gt;&lt;d11p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d11p1:string&gt;&lt;d11p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d11p1:string&gt;&lt;d11p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d11p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;TurnOffTrackExecution&gt;false&lt;/TurnOffTrackExecution&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d9p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d9p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d10p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;cab40687-ebd7-4615-ade9-39c82b76baec&lt;/Id&gt;&lt;Name&gt;IDOC Response&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d10p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;context.Instance.TraceInformation(" IDOC RESPONSE : " + context.Data.Text);

// Set initial Error value to False
context.Data.SetProperty("SendPV", "LookupError", "False");

System.Xml.XmlDocument xDoc = context.Data.ToXmlDocument();

// PV IDOC Not Found
if(xDoc.DocumentElement.FirstChild.InnerText == System.Guid.Empty.ToString()){
	context.Data.SetProperty("SendPV", "LookupError", "True");
}

else if(!String.IsNullOrEmpty(xDoc.DocumentElement.FirstChild.InnerText)){
	
	string encodedResponseText = xDoc.DocumentElement.FirstChild.InnerText;
	
	string decodedIDOC = System.Net.WebUtility.HtmlDecode (encodedResponseText);
	
	System.Xml.XmlDocument xmlIDOC = new System.Xml.XmlDocument();
	
	xmlIDOC.LoadXml(decodedIDOC);
	
	context.Instance.TraceInformation(" ORIG XML : " + xmlIDOC.OuterXml);
	
	string sndpor = "";
	if(xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/SNDPOR") != null){ sndpor = xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/SNDPOR").InnerText; }
	
	string sndprn = "";
	if(xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/SNDPRN") != null){ sndprn = xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/SNDPRN").InnerText; }
	
	string rcvpor = "";
	if(xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/RCVPOR") != null){ rcvpor = xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/RCVPOR").InnerText; }
	
	string rcvprn = "";
	if(xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/RCVPRN") != null){ rcvprn = xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/RCVPRN").InnerText; }
	
	if(xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/DIRECT") != null){ xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/DIRECT").InnerText = "2"; }
	
	if(xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/CIMTYP") != null){	xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/CIMTYP").InnerText = "NA"; }
	
	if(xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/SNDPOR") != null){	xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/SNDPOR").InnerText = rcvpor; }
	
	if(xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/SNDPRN") != null){	xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/SNDPRN").InnerText = rcvprn; }
	
	if(xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/RCVPOR") != null){	xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/RCVPOR").InnerText = sndpor; }
	
	if(xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/RCVPRN") != null){	xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/RCVPRN").InnerText = rcvprn; }
	
	//if(xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/CREDAT") != null){
	//	xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/CREDAT").InnerText = DateTime.UtcNow.ToString("yyyyMMdd");
	//}
	
	//if(xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/CRETIM") != null){
	//	xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/CRETIM").InnerText = DateTime.UtcNow.ToString("HHmmss");
	//}
	
	// Convert UTC time to EST
	if(xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/CREDAT") != null){
		DateTime utcDateTime = DateTime.UtcNow;
		TimeZoneInfo estZone = TimeZoneInfo.FindSystemTimeZoneById("Eastern Standard Time");
		DateTime estDateTime = TimeZoneInfo.ConvertTimeFromUtc(utcDateTime, estZone);
		string estDateString = estDateTime.ToString("yyyyMMdd");
		
		context.Instance.TraceInformation("EST date = " + estDateString);
		xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/CREDAT").InnerText = estDateString;
	}
	
	if(xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/CRETIM") != null){
		DateTime utcDateTime = DateTime.UtcNow;
		TimeZoneInfo estZone = TimeZoneInfo.FindSystemTimeZoneById("Eastern Standard Time");
		DateTime estDateTime = TimeZoneInfo.ConvertTimeFromUtc(utcDateTime, estZone);
		string estTimeString = estDateTime.ToString("HHmmss");
		
		context.Instance.TraceInformation("EST time = " + estTimeString);
		xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/CRETIM").InnerText = estTimeString;
	}
	
	if(xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/SERIAL") != null){
		xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/SERIAL").InnerText = xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/CREDAT").InnerText + xmlIDOC.SelectSingleNode("ZMKAL/IDOC/EDI_DC40/CRETIM").InnerText;
	}
	
	context.Instance.TraceInformation(" CHANGED XML : " + xmlIDOC.OuterXml);
	
	context.Data.Text = xmlIDOC.OuterXml;
}
else{
	context.Data.SetProperty("SendPV", "LookupError", "True");
}&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d10p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d10p1:string&gt;Neuron&lt;/d10p1:string&gt;&lt;d10p1:string&gt;Neuron.Pipelines&lt;/d10p1:string&gt;&lt;d10p1:string&gt;Neuron.Esb&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;Newtonsoft.Json, Version=12.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d10p1:string&gt;&lt;d10p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d10p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typebb2c2098b0147c6a7bfea78b684db5&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="DecisionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d10p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;ee65ae15-7332-4ffc-b886-b81f76b0cd3f&lt;/Id&gt;&lt;Name&gt;Decision&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Branches&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="CodeBranchConditionOfESBMessagexAPWb1W4"&gt;&lt;Code&gt;// return context.Data.GetProperty("SendPV", "LookupError").ToString().ToUpper() == "FALSE";
 
 return true;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d13p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d13p1:string&gt;Neuron&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Neuron.Pipelines&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Neuron.Esb&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Newtonsoft.Json, Version=12.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d13p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Id&gt;f02eccdf-127a-4000-9cfa-8177a132c79f&lt;/Id&gt;&lt;Name&gt;PV IDOC Found&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d13p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;f5dd7f5b-f09f-43f1-9838-1a24e38bd423&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d14p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d14p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;d44f776e-d176-4782-93c5-f2ea1626b131&lt;/Id&gt;&lt;Name&gt;Map to Publish to ActiveMQ&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;context.Data.Header.SourceId = "ActiveMQ_AMPS_Publisher";

System.Xml.XmlDocument xmlDocument = context.Data.ToXmlDocument();

string changedXml = xmlDocument.OuterXml;
XDocument doc = XDocument.Parse(changedXml);
string formattedXml = doc.ToString(SaveOptions.None);

context.Instance.TraceInformation("FINAL PVAS XML: " + formattedXml);

context.Properties["PVASFinalMessage"] = formattedXml;

context.Data.Text = formattedXml;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d15p1:string&gt;Neuron&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Pipelines&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Esb&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Newtonsoft.Json, Version=12.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d15p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typecb81a6573d3498dadaf8f6e7334c8b&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d14p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d14p1:EsbMessagePublishPipelineStep"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;2a64b199-3cdd-4d01-aea0-fa884fdb140d&lt;/Id&gt;&lt;Name&gt;Publish to ActiveMQ&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d14p1:Semantic&gt;Multicast&lt;/d14p1:Semantic&gt;&lt;d14p1:Timeout&gt;60&lt;/d14p1:Timeout&gt;&lt;d14p1:TopicSelector i:type="d14p1:ESBMessageConstTopicSelector"&gt;&lt;d14p1:Topic&gt;ActiceMQ.AMPS&lt;/d14p1:Topic&gt;&lt;/d14p1:TopicSelector&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d14p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d14p1:ExecuteAdapterPipelineStep"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;5f78d568-eff9-411d-ac3d-9faa723b580a&lt;/Id&gt;&lt;Name&gt;Execute Adapter&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d14p1:AdapterName&gt;File Save Endpoint Send ProductionVerison Approval&lt;/d14p1:AdapterName&gt;&lt;d14p1:AdapterPoolTimeout&gt;PT1M&lt;/d14p1:AdapterPoolTimeout&gt;&lt;d14p1:MaxAdapterInstances&gt;100&lt;/d14p1:MaxAdapterInstances&gt;&lt;d14p1:Timeout&gt;PT1M&lt;/d14p1:Timeout&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d14p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d14p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;3ee0c450-b260-490d-b3d7-761b3d90d481&lt;/Id&gt;&lt;Name&gt;Map To Message Arrival Notification&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Retrieve the response template message
string messageArrivalNotificationTemplate = context.Configuration.XmlDocs["ESB Message Arrival Notification Message"].Xml;

string message = System.Net.WebUtility.HtmlEncode ( context.Properties["PVASFinalMessage"].ToString() );

// Get the data together to send the Business Error Message
string endpointAddress = context.Data.Header.To;
string eSBAction = context.Data.Header.Action;
string eSBTopic = "Production Version Approval Send " + "-MessageArrival";
string sourceSystemID = ""; 
string plantID = "";
string transactionID =  "";
string messageDate = context.Data.Header.Created.ToString("yyyy-MM-ddTHH:mm:ssZ");
string successMessage = "";

// Create the request message
string messageArrivalNotification = string.Format (messageArrivalNotificationTemplate, endpointAddress, 
	                                               eSBAction, eSBTopic, sourceSystemID, plantID, 
	                                               transactionID, messageDate, message, successMessage);

// Set message context to the request message 	
context.Data.Text = messageArrivalNotification;

context.Instance.TraceInformation(" CONTEXT DATA PV SEND : " + context.Data.Text); &lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d15p1:string&gt;Neuron&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Pipelines&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Esb&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d15p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type60603bd296e40bbb0cc0fdebdd9076&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d14p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d14p1:EsbMessagePublishPipelineStep"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;5da8c967-4c6e-4213-83a3-a49e3ee605d3&lt;/Id&gt;&lt;Name&gt;Message Arrival Notification&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d14p1:Semantic&gt;Multicast&lt;/d14p1:Semantic&gt;&lt;d14p1:Timeout&gt;0&lt;/d14p1:Timeout&gt;&lt;d14p1:TopicSelector i:type="d14p1:ESBMessageConstTopicSelector"&gt;&lt;d14p1:Topic&gt;MessageArrivalNotification&lt;/d14p1:Topic&gt;&lt;/d14p1:TopicSelector&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d14p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d14p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;3797f153-2309-4ce5-8197-be42e351c5b9&lt;/Id&gt;&lt;Name&gt;Map to Update IsApprovalSent&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;context.Instance.TraceInformation("UID IN MAP TO ISAPPROVAL SENT : " + context.Properties["PVAS_PVUID"].ToString());

context.Data.SetProperty("NeoPLM","LocalServiceURI", context.Properties ["LocalServiceURI"].ToString() + "ERPProductionVersions/setIsApprovalSent");

// Setup Communication Retry Properties
context.Data.SetProperty("Neo", "CommSuccess", "false");
context.Data.SetProperty("Neo", "RetryCount", "0");&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d15p1:string&gt;Neuron&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Pipelines&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Esb&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Newtonsoft.Json, Version=12.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d15p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type2071b7ef4b24ef2821c000ea951c03&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="RestPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;8362dd36-e2d2-40d2-8b18-373e0474208f&lt;/Id&gt;&lt;Name&gt;Setup Req&lt;/Name&gt;&lt;Uniquename&gt;ddda9d2f-1e42-4a32-a36f-05839004466d&lt;/Uniquename&gt;&lt;SerializableCurrentRestRequest&gt;&amp;lt;?xml version="1.0" encoding="utf-16"?&amp;gt;&amp;lt;RestRequest xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&amp;gt;&amp;lt;Method&amp;gt;POST&amp;lt;/Method&amp;gt;&amp;lt;URI&amp;gt;{#NeoPLM.LocalServiceURI}&amp;lt;/URI&amp;gt;&amp;lt;Body /&amp;gt;&amp;lt;BodyType&amp;gt;Raw&amp;lt;/BodyType&amp;gt;&amp;lt;BodyFormat&amp;gt;XML&amp;lt;/BodyFormat&amp;gt;&amp;lt;DeleteMessageBody&amp;gt;true&amp;lt;/DeleteMessageBody&amp;gt;&amp;lt;DeleteResponseBody&amp;gt;false&amp;lt;/DeleteResponseBody&amp;gt;&amp;lt;Parameters&amp;gt;&amp;lt;ParameterDataElement&amp;gt;&amp;lt;Key&amp;gt;uid&amp;lt;/Key&amp;gt;&amp;lt;Value&amp;gt;{#context(PVAS_PVUID)}&amp;lt;/Value&amp;gt;&amp;lt;/ParameterDataElement&amp;gt;&amp;lt;/Parameters&amp;gt;&amp;lt;Headers&amp;gt;&amp;lt;HeaderDataElement&amp;gt;&amp;lt;Key&amp;gt;Accept&amp;lt;/Key&amp;gt;&amp;lt;Value&amp;gt;application/xml&amp;lt;/Value&amp;gt;&amp;lt;/HeaderDataElement&amp;gt;&amp;lt;/Headers&amp;gt;&amp;lt;AdapterEndpointProperties /&amp;gt;&amp;lt;BodyProperties&amp;gt;&amp;lt;BodyDataElement&amp;gt;&amp;lt;Key&amp;gt;sourceSystemID&amp;lt;/Key&amp;gt;&amp;lt;Value&amp;gt;{#JObject.SourceSystemID}&amp;lt;/Value&amp;gt;&amp;lt;/BodyDataElement&amp;gt;&amp;lt;BodyDataElement&amp;gt;&amp;lt;Key&amp;gt;plantID&amp;lt;/Key&amp;gt;&amp;lt;Value&amp;gt;{#JObject.PlantID}&amp;lt;/Value&amp;gt;&amp;lt;/BodyDataElement&amp;gt;&amp;lt;/BodyProperties&amp;gt;&amp;lt;TestEnabled&amp;gt;FALSE&amp;lt;/TestEnabled&amp;gt;&amp;lt;TestFormat&amp;gt;TEXT&amp;lt;/TestFormat&amp;gt;&amp;lt;MaxPoolSize&amp;gt;1&amp;lt;/MaxPoolSize&amp;gt;&amp;lt;PoolTimeOut&amp;gt;1000&amp;lt;/PoolTimeOut&amp;gt;&amp;lt;AuditRequest&amp;gt;false&amp;lt;/AuditRequest&amp;gt;&amp;lt;AuditResponses&amp;gt;false&amp;lt;/AuditResponses&amp;gt;&amp;lt;AuditFailures&amp;gt;false&amp;lt;/AuditFailures&amp;gt;&amp;lt;/RestRequest&amp;gt;&lt;/SerializableCurrentRestRequest&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="WhilePipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;0b3921cb-c4c6-4557-b762-daa1bfeb9db8&lt;/Id&gt;&lt;Name&gt;While Comm Failed&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="ExceptionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d17p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;e0a3a30b-17ca-40a9-88b0-866b1c28289a&lt;/Id&gt;&lt;Name&gt;Exception&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Catch&gt;&lt;Bindings xmlns:d18p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;eee5402b-9468-403e-990a-bddddc552965&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="DecisionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;6af9e65d-6e78-4516-a6a1-1c109bada0a4&lt;/Id&gt;&lt;Name&gt;Retry Count&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Branches&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="CodeBranchConditionOfESBMessagexAPWb1W4"&gt;&lt;Code&gt;int count = System.Convert.ToInt32 (context.Data.GetProperty ("Neo", "RetryCount"));
int numRetries = System.Convert.ToInt32 (context.EnvironmentVariables["NeoServicesNumberofRetries"]);

if (count &amp;lt; numRetries)
{	
	// Increment counter
	count = count + 1;
	context.Data.SetProperty ("Neo", "RetryCount", count.ToString());
	context.Instance.TraceInformation ("Communication Failed.  Start of Retry Cycle " + count);
	
	return true;
}
else
{
	context.Instance.TraceInformation ("Communication Failed.  Retries Exhausted.  Rethrow Exception");
	return false;
}&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d23p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d23p1:string&gt;Neuron&lt;/d23p1:string&gt;&lt;d23p1:string&gt;Neuron.Pipelines&lt;/d23p1:string&gt;&lt;d23p1:string&gt;Neuron.Esb&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d23p1:string&gt;&lt;d23p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d23p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;If&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d23p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;109499d0-5e13-4301-b4a1-54f36ea9dc42&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d24p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d24p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d25p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;20d33acb-36dc-4376-838d-7c51584fcf7b&lt;/Id&gt;&lt;Name&gt;Wait Time and Retry&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d25p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;int timeoutValue = System.Convert.ToInt32 (context.EnvironmentVariables["NeoServicesRetryInterval"]) * 1000;

System.Threading.Thread.Sleep (timeoutValue);

context.Instance.TraceInformation ("Communications Failure with Neo PLM.  Retrying....");&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d25p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d25p1:string&gt;Neuron&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Neuron.Pipelines&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Neuron.Esb&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d25p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typecde6b061d0f411596a785fde1d8e73&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="AlwaysBranchConditionOfESBMessagexAPWb1W4" /&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Else&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d23p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;ca41a44c-e105-4198-aca3-6b90d73fa86f&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="RethrowPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d25p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;0dae4815-b708-4f5d-8d0c-feb452bb4184&lt;/Id&gt;&lt;Name&gt;Rethrow&lt;/Name&gt;&lt;Uniquename /&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;/Branches&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Catch&gt;&lt;Finally&gt;&lt;Bindings xmlns:d18p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;d0eb5c29-89ac-4a81-9318-0657355e0214&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children /&gt;&lt;/Finally&gt;&lt;Try&gt;&lt;Bindings xmlns:d18p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;4d9f367c-9fcc-4d09-a54a-dbb4ac1d82df&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d19p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d19p1:EsbMessageServiceEndpointPipelineStep"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;fc7fe0b6-2494-4c2e-b15a-2afb635992f4&lt;/Id&gt;&lt;Name&gt;Set IsApprovalSent&lt;/Name&gt;&lt;Uniquename&gt;efd5253d-954e-46ae-bd07-a34fc30b9073&lt;/Uniquename&gt;&lt;d19p1:Category&gt;General&lt;/d19p1:Category&gt;&lt;d19p1:Description&gt;This service serves as a proxy for the external service that is provided by Neo PLM, Inc.  It is here for ease of configuration only.  Nothing is ever processed by this item.&lt;/d19p1:Description&gt;&lt;d19p1:MaxServiceInstances&gt;100&lt;/d19p1:MaxServiceInstances&gt;&lt;d19p1:MessagePattern&gt;Request-Reply&lt;/d19p1:MessagePattern&gt;&lt;d19p1:Policy&gt;Service Proxy Policy&lt;/d19p1:Policy&gt;&lt;d19p1:ServiceBinding&gt;REST&lt;/d19p1:ServiceBinding&gt;&lt;d19p1:ServiceConnector&gt;NeoPLM Local Integration Service - Rest Transaction Proxy&lt;/d19p1:ServiceConnector&gt;&lt;d19p1:ServiceId&gt;afd7e3f1-61d8-432b-aa89-f6df498f1d2a&lt;/d19p1:ServiceId&gt;&lt;d19p1:ServicePoolTimeout&gt;PT1M&lt;/d19p1:ServicePoolTimeout&gt;&lt;d19p1:ServiceUrl&gt;http://BogusServer/&lt;/d19p1:ServiceUrl&gt;&lt;d19p1:ThrowExceptionOnFault&gt;true&lt;/d19p1:ThrowExceptionOnFault&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d19p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d19p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;e95a1d4f-c4fb-4cca-9efe-55235a78e4c7&lt;/Id&gt;&lt;Name&gt;Set Comm Successful&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d20p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Set Communication Success
context.Data.SetProperty ("Neo", "CommSuccess", "true");

context.Instance.TraceInformation ("Communication Success.");
&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d20p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d20p1:string&gt;Neuron&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Neuron.Pipelines&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Neuron.Esb&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d20p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typed86a6fa43014865a8da4028bd205e3&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Try&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;Condition&gt;&lt;Code&gt;//if (context.Data.GetProperty("Neo", "CommSuccess") == "false")
//	return true;
//else
//	return false;
return context.Data.GetProperty("Neo", "CommSuccess") != "true";&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d16p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d16p1:string&gt;Neuron&lt;/d16p1:string&gt;&lt;d16p1:string&gt;Neuron.Pipelines&lt;/d16p1:string&gt;&lt;d16p1:string&gt;Neuron.Esb&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d16p1:string&gt;&lt;d16p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d16p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;TurnOffTrackExecution&gt;false&lt;/TurnOffTrackExecution&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="AlwaysBranchConditionOfESBMessagexAPWb1W4" /&gt;&lt;Disable&gt;true&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Id&gt;3fdd5ecc-7ad4-4ed4-9aaa-8a50a693edd3&lt;/Id&gt;&lt;Name&gt;PV IDOC Not Found&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d13p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;11606f6c-5e65-454e-bbe9-fd73850f2c32&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d14p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d14p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;4cfe0bd3-9f4d-41ac-a351-97cdbba3b096&lt;/Id&gt;&lt;Name&gt;Create System Error&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Get the data together to send the Business Error Message
string endpointAddress = context.Data.Header.To;
string eSBAction = context.Data.Header.Action;
string eSBTopic = context.Data.Header.Topic;

eSBTopic = "PV_Approval_Send_Process" + "-Errors";
string sourceSystemID = ""; 
string plantID = "";
string transactionID = "";
string messageDate = context.Data.Header.Created.ToString("yyyy-MM-ddTHH:mm:ssZ");
string errorCode = "1110";
string errorMessage = "Failed to send Production Version acknowledgment. The referenced Production Version couldn't be located in the NeoPLM Integration system.";
string originalMessage = "";
string errorParameter = String.Format("Production Version ID: {0}|{1}", context.Properties["PVAS_PVID"].ToString(), context.Properties["PVAS_MaterialID"].ToString());

if(context.Properties.ContainsKey("TransactionID")){
	context.Instance.TraceInformation("TransactionID Found : " + context.Properties["TransactionID"].ToString());
	context.Properties["TransactionID"] = transactionID;
}
else{
	context.Properties.Add("TransactionID", transactionID);
}

if(context.Properties.ContainsKey("EmailSubject")){
	context.Instance.TraceInformation("EmailSubject Found : " + context.Properties["EmailSubject"].ToString());
	context.Properties["EmailSubject"] = "An error has occured in the Neo PLM Integration System. Send Production Version Approval process failed.";
}
else{
	context.Properties.Add("EmailSubject", "An error has occured in the Neo PLM Integration System. Send Production Version Approval process failed.");
}

// Get the business error template
string errorTemplate = context.Configuration.XmlDocs["ESB System Error Message"].Xml;

string eSBErrorMessage = string.Format(errorTemplate, endpointAddress, eSBAction, eSBTopic, sourceSystemID, plantID, transactionID, messageDate, errorCode, errorMessage, originalMessage);

context.Instance.TraceInformation ("System Error: " + eSBErrorMessage);

//Set Values for Error Properties
context.Properties.Add("ErrorDetail", originalMessage);
context.Properties.Add("ErrorMessage", errorMessage);
context.Properties.Add("ErrorTypeID", errorCode);
context.Properties.Add("ErrorParameter", errorParameter);

context.Data.Text = eSBErrorMessage;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d15p1:string&gt;Neuron&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Pipelines&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Esb&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d15p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type11624a5a2154ce58811e380fbf8048&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d14p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d14p1:EsbMessagePipelineExecutionPipelineStep"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;43ee1827-cf9b-44a9-a7aa-49b42c6f64f2&lt;/Id&gt;&lt;Name&gt;Send Email&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d14p1:FileName i:nil="true" /&gt;&lt;d14p1:MaxInstances&gt;100&lt;/d14p1:MaxInstances&gt;&lt;d14p1:PipelineName&gt;Process_EW_SendErrorEmail&lt;/d14p1:PipelineName&gt;&lt;d14p1:PoolTimeout&gt;PT1M&lt;/d14p1:PoolTimeout&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;/Branches&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/ForEach&gt;&lt;MaxThreadCount&gt;10&lt;/MaxThreadCount&gt;&lt;Splitter xmlns:d7p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d7p1:XPathEsbMessageSplitter"&gt;&lt;d7p1:XPath&gt;ProductionVersions/ProductionVersion&lt;/d7p1:XPath&gt;&lt;/Splitter&gt;&lt;TurnOffTrackExecution&gt;true&lt;/TurnOffTrackExecution&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Try&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Steps&gt;&lt;/ESBMessagePipeline&gt;</PipelineBlob>
  <IsProcessFlow>false</IsProcessFlow>
</ESBMessagePipelineStorage>