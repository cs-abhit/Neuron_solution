<?xml version="1.0"?>
<ESBMessagePipelineStorage xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <Id>4ab39327-51fc-4311-bad2-8d1f968ac48c</Id>
  <Version>3b201ca9-a197-4bc2-8eab-67fbe947bcfd</Version>
  <BusinessFlows />
  <Description />
  <Name>SendOrderStepCompletion</Name>
  <IsSystemObject>false</IsSystemObject>
  <IsPrivate>false</IsPrivate>
  <Category>General</Category>
  <IsEncrypted>true</IsEncrypted>
  <Path>New Data Enhancement Functions</Path>
  <PipelineBlob>&lt;ESBMessagePipeline xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://schemas.neuronesb.com/pipelines/"&gt;&lt;Category&gt;General&lt;/Category&gt;&lt;Description i:nil="true" /&gt;&lt;GlobalProperties xmlns:d2p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Name&gt;SendOrderStepCompletion&lt;/Name&gt;&lt;Properties xmlns:d2p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;ReferencedAssemblies xmlns:d2p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" i:nil="true" /&gt;&lt;Steps&gt;&lt;ESBMessagePipelineStep i:type="ExceptionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d4p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;1f9dbd00-4b2a-4b96-ab4e-1c9f2be1ec72&lt;/Id&gt;&lt;Name&gt;Exception&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Catch&gt;&lt;Bindings xmlns:d5p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;0025b336-49ca-47e6-a831-0959001fa70c&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;734ee5b6-440a-4965-8a38-6cc87b83bf72&lt;/Id&gt;&lt;Name&gt;Trace Exception&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;PipelineException parentEx = (PipelineException)context.Properties["PipelineException"];

string newExceptionMessag = String.Format(System.Globalization.CultureInfo.InvariantCulture,
	         "Pipeline Error - Type: {0} Message: {1} \r\nSource Pipeline: {2}\r\nSource Pipeline Step: {3}\r\nSource Error Message: {4}",
	                                    	parentEx.InnerException.GetType().ToString(),
											parentEx.Message,
	                                        parentEx.Pipeline, 
	                                        parentEx.PipelineStep, 
	                                        (parentEx.InnerException != null ? parentEx.InnerException.Message : ""));
	
context.Instance.TraceInformation(newExceptionMessag);&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d7p1:string&gt;Neuron&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Pipelines&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Esb&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Newtonsoft.Json, Version=12.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d7p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type37932796d7549439d140f25ff87e8f&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;ff87d3a2-5dec-476d-a281-d0629c6b8d03&lt;/Id&gt;&lt;Name&gt;Trace the Available Information on the Exception&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;PipelineException parentEx = (PipelineException) context.Properties["PipelineException"];

System.Exception baseException = parentEx.GetBaseException();

context.Instance.TraceError ("******************** Message Error ******************************");
context.Instance.TraceError ("Parent Base Exception: " + baseException.ToString());
context.Instance.TraceError ("Parent Base Exception Type: " + baseException.GetType().ToString());
context.Instance.TraceError ("Parent Base Exception Message: " + baseException.Message.ToString());

context.Instance.TraceError ("Parent Line Number: " + parentEx.LineNumber.ToString());
context.Instance.TraceError ("Parent Message: " + parentEx.Message.ToString());
context.Instance.TraceError ("Parent Pipe Line: " + parentEx.Pipeline.ToString());
context.Instance.TraceError ("Parent Pipe Line Step: " + parentEx.PipelineStep.ToString());

if (parentEx.StackTrace != null)
{
	context.Instance.TraceError ("Parent Stack Trace: " + parentEx.StackTrace.ToString());
}

if (parentEx.InnerException != null)
{
	context.Instance.TraceError ("Inner Exception Message: " + parentEx.InnerException.Message.ToString());
}&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d7p1:string&gt;Neuron&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Pipelines&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Esb&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d7p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type704279b027f4124a01e147e3dd82da&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;4cfe0bd3-9f4d-41ac-a351-97cdbba3b096&lt;/Id&gt;&lt;Name&gt;Create System Error&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;PipelineException parentEx = (PipelineException) context.Properties["PipelineException"];

System.Exception baseException = parentEx.GetBaseException();

string errorMessage = "System Error: ";

errorMessage = errorMessage + "\tParent Base Exception: " + baseException.ToString() + "\r\n\r\n";
errorMessage = errorMessage + "\tParent Base Exception Type: " + baseException.GetType().ToString() + "\r\n\r\n";
errorMessage = errorMessage + "\tParent Base Exception Message: " + baseException.Message.ToString() + "\r\n\r\n";

errorMessage = errorMessage + "\tParent Line Number: " + parentEx.LineNumber.ToString() + "\r\n\r\n";
errorMessage = errorMessage + "\tParent Message: " + parentEx.Message.ToString() + "\r\n\r\n";
errorMessage = errorMessage + "\tParent Pipe Line: " + parentEx.Pipeline.ToString() + "\r\n\r\n";
errorMessage = errorMessage + "\tParent Pipe Line Step: " + parentEx.PipelineStep.ToString() + "\r\n\r\n";
errorMessage = errorMessage + "\tParent Stack Trace: " + parentEx.StackTrace.ToString() + "\r\n\r\n";

errorMessage = errorMessage + "\tInner Exception Message: " + parentEx.InnerException.Message.ToString() + "\r\n\r\n";


// Get the data together to send the Business Error Message
string endpointAddress = context.Data.Header.To;
string eSBAction = context.Data.Header.Action;
string eSBTopic = context.Data.Header.Topic;

eSBTopic = "Order_Step_Completion_Send_Process" + "-Errors";
string sourceSystemID = ""; 
string plantID = "";
string transactionID = "";
//string transactionID = "";
string messageDate = context.Data.Header.Created.ToString("yyyy-MM-ddTHH:mm:ssZ");
string errorCode = "1000";
string originalMessage = "";

// Get the business error template
string errorTemplate = context.Configuration.XmlDocs["ESB System Error Message"].Xml;

string eSBErrorMessage = string.Format(errorTemplate, endpointAddress, eSBAction, eSBTopic, sourceSystemID, plantID, transactionID, messageDate, errorCode, errorMessage, originalMessage);

context.Instance.TraceInformation ("System Error: " + eSBErrorMessage);

//Set Values for Error Properties
context.Properties.Add("ErrorDetail", originalMessage);
context.Properties.Add("ErrorMessage", errorMessage);
context.Properties.Add("ErrorTypeID", errorCode);

context.Data.Text = eSBErrorMessage;

context.Data.SetProperty ("NeoPLM", "BaseException", baseException.GetType().ToString());
context.Data.SetProperty ("NeoPLM", "BaseExceptionMessage", baseException.Message.ToString());&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d7p1:string&gt;Neuron&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Pipelines&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Esb&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d7p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type11624a5a2154ce58811e380fbf8048&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;796a3d40-c8ea-45b9-86ca-89cab891faf9&lt;/Id&gt;&lt;Name&gt;Create Email&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;//Newtonsoft.Json.Linq.JObject inputMessage = context.Data.ToJObject();
//var ESBError = inputMessage.ToObject &amp;lt;dynamic&amp;gt; ();

context.Properties["EmailAddressString"] = context.EnvironmentVariables["DefaultAdminEmailAddressString"].ToString();
var emailList = context.Properties["EmailAddressString"].ToString();
var emailSender = context.EnvironmentVariables["SmtpSendAddress"];

//var sourceID = ESBError.EndpointAddress;
//var action = ESBError.ESBAction;
//var creationDate = ESBError.MessageDate;
//var messageID = ESBError.TransactionID;

//var emailSubject = string.Format("A System Error Has Occurred on Neo PLM Integration Endpoint: {0} Method: {1}", sourceID, action);

var emailSubject = "An error has occured in the Neo PLM Integration System. Send Order Step Completion process failed.";

//context.Properties["ErrorDetail"] = context.Properties["PVAS_EmailBody"].ToString();

var emailTemplate = context.Configuration.TextDocs["SchemaValidationTemplate"].Text;
emailTemplate = emailTemplate.Replace("${ErrorMessage}", context.Properties["ErrorMessage"].ToString());
emailTemplate = emailTemplate.Replace("${ErrorDetail}", context.Properties["ErrorDetail"].ToString());

context.Instance.TraceInformation(string.Format("Sending email '{2}' from {0} to {1}",emailSender,emailList,emailSubject));
context.Data.SetProperty("smtp", "To", emailList);
context.Instance.TraceInformation("SMTP TO: " + emailList);
context.Data.SetProperty("smtp", "From", emailSender);
context.Instance.TraceInformation("SMTP FROM: " + emailSender);
context.Data.SetProperty("smtp", "Subject", emailSubject);
context.Instance.TraceInformation("SUBJECT: " + emailSubject);
context.Data.SetProperty("smtp", "Body", emailTemplate);
context.Instance.TraceInformation("BODY: " + emailTemplate);
context.Data.SetProperty("smtp", "BodyAsAttachment", false.ToString());
//context.Data.SetProperty("smtp", "FileName", string.Format("{0}.txt","NeoError"));
context.Data.SetProperty("smtp", "IsBodyHtml", true.ToString());

context.Data.Header.SourceId = "B2MML_ERP_Publisher";
context.Data.Text = context.Properties["ErrorMessage"].ToString();&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d7p1:string&gt;Neuron&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Pipelines&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Esb&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type27803a7f60b4c3991ff5504dd4dfc0&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessagePublishPipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;e4cb79fc-c164-413f-a6cd-eaa1cf9a289e&lt;/Id&gt;&lt;Name&gt;Publish to EmailNotification&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d6p1:Semantic&gt;Multicast&lt;/d6p1:Semantic&gt;&lt;d6p1:Timeout&gt;60&lt;/d6p1:Timeout&gt;&lt;d6p1:TopicSelector i:type="d6p1:ESBMessageConstTopicSelector"&gt;&lt;d6p1:Topic&gt;EmailNotification&lt;/d6p1:Topic&gt;&lt;/d6p1:TopicSelector&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Catch&gt;&lt;Finally&gt;&lt;Bindings xmlns:d5p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;18f954cf-548b-429f-960d-8daf5942040d&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children /&gt;&lt;/Finally&gt;&lt;Try&gt;&lt;Bindings xmlns:d5p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;4366ef1d-d2a2-42dd-b038-383cf9e531a9&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;5eecaa33-360e-468a-9031-de8cef4f1aa4&lt;/Id&gt;&lt;Name&gt;Init Step&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;context.Instance.TraceInformation(" SEND OSC CALLED. CONTEXT DATA : " + context.Data.Text);

context.Properties.Add("OSCFinalMessage", "");&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d7p1:string&gt;Neuron&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Pipelines&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Esb&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Newtonsoft.Json, Version=12.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d7p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typed8a051498d34e76801152a3f01fe7c&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;eed47c8b-4cfd-4def-bc09-31894d18f19d&lt;/Id&gt;&lt;Name&gt;Map To Local URI&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Retrieve the response template message
string localServiceURIRequestTemplate = context.Configuration.XmlDocs["LocalServiceURIRequest"].Xml;
	
// Create the request message
string localServiceURIRequest = string.Format(localServiceURIRequestTemplate, "dummyTransaction", System.Guid.NewGuid() , "dummyMessage");

//Send the trace message to document the request message.
context.Instance.TraceInformation ("OSC Validate LocalURI - Message ID: " + context.Data.Header.MessageId.ToString() + " Request Message: " + localServiceURIRequest);
	
// Set message context to the request message 	
context.Data.Text = localServiceURIRequest;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d7p1:string&gt;Neuron&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Pipelines&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Esb&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d7p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type462126ea05c4d04b42064c3255e287&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessagePipelineExecutionPipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;a46cbe5a-0462-4163-86a7-c80e467f6b4b&lt;/Id&gt;&lt;Name&gt;Local URI&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d6p1:FileName i:nil="true" /&gt;&lt;d6p1:MaxInstances&gt;100&lt;/d6p1:MaxInstances&gt;&lt;d6p1:PipelineName&gt;Process_GetLocalServiceURI - New&lt;/d6p1:PipelineName&gt;&lt;d6p1:PoolTimeout&gt;PT1M&lt;/d6p1:PoolTimeout&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;6174dca8-7ce5-4ba3-980b-0222b3678b20&lt;/Id&gt;&lt;Name&gt;Map From Local URI&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;string localServiceURI = context.Data.ToXmlDocument().SelectSingleNode("/*[local-name()='LocalServiceURIResponse' and namespace-uri()='http://NeoPLM.com/EnterpriseIntegration']/*[local-name()='LocalServiceURI' and namespace-uri()='http://NeoPLM.com/EnterpriseIntegration']").InnerText;

context.Properties ["LocalServiceURI"] = localServiceURI;

context.Instance.TraceInformation ("LocalServiceURI in OSC SEND : " + context.Properties["LocalServiceURI"]);

context.Data.SetProperty("NeoPLM","LocalServiceURI", context.Properties ["LocalServiceURI"].ToString() + "BatchHistorySubSystems");

// Setup Communication Retry Properties
context.Data.SetProperty("Neo", "CommSuccess", "false");
context.Data.SetProperty("Neo", "RetryCount", "0");&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d7p1:string&gt;Neuron&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Pipelines&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Esb&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d7p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type9b5f9b02d894592bae05ea79ecad56&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="RestPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;8362dd36-e2d2-40d2-8b18-373e0474208f&lt;/Id&gt;&lt;Name&gt;Setup Local API Call&lt;/Name&gt;&lt;Uniquename&gt;ddda9d2f-1e42-4a32-a36f-05839004466d&lt;/Uniquename&gt;&lt;SerializableCurrentRestRequest&gt;&amp;lt;?xml version="1.0" encoding="utf-16"?&amp;gt;&amp;lt;RestRequest xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&amp;gt;&amp;lt;Method&amp;gt;GET&amp;lt;/Method&amp;gt;&amp;lt;URI&amp;gt;{#NeoPLM.LocalServiceURI}&amp;lt;/URI&amp;gt;&amp;lt;Body /&amp;gt;&amp;lt;BodyType&amp;gt;Raw&amp;lt;/BodyType&amp;gt;&amp;lt;BodyFormat&amp;gt;XML&amp;lt;/BodyFormat&amp;gt;&amp;lt;DeleteMessageBody&amp;gt;true&amp;lt;/DeleteMessageBody&amp;gt;&amp;lt;DeleteResponseBody&amp;gt;false&amp;lt;/DeleteResponseBody&amp;gt;&amp;lt;Parameters /&amp;gt;&amp;lt;Headers&amp;gt;&amp;lt;HeaderDataElement&amp;gt;&amp;lt;Key&amp;gt;Accept&amp;lt;/Key&amp;gt;&amp;lt;Value&amp;gt;application/xml&amp;lt;/Value&amp;gt;&amp;lt;/HeaderDataElement&amp;gt;&amp;lt;/Headers&amp;gt;&amp;lt;AdapterEndpointProperties /&amp;gt;&amp;lt;BodyProperties&amp;gt;&amp;lt;BodyDataElement&amp;gt;&amp;lt;Key&amp;gt;sourceSystemID&amp;lt;/Key&amp;gt;&amp;lt;Value&amp;gt;{#JObject.SourceSystemID}&amp;lt;/Value&amp;gt;&amp;lt;/BodyDataElement&amp;gt;&amp;lt;BodyDataElement&amp;gt;&amp;lt;Key&amp;gt;plantID&amp;lt;/Key&amp;gt;&amp;lt;Value&amp;gt;{#JObject.PlantID}&amp;lt;/Value&amp;gt;&amp;lt;/BodyDataElement&amp;gt;&amp;lt;/BodyProperties&amp;gt;&amp;lt;TestEnabled&amp;gt;FALSE&amp;lt;/TestEnabled&amp;gt;&amp;lt;TestFormat&amp;gt;TEXT&amp;lt;/TestFormat&amp;gt;&amp;lt;MaxPoolSize&amp;gt;1&amp;lt;/MaxPoolSize&amp;gt;&amp;lt;PoolTimeOut&amp;gt;1000&amp;lt;/PoolTimeOut&amp;gt;&amp;lt;AuditRequest&amp;gt;false&amp;lt;/AuditRequest&amp;gt;&amp;lt;AuditResponses&amp;gt;false&amp;lt;/AuditResponses&amp;gt;&amp;lt;AuditFailures&amp;gt;false&amp;lt;/AuditFailures&amp;gt;&amp;lt;/RestRequest&amp;gt;&lt;/SerializableCurrentRestRequest&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="WhilePipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;0b3921cb-c4c6-4557-b762-daa1bfeb9db8&lt;/Id&gt;&lt;Name&gt;While Comm Failed&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="ExceptionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d9p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;e0a3a30b-17ca-40a9-88b0-866b1c28289a&lt;/Id&gt;&lt;Name&gt;Exception&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Catch&gt;&lt;Bindings xmlns:d10p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;eee5402b-9468-403e-990a-bddddc552965&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="DecisionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d12p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;6af9e65d-6e78-4516-a6a1-1c109bada0a4&lt;/Id&gt;&lt;Name&gt;Retry Count&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Branches&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="CodeBranchConditionOfESBMessagexAPWb1W4"&gt;&lt;Code&gt;int count = System.Convert.ToInt32 (context.Data.GetProperty ("Neo", "RetryCount"));
int numRetries = System.Convert.ToInt32 (context.EnvironmentVariables["NeoServicesNumberofRetries"]);

if (count &amp;lt; numRetries)
{	
	// Increment counter
	count = count + 1;
	context.Data.SetProperty ("Neo", "RetryCount", count.ToString());
	context.Instance.TraceInformation ("Communication Failed.  Start of Retry Cycle " + count);
	
	return true;
}
else
{
	context.Instance.TraceInformation ("Communication Failed.  Retries Exhausted.  Rethrow Exception");
	return false;
}&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d15p1:string&gt;Neuron&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Pipelines&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Esb&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d15p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;If&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;109499d0-5e13-4301-b4a1-54f36ea9dc42&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d16p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d16p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d17p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;20d33acb-36dc-4376-838d-7c51584fcf7b&lt;/Id&gt;&lt;Name&gt;Wait Time and Retry&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d17p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;int timeoutValue = System.Convert.ToInt32 (context.EnvironmentVariables["NeoServicesRetryInterval"]) * 1000;

System.Threading.Thread.Sleep (timeoutValue);

context.Instance.TraceInformation ("Communications Failure with Neo PLM.  Retrying....");&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d17p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d17p1:string&gt;Neuron&lt;/d17p1:string&gt;&lt;d17p1:string&gt;Neuron.Pipelines&lt;/d17p1:string&gt;&lt;d17p1:string&gt;Neuron.Esb&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d17p1:string&gt;&lt;d17p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d17p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typecde6b061d0f411596a785fde1d8e73&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="AlwaysBranchConditionOfESBMessagexAPWb1W4" /&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Else&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;ca41a44c-e105-4198-aca3-6b90d73fa86f&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="RethrowPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d17p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;0dae4815-b708-4f5d-8d0c-feb452bb4184&lt;/Id&gt;&lt;Name&gt;Rethrow&lt;/Name&gt;&lt;Uniquename /&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;/Branches&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Catch&gt;&lt;Finally&gt;&lt;Bindings xmlns:d10p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;d0eb5c29-89ac-4a81-9318-0657355e0214&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children /&gt;&lt;/Finally&gt;&lt;Try&gt;&lt;Bindings xmlns:d10p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;4d9f367c-9fcc-4d09-a54a-dbb4ac1d82df&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d11p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d11p1:EsbMessageServiceEndpointPipelineStep"&gt;&lt;Bindings xmlns:d12p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;fc7fe0b6-2494-4c2e-b15a-2afb635992f4&lt;/Id&gt;&lt;Name&gt;Get OSC Records&lt;/Name&gt;&lt;Uniquename&gt;efd5253d-954e-46ae-bd07-a34fc30b9073&lt;/Uniquename&gt;&lt;d11p1:Category&gt;General&lt;/d11p1:Category&gt;&lt;d11p1:Description&gt;This service serves as a proxy for the external service that is provided by Neo PLM, Inc.  It is here for ease of configuration only.  Nothing is ever processed by this item.&lt;/d11p1:Description&gt;&lt;d11p1:MaxServiceInstances&gt;100&lt;/d11p1:MaxServiceInstances&gt;&lt;d11p1:MessagePattern&gt;Request-Reply&lt;/d11p1:MessagePattern&gt;&lt;d11p1:Policy&gt;Service Proxy Policy&lt;/d11p1:Policy&gt;&lt;d11p1:ServiceBinding&gt;REST&lt;/d11p1:ServiceBinding&gt;&lt;d11p1:ServiceConnector&gt;NeoPLM Local Integration Service - Rest Transaction Proxy&lt;/d11p1:ServiceConnector&gt;&lt;d11p1:ServiceId&gt;afd7e3f1-61d8-432b-aa89-f6df498f1d2a&lt;/d11p1:ServiceId&gt;&lt;d11p1:ServicePoolTimeout&gt;PT1M&lt;/d11p1:ServicePoolTimeout&gt;&lt;d11p1:ServiceUrl&gt;http://BogusServer/&lt;/d11p1:ServiceUrl&gt;&lt;d11p1:ThrowExceptionOnFault&gt;true&lt;/d11p1:ThrowExceptionOnFault&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d11p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d11p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d12p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;e95a1d4f-c4fb-4cca-9efe-55235a78e4c7&lt;/Id&gt;&lt;Name&gt;Set Comm Successful&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d12p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Set Communication Success
context.Data.SetProperty ("Neo", "CommSuccess", "true");

context.Instance.TraceInformation ("Communication Success.");
&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d12p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d12p1:string&gt;Neuron&lt;/d12p1:string&gt;&lt;d12p1:string&gt;Neuron.Pipelines&lt;/d12p1:string&gt;&lt;d12p1:string&gt;Neuron.Esb&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d12p1:string&gt;&lt;d12p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d12p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typed86a6fa43014865a8da4028bd205e3&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Try&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;Condition&gt;&lt;Code&gt;//if (context.Data.GetProperty("Neo", "CommSuccess") == "false")
//	return true;
//else
//	return false;
return context.Data.GetProperty("Neo", "CommSuccess") != "true";&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d8p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d8p1:string&gt;Neuron&lt;/d8p1:string&gt;&lt;d8p1:string&gt;Neuron.Pipelines&lt;/d8p1:string&gt;&lt;d8p1:string&gt;Neuron.Esb&lt;/d8p1:string&gt;&lt;d8p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d8p1:string&gt;&lt;d8p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d8p1:string&gt;&lt;d8p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d8p1:string&gt;&lt;d8p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d8p1:string&gt;&lt;d8p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d8p1:string&gt;&lt;d8p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d8p1:string&gt;&lt;d8p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d8p1:string&gt;&lt;d8p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d8p1:string&gt;&lt;d8p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d8p1:string&gt;&lt;d8p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d8p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;TurnOffTrackExecution&gt;false&lt;/TurnOffTrackExecution&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;9c98e851-8fa0-406d-b838-bfe214f6699a&lt;/Id&gt;&lt;Name&gt;List Response&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;context.Instance.TraceInformation("Response from OSC API : " + context.Data.Text);

System.Xml.XmlDocument xDoc = context.Data.ToXmlDocument();

string encodedResponseText = xDoc.DocumentElement.FirstChild.InnerText;

string decodedResponseText = System.Net.WebUtility.HtmlDecode (encodedResponseText) ;

context.Instance.TraceInformation( " DECODED RESPONSE : " + decodedResponseText);

context.Data.Text = decodedResponseText;

context.Instance.TraceInformation("FINAL BEFORE SPLIT " + context.Data.Text);&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d7p1:string&gt;Neuron&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Pipelines&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Esb&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Newtonsoft.Json, Version=12.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d7p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type14319b688cb4f25860c22f90919431&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="SplitterPipelineStepOfESBMessageESBMessageu6r3vdAt"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;09877064-db14-41c2-8507-72ea5e968c45&lt;/Id&gt;&lt;Name&gt;Split and Join&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Aggregator i:type="NullAggregatorOfESBMessageESBMessageu6r3vdAt" /&gt;&lt;Executor i:type="SynchronousSplitExecutorOfESBMessagexAPWb1W4" /&gt;&lt;ForEach&gt;&lt;Bindings xmlns:d8p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;0316fc5b-89d3-44a9-a6c9-3086355f4c54&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d9p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d9p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d10p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;c41fd1e2-22d7-4e62-a1ec-f5b604902ccb&lt;/Id&gt;&lt;Name&gt;Trace Msg&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d10p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;context.Instance.TraceInformation(" OSC AFTER SPLIT : " + context.Data.Text);

System.Xml.XmlDocument xDoc = context.Data.ToXmlDocument();&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d10p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d10p1:string&gt;Neuron&lt;/d10p1:string&gt;&lt;d10p1:string&gt;Neuron.Pipelines&lt;/d10p1:string&gt;&lt;d10p1:string&gt;Neuron.Esb&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;Newtonsoft.Json, Version=12.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d10p1:string&gt;&lt;d10p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d10p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type65f2da08a2f4a08bffa3026c9d7ca1&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d9p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d9p1:EsbMessageBodyXslTransformPipelineStep"&gt;&lt;Bindings xmlns:d10p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;06da63f5-1d36-47e6-a1ff-2b8e9cb56a8f&lt;/Id&gt;&lt;Name&gt;Neo To B2MML&lt;/Name&gt;&lt;Uniquename /&gt;&lt;EnableDocumentFunction&gt;false&lt;/EnableDocumentFunction&gt;&lt;EnableScript&gt;false&lt;/EnableScript&gt;&lt;Parameters /&gt;&lt;TransformXml i:nil="true" /&gt;&lt;d9p1:XsltLocation i:nil="true" /&gt;&lt;d9p1:XsltName&gt;Neo OrderStepCompletion To B2MML ProcessOperationsPerformance&lt;/d9p1:XsltName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d9p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d9p1:EsbMessageSchemaValidationPipelineStep"&gt;&lt;Bindings xmlns:d10p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;a9c867a9-8093-43c1-a5b9-11855dc84d7b&lt;/Id&gt;&lt;Name&gt;Validate - B2MML&lt;/Name&gt;&lt;Uniquename /&gt;&lt;OnInvalid&gt;&lt;Bindings xmlns:d11p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;f80421f7-4065-4485-9c42-f95dbf09e0be&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="CancelPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d13p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;98aafa65-4fe0-4ddb-8899-a6110c76973c&lt;/Id&gt;&lt;Name&gt;Cancel&lt;/Name&gt;&lt;Uniquename /&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/OnInvalid&gt;&lt;OnValid&gt;&lt;Bindings xmlns:d11p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;23a256bf-323d-4818-8651-acc7cf799c5e&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="d9p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d13p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;5c6e5e0b-f802-4576-af40-46dc40f7c402&lt;/Id&gt;&lt;Name&gt;Trace B2MML&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d13p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;context.Instance.TraceInformation("SCHEMA VALIDATION SUCCESS. B2MML OSC : " + context.Data.Text);&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d13p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d13p1:string&gt;Neuron&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Neuron.Pipelines&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Neuron.Esb&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Newtonsoft.Json, Version=12.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d13p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type058ab605ba74a6a8ac37e9c6cba747&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="d9p1:EsbMessageBodyXslTransformPipelineStep"&gt;&lt;Bindings xmlns:d13p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;e0cdb258-5a2d-49c3-aed2-da8684369089&lt;/Id&gt;&lt;Name&gt;B2MML To IDOC&lt;/Name&gt;&lt;Uniquename /&gt;&lt;EnableDocumentFunction&gt;false&lt;/EnableDocumentFunction&gt;&lt;EnableScript&gt;false&lt;/EnableScript&gt;&lt;Parameters /&gt;&lt;TransformXml i:nil="true" /&gt;&lt;d9p1:XsltLocation i:nil="true" /&gt;&lt;d9p1:XsltName&gt;B2MML ProcessOperationsPerformance To IDOC OrderStepCompletion&lt;/d9p1:XsltName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="d9p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d13p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;0a100775-c233-4e5d-9fc7-65057bcb5543&lt;/Id&gt;&lt;Name&gt;Trace IDOC&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d13p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;context.Instance.TraceInformation("OSC IDOC : " + context.Data.Text);&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d13p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d13p1:string&gt;Neuron&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Neuron.Pipelines&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Neuron.Esb&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Newtonsoft.Json, Version=12.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d13p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type64c7f727de541b7a044f4b9ce02ad7&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="d9p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d13p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;d44f776e-d176-4782-93c5-f2ea1626b131&lt;/Id&gt;&lt;Name&gt;Map to Publish to ActiveMQ&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d13p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;context.Data.Header.SourceId = "ActiveMQ_SAP_Publisher";

System.Xml.XmlDocument xmlDocument = context.Data.ToXmlDocument();

string changedXml = xmlDocument.OuterXml;
XDocument doc = XDocument.Parse(changedXml);
string formattedXml = doc.ToString(SaveOptions.None);

context.Instance.TraceInformation("FINAL OSC XML: " + formattedXml);

context.Properties["OSCFinalMessage"] = formattedXml;

context.Data.Text = formattedXml;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d13p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d13p1:string&gt;Neuron&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Neuron.Pipelines&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Neuron.Esb&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Newtonsoft.Json, Version=12.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d13p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typecb81a6573d3498dadaf8f6e7334c8b&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="d9p1:EsbMessagePublishPipelineStep"&gt;&lt;Bindings xmlns:d13p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;2a64b199-3cdd-4d01-aea0-fa884fdb140d&lt;/Id&gt;&lt;Name&gt;Publish to ActiveMQ&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d9p1:Semantic&gt;Multicast&lt;/d9p1:Semantic&gt;&lt;d9p1:Timeout&gt;60&lt;/d9p1:Timeout&gt;&lt;d9p1:TopicSelector i:type="d9p1:ESBMessageConstTopicSelector"&gt;&lt;d9p1:Topic&gt;ActiceMQ.SAP&lt;/d9p1:Topic&gt;&lt;/d9p1:TopicSelector&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="d9p1:ExecuteAdapterPipelineStep"&gt;&lt;Bindings xmlns:d13p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;c4d2f66e-3c3c-46dc-a6d1-1403c5c878c4&lt;/Id&gt;&lt;Name&gt;Execute Adapter&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d9p1:AdapterName&gt;File Save Endpoint OrderStepCompletion&lt;/d9p1:AdapterName&gt;&lt;d9p1:AdapterPoolTimeout&gt;PT1M&lt;/d9p1:AdapterPoolTimeout&gt;&lt;d9p1:MaxAdapterInstances&gt;100&lt;/d9p1:MaxAdapterInstances&gt;&lt;d9p1:Timeout&gt;PT1M&lt;/d9p1:Timeout&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="d9p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d13p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;3ee0c450-b260-490d-b3d7-761b3d90d481&lt;/Id&gt;&lt;Name&gt;Map To Message Arrival Notification&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d13p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Retrieve the response template message
string messageArrivalNotificationTemplate = context.Configuration.XmlDocs["ESB Message Arrival Notification Message"].Xml;

string message = System.Net.WebUtility.HtmlEncode ( context.Properties["OSCFinalMessage"].ToString() );

// Get the data together to send the Business Error Message
string endpointAddress = context.Data.Header.To;
string eSBAction = context.Data.Header.Action;
string eSBTopic = "Order Step Completion Send " + "-MessageArrival";
string sourceSystemID = ""; 
string plantID = "";
string transactionID =  "";
string messageDate = context.Data.Header.Created.ToString("yyyy-MM-ddTHH:mm:ssZ");
string successMessage = "";

// Create the request message
string messageArrivalNotification = string.Format (messageArrivalNotificationTemplate, endpointAddress, 
	                                               eSBAction, eSBTopic, sourceSystemID, plantID, 
	                                               transactionID, messageDate, message, successMessage);

// Set message context to the request message 	
context.Data.Text = messageArrivalNotification;

context.Instance.TraceInformation(" CONTEXT DATA OSC SEND : " + context.Data.Text); &lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d13p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d13p1:string&gt;Neuron&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Neuron.Pipelines&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Neuron.Esb&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d13p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type60603bd296e40bbb0cc0fdebdd9076&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="d9p1:EsbMessagePublishPipelineStep"&gt;&lt;Bindings xmlns:d13p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;5da8c967-4c6e-4213-83a3-a49e3ee605d3&lt;/Id&gt;&lt;Name&gt;Message Arrival Notification&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d9p1:Semantic&gt;Multicast&lt;/d9p1:Semantic&gt;&lt;d9p1:Timeout&gt;0&lt;/d9p1:Timeout&gt;&lt;d9p1:TopicSelector i:type="d9p1:ESBMessageConstTopicSelector"&gt;&lt;d9p1:Topic&gt;MessageArrivalNotification&lt;/d9p1:Topic&gt;&lt;/d9p1:TopicSelector&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/OnValid&gt;&lt;Properties xmlns:d10p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Schemas xmlns:d10p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;ValidationFlags&gt;ReportValidationWarnings&lt;/ValidationFlags&gt;&lt;d9p1:SchemaLocation i:nil="true" /&gt;&lt;d9p1:SchemaNames&gt;AllSchemas.xsd&lt;/d9p1:SchemaNames&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/ForEach&gt;&lt;MaxThreadCount&gt;10&lt;/MaxThreadCount&gt;&lt;Splitter xmlns:d7p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d7p1:XPathEsbMessageSplitter"&gt;&lt;d7p1:XPath&gt;OrderStepCompletions/OrderStepCompletion&lt;/d7p1:XPath&gt;&lt;/Splitter&gt;&lt;TurnOffTrackExecution&gt;true&lt;/TurnOffTrackExecution&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Try&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Steps&gt;&lt;/ESBMessagePipeline&gt;</PipelineBlob>
  <IsProcessFlow>false</IsProcessFlow>
</ESBMessagePipelineStorage>