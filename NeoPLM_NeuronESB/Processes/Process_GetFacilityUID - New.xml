<?xml version="1.0"?>
<ESBMessagePipelineStorage xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <Id>9c751cd3-4e3b-488c-a0db-7c98d04d4f58</Id>
  <Version>4050ee22-35f5-484d-8e1f-7978bdf167e2</Version>
  <BusinessFlows />
  <Description />
  <Name>Process_GetFacilityUID - New</Name>
  <IsSystemObject>false</IsSystemObject>
  <IsPrivate>false</IsPrivate>
  <Category>General</Category>
  <IsEncrypted>true</IsEncrypted>
  <Path>New Data Enhancement Functions</Path>
  <PipelineBlob>&lt;ESBMessagePipeline xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://schemas.neuronesb.com/pipelines/"&gt;&lt;Category&gt;General&lt;/Category&gt;&lt;Description i:nil="true" /&gt;&lt;GlobalProperties xmlns:d2p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Name&gt;Process_GetFacilityUID - New&lt;/Name&gt;&lt;Properties xmlns:d2p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;ReferencedAssemblies xmlns:d2p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" i:nil="true" /&gt;&lt;Steps&gt;&lt;ESBMessagePipelineStep i:type="ExceptionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d4p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;bdfebeb2-1a5b-4f9b-a47b-433fa95a5011&lt;/Id&gt;&lt;Name&gt;Exception&lt;/Name&gt;&lt;Uniquename&gt;2247bf33-6d44-4df2-b2ce-1daf7f7faacc&lt;/Uniquename&gt;&lt;Catch&gt;&lt;Bindings xmlns:d5p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;8d692838-45a9-472b-a2dd-eea7e9e205cb&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;true&lt;/Disable&gt;&lt;Id&gt;bdc9239e-242a-4d27-a825-e49c25424b26&lt;/Id&gt;&lt;Name&gt;Exception Catch&lt;/Name&gt;&lt;Uniquename&gt;0b06fe0d-105d-4fba-8001-469327f8d059&lt;/Uniquename&gt;&lt;BreakPointLines xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;	// This logic is here to support the debugging of this subroutine, within the Neuron Development environment.  It is expected that the outermost parent process, will 
	// will trap this error and handle it appropriately.
	
	PipelineException parentEx = (PipelineException)context.Properties["PipelineException"];

	string newExceptionMessag = String.Format(System.Globalization.CultureInfo.InvariantCulture,
	            "Pipeline Error - Type: {0} Message: {1} \r\nSource Pipeline: {2}\r\nSource Pipeline Step: {3}\r\nSource Error Message: {4}",
	                                    	parentEx.InnerException.GetType().ToString(),
											parentEx.Message,
	                                        parentEx.Pipeline, 
	                                        parentEx.PipelineStep, 
	                                        (parentEx.InnerException != null ? parentEx.InnerException.Message : ""));
	
	context.Instance.TraceInformation(newExceptionMessag);

	&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d7p1:string&gt;Neuron&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Pipelines&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Esb&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d7p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typec181a9d4b224c7289e7791a0b89f38&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="RethrowPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;898941da-367d-46cb-82b0-8882c0968025&lt;/Id&gt;&lt;Name&gt;Rethrow&lt;/Name&gt;&lt;Uniquename&gt;f998da7f-15bd-4ddb-8b69-b04acd9dc7b9&lt;/Uniquename&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Catch&gt;&lt;Finally&gt;&lt;Bindings xmlns:d5p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;81f4bbc5-af3f-48d0-8820-8f670e8ff74e&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children /&gt;&lt;/Finally&gt;&lt;Try&gt;&lt;Bindings xmlns:d5p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;78223faa-cc35-4fc2-b0a5-ade3fefca9eb&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;2a665068-4181-4c26-8984-faa40765d65c&lt;/Id&gt;&lt;Name&gt;Title Trace&lt;/Name&gt;&lt;Uniquename&gt;2936f8cc-0b15-4ca5-8d40-ac58398a2eb4&lt;/Uniquename&gt;&lt;BreakPointLines xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// This process is a sub process and is expected to be called from one or more parent processes.  It interacts with the Neo PLM Global
// Integration Service, for the purpose of:
// 	  1) Determining if the Source System ID and Plant Code ID, provided on the message, can be resolved to a facility, known to Neo PLM.
//		2) Enhancing the incoming message with the Neo PLM facility context, for use in downstream processing.

// This process with accept an XML message in the form of 
// &amp;lt;FacilityLookup&amp;gt;
// 		&amp;lt;SourceSystemID&amp;gt;Europe2&amp;lt;/SourceSystemID&amp;gt;
//		&amp;lt;PlantID&amp;gt;BEP7&amp;lt;/PlantID&amp;gt;
// &amp;lt;/FacilityLookup&amp;gt;

// It will return an XML message in the form of 
// &amp;lt;Facility&amp;gt;
//			&amp;lt;UID&amp;gt;12345678-1234-1234-1234-123456789012&amp;lt;/UID&amp;gt;
// &amp;lt;/Facility&amp;gt;

// In the event of a messaging failure between Neuron ESB and Neo PLM Global Integration service, an exception will be generated by this 
// Sub Process.  It will be assumed that this type of exception will be handled by the parent (calling) process.

// There are two optional arguments that may be supplied as message properties, attached to the incoming message to this sub process.
//     1) EmptyGuidIsValid - A property that contains either the string "True" or "False".  If the referenced property exists, and is 
//        set to True, then returned value may contain an Empty Guid.  Otherwise, a failed lookup will result in a business exception on 
//				the message, and as such will result in a business notification to interested users.  
//		 2) InputMessageItem - A property that contains the original business Input Message Item, such as a material definition, a material lot,
//        etc. from which the look up data was extracted.  This information is used to create a meaningful error message, to be returned
//				to a business user.

context.Instance.TraceInformation ("   *****************************************");
context.Instance.TraceInformation ("   Get FacilityUID - Message ID: " + context.Data.Header.MessageId.ToString());
context.Instance.TraceInformation ("");
context.Instance.TraceInformation ("  Get FacilityUID - Message ID: " + context.Data.Header.MessageId.ToString() + " Input Message: " + context.Data.Text);&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d7p1:string&gt;Neuron&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Pipelines&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Esb&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typeaab60b377a04e118aae4aa7c56a7cd&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageSchemaValidationPipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;9b2c97c8-bcc5-4eed-a184-19345f7703e8&lt;/Id&gt;&lt;Name&gt;Validation Message Schema&lt;/Name&gt;&lt;Uniquename&gt;d67f4639-004c-4324-9b4c-41b13c418bbb&lt;/Uniquename&gt;&lt;OnInvalid&gt;&lt;Bindings xmlns:d8p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;465840ab-1eca-4e3d-b067-447be9b46e15&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="RethrowPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d10p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;46fb5fdf-eea5-4b4c-ab83-0cc82dfeb994&lt;/Id&gt;&lt;Name&gt;Rethrow the Schema Validation Error&lt;/Name&gt;&lt;Uniquename&gt;c0acaf04-d7c5-42bb-a303-40eaf35bae62&lt;/Uniquename&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/OnInvalid&gt;&lt;OnValid&gt;&lt;Bindings xmlns:d8p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;8d2e5bd3-9a17-4d6e-820e-6c3a0f5d1b12&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="DecisionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d10p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;b413503e-9da0-4815-981a-cd270712c166&lt;/Id&gt;&lt;Name&gt;Expected Message?&lt;/Name&gt;&lt;Uniquename&gt;92f9acb1-bc36-4d13-91de-2d27103dec71&lt;/Uniquename&gt;&lt;Branches&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="CodeBranchConditionOfESBMessagexAPWb1W4"&gt;&lt;Code&gt;System.Xml.XmlDocument xDoc = context.Data.ToXmlDocument();

string messageType = xDoc.DocumentElement.LocalName;

if (messageType == "FacilityRequest")
	return true;
else
	return false;
&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d13p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d13p1:string&gt;Neuron&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Neuron.Pipelines&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Neuron.Esb&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d13p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Expected Message Type&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d13p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;3d76470f-937b-4ea9-bf9f-391d04d5b150&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="d6p1:JsonXmlProcessStep"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;a1231dac-9815-473d-9a31-e0432a5e1044&lt;/Id&gt;&lt;Name&gt;JsonXmlProcessStep&lt;/Name&gt;&lt;Uniquename&gt;deed57f2-448f-4574-b745-d63704a7a4a5&lt;/Uniquename&gt;&lt;d6p1:ConversionTo&gt;JSON&lt;/d6p1:ConversionTo&gt;&lt;d6p1:DateTimeConvertFormat&gt;yyyy-MM-ddTHH:mm:ss.fffffffzzz&lt;/d6p1:DateTimeConvertFormat&gt;&lt;d6p1:ExcludeXmlRoot&gt;true&lt;/d6p1:ExcludeXmlRoot&gt;&lt;d6p1:IncludeObjectTypes&gt;false&lt;/d6p1:IncludeObjectTypes&gt;&lt;d6p1:IncludeXmlDeclaration&gt;true&lt;/d6p1:IncludeXmlDeclaration&gt;&lt;d6p1:RemoveXmlNamespaces&gt;true&lt;/d6p1:RemoveXmlNamespaces&gt;&lt;d6p1:Root i:nil="true" /&gt;&lt;d6p1:TreatNullHandling&gt;None&lt;/d6p1:TreatNullHandling&gt;&lt;d6p1:TypeName i:nil="true" /&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;67545bf1-ef25-424b-a530-77e67389ae56&lt;/Id&gt;&lt;Name&gt;Setup Facility Request&lt;/Name&gt;&lt;Uniquename&gt;5658a2ac-6749-4cc2-94de-020ea6213c25&lt;/Uniquename&gt;&lt;BreakPointLines xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;Newtonsoft.Json.Linq.JObject inputMessage = context.Data.ToJObject();

var facility = inputMessage.ToObject &amp;lt;dynamic&amp;gt; ();

context.Instance.TraceInformation("HB11");

context.Instance.TraceInformation("   Get FacilityUID - Message ID: " + context.Data.Header.MessageId.ToString() + " SourceSystemID: " + facility.SourceSystemID + " PlantID: " + facility.PlantCodeID);

//Save Original Message Context 
if (context.Properties.ContainsKey("FacilityInput"))
{
	context.Properties.Remove ("FacilityInput");
	context.Properties.Add ("FacilityInput", context.Data.Clone(true));
}
else
{
	context.Properties.Add ("FacilityInput", context.Data.Clone(true));
}

// Setup Communication Retry Properties
context.Data.SetProperty ("Neo", "CommSuccess", "false");
context.Data.SetProperty ("Neo", "RetryCount", "0");
&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d15p1:string&gt;Neuron&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Pipelines&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Esb&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typea37db829afc4c968cf801137229c84&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="RestPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;d3421144-906f-4f06-ad69-9367ddc1313f&lt;/Id&gt;&lt;Name&gt;Setup Rest Call Context&lt;/Name&gt;&lt;Uniquename&gt;ddda9d2f-1e42-4a32-a36f-05839004466d&lt;/Uniquename&gt;&lt;SerializableCurrentRestRequest&gt;&amp;lt;?xml version="1.0" encoding="utf-16"?&amp;gt;&amp;lt;RestRequest xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&amp;gt;&amp;lt;Method&amp;gt;GET&amp;lt;/Method&amp;gt;&amp;lt;URI&amp;gt;ExternalSystems/GetFacilityUidForLocalMaterialSpecification&amp;lt;/URI&amp;gt;&amp;lt;Body /&amp;gt;&amp;lt;BodyType&amp;gt;Raw&amp;lt;/BodyType&amp;gt;&amp;lt;BodyFormat&amp;gt;XML&amp;lt;/BodyFormat&amp;gt;&amp;lt;DeleteMessageBody&amp;gt;true&amp;lt;/DeleteMessageBody&amp;gt;&amp;lt;DeleteResponseBody&amp;gt;false&amp;lt;/DeleteResponseBody&amp;gt;&amp;lt;Parameters&amp;gt;&amp;lt;ParameterDataElement&amp;gt;&amp;lt;Key&amp;gt;sourceSystemId&amp;lt;/Key&amp;gt;&amp;lt;Value&amp;gt;{#JObject.SourceSystemID}&amp;lt;/Value&amp;gt;&amp;lt;/ParameterDataElement&amp;gt;&amp;lt;ParameterDataElement&amp;gt;&amp;lt;Key&amp;gt;plantCode&amp;lt;/Key&amp;gt;&amp;lt;Value&amp;gt;{#JObject.PlantCodeID}&amp;lt;/Value&amp;gt;&amp;lt;/ParameterDataElement&amp;gt;&amp;lt;/Parameters&amp;gt;&amp;lt;Headers&amp;gt;&amp;lt;HeaderDataElement&amp;gt;&amp;lt;Key&amp;gt;Accept&amp;lt;/Key&amp;gt;&amp;lt;Value&amp;gt;application/xml&amp;lt;/Value&amp;gt;&amp;lt;/HeaderDataElement&amp;gt;&amp;lt;/Headers&amp;gt;&amp;lt;AdapterEndpointProperties /&amp;gt;&amp;lt;BodyProperties&amp;gt;&amp;lt;BodyDataElement&amp;gt;&amp;lt;Key&amp;gt;sourceSystemID&amp;lt;/Key&amp;gt;&amp;lt;Value&amp;gt;{#JObject.SourceSystemID}&amp;lt;/Value&amp;gt;&amp;lt;/BodyDataElement&amp;gt;&amp;lt;BodyDataElement&amp;gt;&amp;lt;Key&amp;gt;plantID&amp;lt;/Key&amp;gt;&amp;lt;Value&amp;gt;{#JObject.PlantID}&amp;lt;/Value&amp;gt;&amp;lt;/BodyDataElement&amp;gt;&amp;lt;/BodyProperties&amp;gt;&amp;lt;TestEnabled&amp;gt;FALSE&amp;lt;/TestEnabled&amp;gt;&amp;lt;TestFormat&amp;gt;TEXT&amp;lt;/TestFormat&amp;gt;&amp;lt;MaxPoolSize&amp;gt;1&amp;lt;/MaxPoolSize&amp;gt;&amp;lt;PoolTimeOut&amp;gt;1000&amp;lt;/PoolTimeOut&amp;gt;&amp;lt;AuditRequest&amp;gt;false&amp;lt;/AuditRequest&amp;gt;&amp;lt;AuditResponses&amp;gt;false&amp;lt;/AuditResponses&amp;gt;&amp;lt;AuditFailures&amp;gt;false&amp;lt;/AuditFailures&amp;gt;&amp;lt;/RestRequest&amp;gt;&lt;/SerializableCurrentRestRequest&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="WhilePipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;4c89b84a-689f-47c9-8fe2-6e27110d4aaf&lt;/Id&gt;&lt;Name&gt;While Comm Failed&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="ExceptionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d17p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;9254e9d0-ac97-4985-af82-5df5de3b20c4&lt;/Id&gt;&lt;Name&gt;Exception&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Catch&gt;&lt;Bindings xmlns:d18p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;9df50ca7-9d44-4071-90f0-80107c151acd&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="DecisionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;5b595448-0928-4b73-a628-38f2ffd22a84&lt;/Id&gt;&lt;Name&gt;Retry Count&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Branches&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="CodeBranchConditionOfESBMessagexAPWb1W4"&gt;&lt;Code&gt;int count = System.Convert.ToInt32 (context.Data.GetProperty ("Neo", "RetryCount"));
int numRetries = System.Convert.ToInt32 (context.EnvironmentVariables["NeoServicesNumberofRetries"]);

if (count &amp;lt; numRetries)
{	
	// Increment counter
	count = count + 1;
	context.Data.SetProperty ("Neo", "RetryCount", count.ToString());
	context.Instance.TraceInformation ("Communication Failed.  Start of Retry Cycle " + count);
	
	return true;
}
else
{
	context.Instance.TraceInformation ("Communication Failed.  Retries Exhausted.  Rethrow Exception");
	return false;
}&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d23p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d23p1:string&gt;Neuron&lt;/d23p1:string&gt;&lt;d23p1:string&gt;Neuron.Pipelines&lt;/d23p1:string&gt;&lt;d23p1:string&gt;Neuron.Esb&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d23p1:string&gt;&lt;d23p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d23p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;If&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d23p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;5bbbea85-1df8-48c2-bc2c-784b29b6fbb5&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d25p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;57d6acd3-ff16-43bf-ac5a-b72b73492da6&lt;/Id&gt;&lt;Name&gt;Wait Time and Retry&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d25p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;int timeoutValue = System.Convert.ToInt32 (context.EnvironmentVariables["NeoServicesRetryInterval"]) * 1000;

System.Threading.Thread.Sleep (timeoutValue);

context.Instance.TraceInformation ("Communications Failure with Neo PLM.  Retrying....");&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d25p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d25p1:string&gt;Neuron&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Neuron.Pipelines&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Neuron.Esb&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d25p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typecde6b061d0f411596a785fde1d8e73&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="AlwaysBranchConditionOfESBMessagexAPWb1W4" /&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Else&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d23p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;51a66a14-f3a6-4bd4-bac8-7df3d6b562eb&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="RethrowPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d25p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;159f3b8f-4092-4c8a-afc8-efeb379bd031&lt;/Id&gt;&lt;Name&gt;Rethrow&lt;/Name&gt;&lt;Uniquename /&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;/Branches&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Catch&gt;&lt;Finally&gt;&lt;Bindings xmlns:d18p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;e28da39e-d897-47cf-a449-555653362e1e&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children /&gt;&lt;/Finally&gt;&lt;Try&gt;&lt;Bindings xmlns:d18p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;5e8bd40d-2cf7-44f1-8169-ebb42275d6aa&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageServiceEndpointPipelineStep"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;57c5c1a0-44c2-46ac-8ae3-db2ea3a98913&lt;/Id&gt;&lt;Name&gt;Get Facility Endpoint&lt;/Name&gt;&lt;Uniquename&gt;efd5253d-954e-46ae-bd07-a34fc30b9073&lt;/Uniquename&gt;&lt;d6p1:Category&gt;General&lt;/d6p1:Category&gt;&lt;d6p1:Description&gt;This service serves as a proxy for the external service that is provided by Neo PLM, Inc.  It is here for ease of configuration only.  Nothing is ever processed by this item.&lt;/d6p1:Description&gt;&lt;d6p1:MaxServiceInstances&gt;100&lt;/d6p1:MaxServiceInstances&gt;&lt;d6p1:MessagePattern&gt;Request-Reply&lt;/d6p1:MessagePattern&gt;&lt;d6p1:Policy&gt;Service Proxy Policy&lt;/d6p1:Policy&gt;&lt;d6p1:ServiceBinding&gt;REST&lt;/d6p1:ServiceBinding&gt;&lt;d6p1:ServiceConnector&gt;NeoPLM Global Integration Service - Rest Transaction Proxy&lt;/d6p1:ServiceConnector&gt;&lt;d6p1:ServiceId&gt;9411f3f1-3ad4-4801-a45d-85c0e34bb1c1&lt;/d6p1:ServiceId&gt;&lt;d6p1:ServicePoolTimeout&gt;PT1M&lt;/d6p1:ServicePoolTimeout&gt;&lt;d6p1:ServiceUrl&gt;http://build.neoplm.com/&lt;/d6p1:ServiceUrl&gt;&lt;d6p1:ThrowExceptionOnFault&gt;true&lt;/d6p1:ThrowExceptionOnFault&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;60a59f2e-0847-4c2c-9b09-6a5f9e1a1db6&lt;/Id&gt;&lt;Name&gt;Set Comm Successful&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d20p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Set Communication Success
context.Data.SetProperty ("Neo", "CommSuccess", "true");

context.Instance.TraceInformation ("Communication Success.");
&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d20p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d20p1:string&gt;Neuron&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Neuron.Pipelines&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Neuron.Esb&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d20p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typed86a6fa43014865a8da4028bd205e3&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Try&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;Condition&gt;&lt;Code&gt;//if (context.Data.GetProperty("Neo", "CommSuccess") == "false")
//	return true;
//else
//	return false;
return context.Data.GetProperty("Neo", "CommSuccess") != "true";&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d16p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d16p1:string&gt;Neuron&lt;/d16p1:string&gt;&lt;d16p1:string&gt;Neuron.Pipelines&lt;/d16p1:string&gt;&lt;d16p1:string&gt;Neuron.Esb&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d16p1:string&gt;&lt;d16p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d16p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;TurnOffTrackExecution&gt;false&lt;/TurnOffTrackExecution&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;1de7ac10-859b-4d41-a547-224d4c250ec6&lt;/Id&gt;&lt;Name&gt;Facility Response&lt;/Name&gt;&lt;Uniquename&gt;95faecd4-8754-47b1-99c6-0a12f779a89f&lt;/Uniquename&gt;&lt;BreakPointLines xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Raw response message is in xml format
System.Xml.XmlDocument xDoc = context.Data.ToXmlDocument();
System.Guid facilityGuid;

// Parse it and if if it is a guid, then proceed, if not then proceed, otherwise throw a system exception.
if (System.Guid.TryParse(xDoc.DocumentElement.FirstChild.InnerText, out facilityGuid)  == false)
	{
		throw new System.Exception ("The Facility Lookup service returned a value that was not a GUID.");		
	}
	
// Restore Input Message	
context.Data = (ESBMessage) context.Properties["FacilityInput"];	
	
context.Instance.TraceInformation ("Get FacilityUID - Message ID: " + context.Data.Header.MessageId.ToString() + " FacilityUID: " + facilityGuid.ToString());

// Make a dynamic object out of the original message
Newtonsoft.Json.Linq.JObject inputMessage = context.Data.ToJObject();
var facilityRequest = inputMessage.ToObject &amp;lt;dynamic&amp;gt; ();
	
// Retrieve the response template message
string facilityResponseTemplate = context.Configuration.XmlDocs["FacilityResponse"].Xml;
	
// Create the response message
string facilityResponse = string.Format(facilityResponseTemplate, facilityRequest.TransactionID, facilityRequest.SourceSystemID, facilityRequest.PlantCodeID, facilityGuid.ToString());

//Send the trace message to document the response message.
context.Instance.TraceInformation ("Get FacilityUID - Message ID: " + context.Data.Header.MessageId.ToString() + " Response Message: " + facilityResponse);
	
// Set message context to the response message 	
context.Data.Text = facilityResponse;

// Set a message property to control the optional message routing, based on data in the input message.
context.Data.SetProperty ("NeoPLM", "EmptyGuidIsAllowed", facilityRequest.EmptyGuidIsAllowed.ToString());
context.Data.SetProperty ("NeoPLM", "FacilityUID", facilityGuid.ToString());
context.Data.SetProperty ("NeoPLM", "OriginalMessage", facilityRequest.OriginalMessage.ToString());
	&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d15p1:string&gt;Neuron&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Pipelines&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Esb&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type2d667d49de04a2aa74cf0506c2b222&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="DecisionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;7b5c816b-e4df-406a-b822-052c8ad0f60f&lt;/Id&gt;&lt;Name&gt;Disposition Response Message&lt;/Name&gt;&lt;Uniquename&gt;0938be3e-f88f-4298-9984-ac5dfb16fcb1&lt;/Uniquename&gt;&lt;Branches&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="CodeBranchConditionOfESBMessagexAPWb1W4"&gt;&lt;Code&gt;if (context.Data.GetProperty("NeoPLM", "EmptyGuidIsAllowed").ToUpper() == "TRUE" || context.Data.GetProperty("NeoPLM", "FacilityUID") != System.Guid.Empty.ToString())
{
	context.Data.SetProperty("NeoPLM", "LookupError", "False");
	return true;
}
else
{
	context.Data.SetProperty("NeoPLM", "LookupError", "True");
	return false;
}	
&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d18p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d18p1:string&gt;Neuron&lt;/d18p1:string&gt;&lt;d18p1:string&gt;Neuron.Pipelines&lt;/d18p1:string&gt;&lt;d18p1:string&gt;Neuron.Esb&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d18p1:string&gt;&lt;d18p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d18p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Lookup Successful&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d18p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;4ba757af-9f74-4111-a0aa-e3494126e916&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children /&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="AlwaysBranchConditionOfESBMessagexAPWb1W4" /&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Unable to Resolve&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d18p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;156be02e-1eb0-4be0-a5d1-0e31989b0859&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="PushContextPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;b4dd25bd-eb5e-4631-b94b-d572874882c8&lt;/Id&gt;&lt;Name&gt;PushContext&lt;/Name&gt;&lt;Uniquename /&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="d6p1:JsonXmlProcessStep"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;6e82077a-9cd1-4574-b5fc-55d0d6f4d213&lt;/Id&gt;&lt;Name&gt;JsonXmlProcessStep&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d6p1:ConversionTo&gt;JSON&lt;/d6p1:ConversionTo&gt;&lt;d6p1:DateTimeConvertFormat&gt;yyyy-MM-ddTHH:mm:ss.fffffffzzz&lt;/d6p1:DateTimeConvertFormat&gt;&lt;d6p1:ExcludeXmlRoot&gt;true&lt;/d6p1:ExcludeXmlRoot&gt;&lt;d6p1:IncludeObjectTypes&gt;false&lt;/d6p1:IncludeObjectTypes&gt;&lt;d6p1:IncludeXmlDeclaration&gt;true&lt;/d6p1:IncludeXmlDeclaration&gt;&lt;d6p1:RemoveXmlNamespaces&gt;true&lt;/d6p1:RemoveXmlNamespaces&gt;&lt;d6p1:Root i:nil="true" /&gt;&lt;d6p1:TreatNullHandling&gt;None&lt;/d6p1:TreatNullHandling&gt;&lt;d6p1:TypeName i:nil="true" /&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;a704c0c0-919f-4427-b1a6-efdbe2b0df68&lt;/Id&gt;&lt;Name&gt;Create Error Message&lt;/Name&gt;&lt;Uniquename&gt;1d410ffd-c6b4-4871-9313-b1a12c9d4e91&lt;/Uniquename&gt;&lt;BreakPointLines xmlns:d20p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;context.Instance.TraceInformation ("Get FacilityUID - Message ID: " + context.Data.Header.MessageId.ToString() + " The facility UID could not be resolved.  Send Business Error Message and Stop processing.");

// Make a dynamic object out of the original message
Newtonsoft.Json.Linq.JObject inputMessage = context.Data.ToJObject();
var facilityResponse = inputMessage.ToObject &amp;lt;dynamic&amp;gt; ();

// Get the data together to send the Business Error Message
string endpointAddress = context.Data.Header.Action;
string eSBAction = context.Data.Header.Action;
string eSBTopic = context.Data.Header.Topic;
eSBTopic = eSBTopic.Replace("Enrich_", "") + "-Errors";
string sourceSystemID = facilityResponse.SourceSystemID; 
string plantID = facilityResponse.PlantCodeID;
string transactionID = facilityResponse.TransactionID;
string messageDate = context.Data.Header.Created.ToString("yyyy-MM-ddTHH:mm:ssZ");
string errorCode = "1001";
string errorParameter = "Source System ID: " + facilityResponse.SourceSystemID + ", Plant ID: " + facilityResponse.PlantCodeID;
string errorMessage = "The Neo PLM Facility could not be found based on the Source System ID and the PlantID provided.";
string originalMessage = System.Net.WebUtility.HtmlEncode (context.Data.GetProperty ("NeoPLM", "OriginalMessage"));

context.Instance.TraceInformation (plantID);

// Get the business error template
string errorTemplate = context.Configuration.XmlDocs["ESB Business Error Message"].Xml;

string eSBErrorMessage = string.Format(errorTemplate, endpointAddress, eSBAction, eSBTopic, sourceSystemID, plantID, transactionID, messageDate, errorCode, errorMessage, originalMessage);

//Set Values for Error Properties
context.Properties["ErrorMessage"] = eSBErrorMessage;
context.Properties["ErrorTypeID"] = errorCode;
context.Properties["ErrorParameter"] = errorParameter;

context.Data.Text = eSBErrorMessage;	
&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d20p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d20p1:string&gt;Neuron&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Neuron.Pipelines&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Neuron.Esb&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d20p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typefe031f105404189bcaba2e2f628f34&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessagePublishPipelineStep"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;true&lt;/Disable&gt;&lt;Id&gt;7f12b775-0c96-4a09-8e24-6f89607c048c&lt;/Id&gt;&lt;Name&gt;Publish&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d6p1:Semantic&gt;Multicast&lt;/d6p1:Semantic&gt;&lt;d6p1:Timeout&gt;0&lt;/d6p1:Timeout&gt;&lt;d6p1:TopicSelector i:type="d6p1:ESBMessageConstTopicSelector"&gt;&lt;d6p1:Topic&gt;ESBError&lt;/d6p1:Topic&gt;&lt;/d6p1:TopicSelector&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessagePipelineExecutionPipelineStep"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;780f91d7-a2bf-4ab5-8a06-ac4235df662b&lt;/Id&gt;&lt;Name&gt;ODBC Logging&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d6p1:FileName i:nil="true" /&gt;&lt;d6p1:MaxInstances&gt;100&lt;/d6p1:MaxInstances&gt;&lt;d6p1:PipelineName&gt;ODBC Business Error Publisher&lt;/d6p1:PipelineName&gt;&lt;d6p1:PoolTimeout&gt;PT1M&lt;/d6p1:PoolTimeout&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="PopContextPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;d3514221-5591-46d6-bcab-fce3be29b627&lt;/Id&gt;&lt;Name&gt;PopContext&lt;/Name&gt;&lt;Uniquename /&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessagePipelineExecutionPipelineStep"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;c5e28cb9-2163-4dab-907a-b3c635739379&lt;/Id&gt;&lt;Name&gt;Set Workflow Error Properties&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d6p1:FileName i:nil="true" /&gt;&lt;d6p1:MaxInstances&gt;100&lt;/d6p1:MaxInstances&gt;&lt;d6p1:PipelineName&gt;SetWorkflowErrorProperties&lt;/d6p1:PipelineName&gt;&lt;d6p1:PoolTimeout&gt;PT1M&lt;/d6p1:PoolTimeout&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;/Branches&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="AlwaysBranchConditionOfESBMessagexAPWb1W4" /&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Else&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d13p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;3ef2b1c0-f325-4faf-aa70-300a2e6cc938&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;6eccabee-081c-4e22-bf98-72fb2b3fc876&lt;/Id&gt;&lt;Name&gt;Invalid Message - Throw Exception&lt;/Name&gt;&lt;Uniquename&gt;1d410ffd-c6b4-4871-9313-b1a12c9d4e91&lt;/Uniquename&gt;&lt;BreakPointLines xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;System.Xml.Schema.XmlSchemaException xMlex= new System.Xml.Schema.XmlSchemaException("   Get FacilityUID - Message ID: " + context.Data.Header.MessageId.ToString() + " - message received did not match expected type of FacilityRequest \n\n.  Message = " + context.Data.Text);

throw xMlex;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d15p1:string&gt;Neuron&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Pipelines&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Esb&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d15p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typefe031f105404189bcaba2e2f628f34&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;/Branches&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/OnValid&gt;&lt;Properties xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Schemas xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;ValidationFlags&gt;ReportValidationWarnings&lt;/ValidationFlags&gt;&lt;d6p1:SchemaLocation i:nil="true" /&gt;&lt;d6p1:SchemaNames&gt;EnterpriseHelper;Guid&lt;/d6p1:SchemaNames&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Try&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Steps&gt;&lt;/ESBMessagePipeline&gt;</PipelineBlob>
  <IsProcessFlow>false</IsProcessFlow>
</ESBMessagePipelineStorage>