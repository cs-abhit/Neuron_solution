<?xml version="1.0"?>
<ESBMessagePipelineStorage xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <Id>fe79423e-5a7c-4c6c-bd0f-d30b2d805481</Id>
  <Version>e0c9f2fe-79a0-48ac-b77f-e7011b3c31b7</Version>
  <BusinessFlows />
  <Description />
  <Name>Process_CreateUpdateLabResultHistory</Name>
  <IsSystemObject>false</IsSystemObject>
  <IsPrivate>false</IsPrivate>
  <Category>General</Category>
  <IsEncrypted>true</IsEncrypted>
  <Path>New Data Enhancement Functions</Path>
  <PipelineBlob>&lt;ESBMessagePipeline xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://schemas.neuronesb.com/pipelines/"&gt;&lt;Category&gt;General&lt;/Category&gt;&lt;Description i:nil="true" /&gt;&lt;GlobalProperties xmlns:d2p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Name&gt;Process_CreateUpdateLabResultHistory&lt;/Name&gt;&lt;Properties xmlns:d2p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;ReferencedAssemblies xmlns:d2p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" i:nil="true" /&gt;&lt;Steps&gt;&lt;ESBMessagePipelineStep i:type="ExceptionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d4p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;cc68d9da-d477-439b-9124-9f9b016c7611&lt;/Id&gt;&lt;Name&gt;Exception&lt;/Name&gt;&lt;Uniquename&gt;2247bf33-6d44-4df2-b2ce-1daf7f7faacc&lt;/Uniquename&gt;&lt;Catch&gt;&lt;Bindings xmlns:d5p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;75a16768-1b1b-41a4-9e34-32012a0cc185&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;7cc45897-92bc-4a95-99f4-7e7f3f021f35&lt;/Id&gt;&lt;Name&gt;Exception Catch&lt;/Name&gt;&lt;Uniquename&gt;0b06fe0d-105d-4fba-8001-469327f8d059&lt;/Uniquename&gt;&lt;BreakPointLines xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;	PipelineException parentEx = (PipelineException)context.Properties["PipelineException"];

	string newExceptionMessag = String.Format(System.Globalization.CultureInfo.InvariantCulture,
	            "Pipeline Error - Type: {0} Message: {1} \r\nSource Pipeline: {2}\r\nSource Pipeline Step: {3}\r\nSource Error Message: {4}",
	                                    	parentEx.InnerException.GetType().ToString(),
											parentEx.Message,
	                                        parentEx.Pipeline, 
	                                        parentEx.PipelineStep, 
	                                        (parentEx.InnerException != null ? parentEx.InnerException.Message : ""));
	
	context.Instance.TraceInformation(newExceptionMessag);

	&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d7p1:string&gt;Neuron&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Pipelines&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Esb&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d7p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typec181a9d4b224c7289e7791a0b89f38&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="RethrowPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;1755c480-121a-44fb-9517-b3bf1097e8bb&lt;/Id&gt;&lt;Name&gt;Rethrow&lt;/Name&gt;&lt;Uniquename&gt;f998da7f-15bd-4ddb-8b69-b04acd9dc7b9&lt;/Uniquename&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Catch&gt;&lt;Finally&gt;&lt;Bindings xmlns:d5p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;a0e48935-5548-4d84-94b3-66ed09494c92&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children /&gt;&lt;/Finally&gt;&lt;Try&gt;&lt;Bindings xmlns:d5p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;4b760788-c3d4-40d7-b2eb-4e3a9a525bbe&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;47b8d85d-e63d-4701-95c2-dcfe56d84ae2&lt;/Id&gt;&lt;Name&gt;Title Trace&lt;/Name&gt;&lt;Uniquename&gt;2936f8cc-0b15-4ca5-8d40-ac58398a2eb4&lt;/Uniquename&gt;&lt;BreakPointLines xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// This process is a sub process and is expected to be called from one or more parent processes.  It interacts with the Neo PLM Local
// Integration Service, for the purpose of:
// 	    1) Creating or Updating a Lab Result History record.

//&amp;lt;?xml version="1.0" encoding="UTF-8"?&amp;gt;
//&amp;lt;!--Sample XML file generated by XMLSpy v2017 (http://www.altova.com)--&amp;gt;
//&amp;lt;n1:LabResultHistorySaveRequest xmlns:n1="http://NeoPLM.com/EnterpriseIntegration"&amp;gt;
//	&amp;lt;n1:TransactionType&amp;gt;Create/Update&amp;lt;/n1:TransactionType&amp;gt;
//	&amp;lt;n1:LocalServiceURI&amp;gt;String&amp;lt;/n1:LocalServiceURI&amp;gt;
//	&amp;lt;n1:LabTestHistoryUID&amp;gt;00000000-0000-0000-0000-000000000000&amp;lt;/n1:LabTestHistoryUID&amp;gt;
//	&amp;lt;n1:SourceRecordUniqueID&amp;gt;String&amp;lt;/n1:SourceRecordUniqueID&amp;gt;
//	&amp;lt;n1:TestResultID&amp;gt;String&amp;lt;/n1:TestResultID&amp;gt;
//	&amp;lt;n1:TestResultDescription&amp;gt;String&amp;lt;/n1:TestResultDescription&amp;gt;
//	&amp;lt;n1:TestResultStatus&amp;gt;String&amp;lt;/n1:TestResultStatus&amp;gt;
//	&amp;lt;n1:EnteredResult&amp;gt;String&amp;lt;/n1:EnteredResult&amp;gt;
//	&amp;lt;n1:DisplayResult&amp;gt;String&amp;lt;/n1:DisplayResult&amp;gt;
//	&amp;lt;n1:TestResultEngineeringLabel&amp;gt;String&amp;lt;/n1:TestResultEngineeringLabel&amp;gt;
//	&amp;lt;n1:ExpectedResult&amp;gt;String&amp;lt;/n1:ExpectedResult&amp;gt;
//	&amp;lt;n1:TestResultInstanceNumber&amp;gt;0&amp;lt;/n1:TestResultInstanceNumber&amp;gt;
//	&amp;lt;n1:IsFinalResult&amp;gt;true&amp;lt;/n1:IsFinalResult&amp;gt;
//	&amp;lt;n1:ResultDataTimeUTC&amp;gt;String&amp;lt;/n1:ResultDataTimeUTC&amp;gt;
//	&amp;lt;n1:AdditionalData&amp;gt;String&amp;lt;/n1:AdditionalData&amp;gt;
//&amp;lt;/n1:LabResultHistorySaveRequest&amp;gt;


// In the event of a messaging failure between Neuron ESB and Neo PLM Local Integration service, an exception will be generated by this 
// Sub Process.  It will be assumed that this type of exception will be handled by the parent (calling) process.


context.Instance.TraceInformation ("   *****************************************");
context.Instance.TraceInformation ("   Create / Update Lab Result History Lot - Message ID: " + context.Data.Header.MessageId.ToString());
context.Instance.TraceInformation ("");
context.Instance.TraceInformation ("  Create / Update Lab Result History - Message ID: " + context.Data.Header.MessageId.ToString() + " Input Message: " + context.Data.Text);&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d7p1:string&gt;Neuron&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Pipelines&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Esb&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typeaab60b377a04e118aae4aa7c56a7cd&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageSchemaValidationPipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;3477238c-926a-44f1-aeed-c8f065156900&lt;/Id&gt;&lt;Name&gt;Validation Message Schema&lt;/Name&gt;&lt;Uniquename&gt;d67f4639-004c-4324-9b4c-41b13c418bbb&lt;/Uniquename&gt;&lt;OnInvalid&gt;&lt;Bindings xmlns:d8p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;bf3f1dbd-c49f-44ad-9845-03cd4864761b&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="RethrowPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d10p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;5a06e2eb-baf2-4fba-b758-0580a3469355&lt;/Id&gt;&lt;Name&gt;Rethrow the Schema Validation Error&lt;/Name&gt;&lt;Uniquename&gt;c0acaf04-d7c5-42bb-a303-40eaf35bae62&lt;/Uniquename&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/OnInvalid&gt;&lt;OnValid&gt;&lt;Bindings xmlns:d8p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;3c714070-7f5d-4859-b469-ba4e815450f5&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="DecisionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d10p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;2c177fc2-6403-4999-977b-733184d8518f&lt;/Id&gt;&lt;Name&gt;Expected Message?&lt;/Name&gt;&lt;Uniquename&gt;92f9acb1-bc36-4d13-91de-2d27103dec71&lt;/Uniquename&gt;&lt;Branches&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="CodeBranchConditionOfESBMessagexAPWb1W4"&gt;&lt;Code&gt;System.Xml.XmlDocument xDoc = context.Data.ToXmlDocument();

string messageType = xDoc.DocumentElement.LocalName;

if (messageType == "LabResultHistorySaveRequest")
	return true;
else
	return false;
&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d13p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d13p1:string&gt;Neuron&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Neuron.Pipelines&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Neuron.Esb&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d13p1:string&gt;&lt;d13p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d13p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Expected Message Type&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d13p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;3d2defa4-c817-4945-9485-875af3d20a09&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="d6p1:JsonXmlProcessStep"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;265847b4-ced4-4100-ac15-ae18c14334cd&lt;/Id&gt;&lt;Name&gt;JsonXmlProcessStep&lt;/Name&gt;&lt;Uniquename&gt;deed57f2-448f-4574-b745-d63704a7a4a5&lt;/Uniquename&gt;&lt;d6p1:ConversionTo&gt;JSON&lt;/d6p1:ConversionTo&gt;&lt;d6p1:DateTimeConvertFormat /&gt;&lt;d6p1:ExcludeXmlRoot&gt;true&lt;/d6p1:ExcludeXmlRoot&gt;&lt;d6p1:IncludeObjectTypes&gt;false&lt;/d6p1:IncludeObjectTypes&gt;&lt;d6p1:IncludeXmlDeclaration&gt;true&lt;/d6p1:IncludeXmlDeclaration&gt;&lt;d6p1:RemoveXmlNamespaces&gt;true&lt;/d6p1:RemoveXmlNamespaces&gt;&lt;d6p1:Root i:nil="true" /&gt;&lt;d6p1:TreatNullHandling&gt;None&lt;/d6p1:TreatNullHandling&gt;&lt;d6p1:TypeName i:nil="true" /&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;86daae24-7159-4d86-ac4f-89d3628d63fc&lt;/Id&gt;&lt;Name&gt;Setup Material Lot Existance&lt;/Name&gt;&lt;Uniquename&gt;5658a2ac-6749-4cc2-94de-020ea6213c25&lt;/Uniquename&gt;&lt;BreakPointLines xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;//TEST SOURCE ID. REMOVE LATER
if (context.Data.Header.SourceId == "")
{
	context.Data.Header.SourceId = "B2MML_ERP_Publisher";
}

Newtonsoft.Json.Linq.JObject inputMessage = context.Data.ToJObject();

var labResultHistory = inputMessage.ToObject &amp;lt;dynamic&amp;gt; ();

context.Instance.TraceInformation("   Create- Update Lab Result History - Message ID: " + context.Data.Header.MessageId.ToString() + " SourceRecordUniqueID: " + labResultHistory.SourceRecordUniqueID);

// Set the Dynamic Local Service Address for the Material Lot Call
context.Data.SetProperty ("NeoPLM", "LocalMessageURL", labResultHistory.LocalServiceURI.ToString() + "/LabResultHistories");
context.Data.SetProperty ("NeoPLM", "TransactionType", labResultHistory.TransactionType.ToString());

context.Instance.TraceInformation ("Address : " + context.Data.GetProperty("NeoPLM", "LocalMessageURL"));

//Save Original Message Context 
if (context.Properties.ContainsKey("CreateUpdateLabResultHistory"))
{
	context.Properties ["CreateUpdateLabResultHistory"] = context.Data.Clone(true);
}
else
{
	context.Properties.Add ("CreateUpdateLabResultHistory", context.Data.Clone(true));
}

// Setup Communication Retry Properties
context.Data.SetProperty ("Neo", "CommSuccess", "false");
context.Data.SetProperty ("Neo", "RetryCount", "0");&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d15p1:string&gt;Neuron&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Pipelines&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Esb&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typea37db829afc4c968cf801137229c84&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="RestPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;5e382fe1-0c33-45c0-b2a7-203cd1eb63bd&lt;/Id&gt;&lt;Name&gt;Rest&lt;/Name&gt;&lt;Uniquename /&gt;&lt;SerializableCurrentRestRequest&gt;&amp;lt;?xml version="1.0" encoding="utf-16"?&amp;gt;&amp;lt;RestRequest xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&amp;gt;&amp;lt;Method&amp;gt;GET&amp;lt;/Method&amp;gt;&amp;lt;URI&amp;gt;{#NeoPLM.LocalMessageURL}/&amp;lt;/URI&amp;gt;&amp;lt;Body /&amp;gt;&amp;lt;BodyType&amp;gt;Raw&amp;lt;/BodyType&amp;gt;&amp;lt;BodyFormat&amp;gt;XML&amp;lt;/BodyFormat&amp;gt;&amp;lt;DeleteMessageBody&amp;gt;true&amp;lt;/DeleteMessageBody&amp;gt;&amp;lt;DeleteResponseBody&amp;gt;false&amp;lt;/DeleteResponseBody&amp;gt;&amp;lt;Parameters&amp;gt;&amp;lt;ParameterDataElement&amp;gt;&amp;lt;Key&amp;gt;sourceRecordUniqueId&amp;lt;/Key&amp;gt;&amp;lt;Value&amp;gt;{#JObject.SourceRecordUniqueID}&amp;lt;/Value&amp;gt;&amp;lt;/ParameterDataElement&amp;gt;&amp;lt;/Parameters&amp;gt;&amp;lt;Headers&amp;gt;&amp;lt;HeaderDataElement&amp;gt;&amp;lt;Key&amp;gt;Accept&amp;lt;/Key&amp;gt;&amp;lt;Value&amp;gt;application/xml&amp;lt;/Value&amp;gt;&amp;lt;/HeaderDataElement&amp;gt;&amp;lt;/Headers&amp;gt;&amp;lt;AdapterEndpointProperties /&amp;gt;&amp;lt;BodyProperties /&amp;gt;&amp;lt;TestEnabled&amp;gt;FALSE&amp;lt;/TestEnabled&amp;gt;&amp;lt;TestFormat&amp;gt;TEXT&amp;lt;/TestFormat&amp;gt;&amp;lt;MaxPoolSize&amp;gt;1&amp;lt;/MaxPoolSize&amp;gt;&amp;lt;PoolTimeOut&amp;gt;1000&amp;lt;/PoolTimeOut&amp;gt;&amp;lt;AuditRequest&amp;gt;false&amp;lt;/AuditRequest&amp;gt;&amp;lt;AuditResponses&amp;gt;false&amp;lt;/AuditResponses&amp;gt;&amp;lt;AuditFailures&amp;gt;false&amp;lt;/AuditFailures&amp;gt;&amp;lt;/RestRequest&amp;gt;&lt;/SerializableCurrentRestRequest&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="WhilePipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;31900931-b7a1-4da2-b942-7503b75abdad&lt;/Id&gt;&lt;Name&gt;While Comm Failed&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="ExceptionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d17p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;23bf33ee-c74a-4f0d-b754-745d1c333e56&lt;/Id&gt;&lt;Name&gt;Exception&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Catch&gt;&lt;Bindings xmlns:d18p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;8f2dc7e0-aaf6-42b4-8c3e-9b3dd52bc78a&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="DecisionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;5f8dac51-bec9-40ad-871c-0d2004a22f71&lt;/Id&gt;&lt;Name&gt;Retry Count&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Branches&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="CodeBranchConditionOfESBMessagexAPWb1W4"&gt;&lt;Code&gt;int count = System.Convert.ToInt32 (context.Data.GetProperty ("Neo", "RetryCount"));
int numRetries = System.Convert.ToInt32 (context.EnvironmentVariables["NeoServicesNumberofRetries"]);

if (count &amp;lt; numRetries)
{	
	// Increment counter
	count = count + 1;
	context.Data.SetProperty ("Neo", "RetryCount", count.ToString());
	context.Instance.TraceInformation ("Communication Failed.  Start of Retry Cycle " + count);
	
	return true;
}
else
{
	context.Instance.TraceInformation ("Communication Failed.  Retries Exhausted.  Rethrow Exception");
	return false;
}&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d23p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d23p1:string&gt;Neuron&lt;/d23p1:string&gt;&lt;d23p1:string&gt;Neuron.Pipelines&lt;/d23p1:string&gt;&lt;d23p1:string&gt;Neuron.Esb&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d23p1:string&gt;&lt;d23p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d23p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;If&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d23p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;dfcff5ed-5d2b-407d-a014-6670131049dc&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d25p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;e2aec37e-b624-4c95-ae98-b484777e659d&lt;/Id&gt;&lt;Name&gt;Wait Time and Retry&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d25p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;int timeoutValue = System.Convert.ToInt32 (context.EnvironmentVariables["NeoServicesRetryInterval"]) * 1000;

System.Threading.Thread.Sleep (timeoutValue);

context.Instance.TraceInformation ("Communications Failure with Neo PLM.  Retrying....");&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d25p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d25p1:string&gt;Neuron&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Neuron.Pipelines&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Neuron.Esb&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d25p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typecde6b061d0f411596a785fde1d8e73&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="AlwaysBranchConditionOfESBMessagexAPWb1W4" /&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Else&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d23p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;67b1eec5-54eb-4d61-93e4-b65501e16b28&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="RethrowPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d25p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;b1d36fb1-8b94-466c-aeee-a4f89e9dafb0&lt;/Id&gt;&lt;Name&gt;Rethrow&lt;/Name&gt;&lt;Uniquename /&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;/Branches&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Catch&gt;&lt;Finally&gt;&lt;Bindings xmlns:d18p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;c04bf065-81fc-42cf-82e5-87cd1520d050&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children /&gt;&lt;/Finally&gt;&lt;Try&gt;&lt;Bindings xmlns:d18p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;b752aca4-045d-4d9f-895b-a8d291243031&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageServiceEndpointPipelineStep"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;2fb934dd-0609-4546-b1bd-f17c89b27cf5&lt;/Id&gt;&lt;Name&gt;ServiceEndpoint&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d6p1:Category&gt;General&lt;/d6p1:Category&gt;&lt;d6p1:Description&gt;This service serves as a proxy for the external service that is provided by Neo PLM, Inc.  It is here for ease of configuration only.  Nothing is ever processed by this item.&lt;/d6p1:Description&gt;&lt;d6p1:MaxServiceInstances&gt;100&lt;/d6p1:MaxServiceInstances&gt;&lt;d6p1:MessagePattern&gt;Request-Reply&lt;/d6p1:MessagePattern&gt;&lt;d6p1:Policy /&gt;&lt;d6p1:ServiceBinding&gt;REST&lt;/d6p1:ServiceBinding&gt;&lt;d6p1:ServiceConnector&gt;NeoPLM Local Integration Service - Rest Transaction Proxy&lt;/d6p1:ServiceConnector&gt;&lt;d6p1:ServiceId&gt;afd7e3f1-61d8-432b-aa89-f6df498f1d2a&lt;/d6p1:ServiceId&gt;&lt;d6p1:ServicePoolTimeout&gt;PT1M&lt;/d6p1:ServicePoolTimeout&gt;&lt;d6p1:ServiceUrl&gt;https://BogusServer/&lt;/d6p1:ServiceUrl&gt;&lt;d6p1:ThrowExceptionOnFault&gt;true&lt;/d6p1:ThrowExceptionOnFault&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;15c9a204-5722-48d0-a524-e524015469de&lt;/Id&gt;&lt;Name&gt;Set Comm Successful&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d20p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Set Communication Success
context.Data.SetProperty ("Neo", "CommSuccess", "true");

context.Instance.TraceInformation ("Communication Success.");
&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d20p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d20p1:string&gt;Neuron&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Neuron.Pipelines&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Neuron.Esb&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d20p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typed86a6fa43014865a8da4028bd205e3&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Try&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;Condition&gt;&lt;Code&gt;//if (context.Data.GetProperty("Neo", "CommSuccess") == "false")
//	return true;
//else
//	return false;
return context.Data.GetProperty("Neo", "CommSuccess") != "true";&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d16p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d16p1:string&gt;Neuron&lt;/d16p1:string&gt;&lt;d16p1:string&gt;Neuron.Pipelines&lt;/d16p1:string&gt;&lt;d16p1:string&gt;Neuron.Esb&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d16p1:string&gt;&lt;d16p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d16p1:string&gt;&lt;d16p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d16p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;TurnOffTrackExecution&gt;false&lt;/TurnOffTrackExecution&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;65a1e083-a44b-4910-82d6-3352fa6d9c17&lt;/Id&gt;&lt;Name&gt;Process Response&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Raw response message is in xml format
System.Xml.XmlDocument xDoc = context.Data.ToXmlDocument();
System.Guid newGuid;

// Parse it and if if it is a guid, then proceed, if not then proceed, otherwise throw a system exception.
if (System.Guid.TryParse(xDoc.DocumentElement.FirstChild.InnerText, out newGuid)  == false)
	{
		throw new System.Exception ("The Lab Result History Lookup service returned a value that was not a GUID.");		
	}
	
// Restore Input Message	
context.Data = (ESBMessage) context.Properties["CreateUpdateLabResultHistory"];	
	
context.Instance.TraceInformation ("Create / Update Lab Result History - Message ID: " + context.Data.Header.MessageId.ToString() + " LabResultHistoryUID: " + newGuid.ToString());
	
context.Data.SetProperty ("NeoPLM", "UID", newGuid.ToString());	
	
if (newGuid == System.Guid.Empty)	
	{
		// Create a new Guid
		string uid = System.Guid.NewGuid().ToString();	
	
		// Set a message property to control the optional message routing, based on data in the input message.	
		context.Data.SetProperty ("NeoPLM", "LabResultHistoryUID", uid.ToString());
	}
else
	{
		context.Data.SetProperty ("NeoPLM", "LabResultHistoryUID", newGuid.ToString());
	}	
	
	&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d15p1:string&gt;Neuron&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Pipelines&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Esb&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d15p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type148ba6628ad4c3595aececf57736a0&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="PushContextPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;04f117be-12d2-444f-8222-4207a6e00d41&lt;/Id&gt;&lt;Name&gt;PushContext&lt;/Name&gt;&lt;Uniquename /&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="DecisionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;e36219a9-fd4c-4832-b6b2-0020fc8b497d&lt;/Id&gt;&lt;Name&gt;Disposition Response Message&lt;/Name&gt;&lt;Uniquename&gt;0938be3e-f88f-4298-9984-ac5dfb16fcb1&lt;/Uniquename&gt;&lt;Branches&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="CodeBranchConditionOfESBMessagexAPWb1W4"&gt;&lt;Code&gt;if (context.Data.GetProperty("NeoPLM", "UID") == System.Guid.Empty.ToString())
{	
	return true;
}
else
{
	return false;
}&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d18p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d18p1:string&gt;Neuron&lt;/d18p1:string&gt;&lt;d18p1:string&gt;Neuron.Pipelines&lt;/d18p1:string&gt;&lt;d18p1:string&gt;Neuron.Esb&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d18p1:string&gt;&lt;d18p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d18p1:string&gt;&lt;d18p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d18p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Create Lab Result History&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d18p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;8529c67b-4a28-4648-a80a-df6e0a7be713&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="DecisionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;9691777b-0eb3-4d5f-9bec-1551e5cf9426&lt;/Id&gt;&lt;Name&gt;Decision&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Branches&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="CodeBranchConditionOfESBMessagexAPWb1W4"&gt;&lt;Code&gt;if (context.Data.GetProperty("NeoPLM", "TransactionType").ToUpper() == "UPDATE")
	return false;
else
	return true;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d23p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d23p1:string&gt;Neuron&lt;/d23p1:string&gt;&lt;d23p1:string&gt;Neuron.Pipelines&lt;/d23p1:string&gt;&lt;d23p1:string&gt;Neuron.Esb&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d23p1:string&gt;&lt;d23p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d23p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;If&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d23p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;15ef25e4-e52d-4195-a436-13de8adf35bc&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d25p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;c1f78724-9f00-4351-be72-845d5ca3f278&lt;/Id&gt;&lt;Name&gt;Map to Create LabResultHistory&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d25p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;context.Instance.TraceInformation ("Creating a Lab Result History");

// Create a new Guid
string uid = context.Data.GetProperty ("NeoPLM", "LabResultHistoryUID");

// Make a dynamic object out of the original message
Newtonsoft.Json.Linq.JObject inputMessage = context.Data.ToJObject();
var labResultHistoryRequest = inputMessage.ToObject &amp;lt;dynamic&amp;gt; ();

// Retrieve the response template message
string labResultHistoryResponseTemplate = context.Configuration.JsonDocs ["Create-Update Lab Result History"].JsonFormatString;

// Create the response messaged
string labResultHistoryResponse = string.Format(labResultHistoryResponseTemplate, uid, labResultHistoryRequest.LabTestHistoryUID.ToString(), 
	                                            labResultHistoryRequest.SourceRecordUniqueID.ToString(), labResultHistoryRequest.TestResultID.ToString(), 
	                                            labResultHistoryRequest.TestResultDescription.ToString(), labResultHistoryRequest.TestResultStatus.ToString(), 
	                                            labResultHistoryRequest.EnteredResult.ToString(), labResultHistoryRequest.DisplayResult.ToString(), 
	                                            labResultHistoryRequest.TestResultEngineeringLabel.ToString(), labResultHistoryRequest.ExpectedResult.ToString(), 
	                                            labResultHistoryRequest.TestResultInstanceNumber.ToString(), labResultHistoryRequest.IsFinalResult.ToString(), 
	                                            labResultHistoryRequest.ResultDataTimeUTC.ToString("yyyy-MM-ddTHH:mm:ssZ"), labResultHistoryRequest.AdditionalData.ToString());

//Send the trace message to document the response message.
context.Instance.TraceInformation ("   Create / Update Lab Result History - Message ID: " + context.Data.Header.MessageId.ToString() + " Response Message: " + labResultHistoryResponse);
	
// Set message context to the response message 	
context.Data.Text = labResultHistoryResponse;

// Setup Communication Retry Properties
context.Data.SetProperty ("Neo", "CommSuccess", "false");
context.Data.SetProperty ("Neo", "RetryCount", "0");
&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d25p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d25p1:string&gt;Neuron&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Neuron.Pipelines&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Neuron.Esb&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d25p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type7e9fd736d2a4f649ddd739ebe4f114&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="RestPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d25p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;ab13a12c-184f-49de-93af-72f5a95c2118&lt;/Id&gt;&lt;Name&gt;Rest&lt;/Name&gt;&lt;Uniquename /&gt;&lt;SerializableCurrentRestRequest&gt;&amp;lt;?xml version="1.0" encoding="utf-16"?&amp;gt;&amp;lt;RestRequest xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&amp;gt;&amp;lt;Method&amp;gt;POST&amp;lt;/Method&amp;gt;&amp;lt;URI&amp;gt;{#NeoPLM.LocalMessageURL}&amp;lt;/URI&amp;gt;&amp;lt;Body /&amp;gt;&amp;lt;BodyType&amp;gt;Raw&amp;lt;/BodyType&amp;gt;&amp;lt;BodyFormat&amp;gt;XML&amp;lt;/BodyFormat&amp;gt;&amp;lt;DeleteMessageBody&amp;gt;false&amp;lt;/DeleteMessageBody&amp;gt;&amp;lt;DeleteResponseBody&amp;gt;false&amp;lt;/DeleteResponseBody&amp;gt;&amp;lt;Parameters /&amp;gt;&amp;lt;Headers&amp;gt;&amp;lt;HeaderDataElement&amp;gt;&amp;lt;Key&amp;gt;Content-Type&amp;lt;/Key&amp;gt;&amp;lt;Value&amp;gt;application/json&amp;lt;/Value&amp;gt;&amp;lt;/HeaderDataElement&amp;gt;&amp;lt;/Headers&amp;gt;&amp;lt;AdapterEndpointProperties /&amp;gt;&amp;lt;BodyProperties /&amp;gt;&amp;lt;TestEnabled&amp;gt;FALSE&amp;lt;/TestEnabled&amp;gt;&amp;lt;TestFormat&amp;gt;TEXT&amp;lt;/TestFormat&amp;gt;&amp;lt;MaxPoolSize&amp;gt;1&amp;lt;/MaxPoolSize&amp;gt;&amp;lt;PoolTimeOut&amp;gt;1000&amp;lt;/PoolTimeOut&amp;gt;&amp;lt;AuditRequest&amp;gt;false&amp;lt;/AuditRequest&amp;gt;&amp;lt;AuditResponses&amp;gt;false&amp;lt;/AuditResponses&amp;gt;&amp;lt;AuditFailures&amp;gt;false&amp;lt;/AuditFailures&amp;gt;&amp;lt;/RestRequest&amp;gt;&lt;/SerializableCurrentRestRequest&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="WhilePipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d25p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;25f09294-5545-482f-93be-376fc7eb049c&lt;/Id&gt;&lt;Name&gt;While Comm Failed&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="ExceptionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d27p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;1eabdf8c-f3df-4b82-af83-a2f061e01d82&lt;/Id&gt;&lt;Name&gt;Exception&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Catch&gt;&lt;Bindings xmlns:d28p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;ae265852-c3e7-4c4e-b540-fbf09b8811f4&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="DecisionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d30p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;8b2c2dd3-200b-4926-ae3f-9788c9a6223d&lt;/Id&gt;&lt;Name&gt;Retry Count&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Branches&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="CodeBranchConditionOfESBMessagexAPWb1W4"&gt;&lt;Code&gt;int count = System.Convert.ToInt32 (context.Data.GetProperty ("Neo", "RetryCount"));
int numRetries = System.Convert.ToInt32 (context.EnvironmentVariables["NeoServicesNumberofRetries"]);

if (count &amp;lt; numRetries)
{	
	// Increment counter
	count = count + 1;
	context.Data.SetProperty ("Neo", "RetryCount", count.ToString());
	context.Instance.TraceInformation ("Communication Failed.  Start of Retry Cycle " + count);
	
	return true;
}
else
{
	context.Instance.TraceInformation ("Communication Failed.  Retries Exhausted.  Rethrow Exception");
	return false;
}&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d33p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d33p1:string&gt;Neuron&lt;/d33p1:string&gt;&lt;d33p1:string&gt;Neuron.Pipelines&lt;/d33p1:string&gt;&lt;d33p1:string&gt;Neuron.Esb&lt;/d33p1:string&gt;&lt;d33p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d33p1:string&gt;&lt;d33p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d33p1:string&gt;&lt;d33p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d33p1:string&gt;&lt;d33p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d33p1:string&gt;&lt;d33p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d33p1:string&gt;&lt;d33p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d33p1:string&gt;&lt;d33p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d33p1:string&gt;&lt;d33p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d33p1:string&gt;&lt;d33p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d33p1:string&gt;&lt;d33p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d33p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;If&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d33p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;a6431fc4-27ba-4d8d-acf3-f46e63d25a6d&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d35p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;87899f14-0e35-4a87-a84d-721cf76fe3c0&lt;/Id&gt;&lt;Name&gt;Wait Time and Retry&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d35p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;int timeoutValue = System.Convert.ToInt32 (context.EnvironmentVariables["NeoServicesRetryInterval"]) * 1000;

System.Threading.Thread.Sleep (timeoutValue);

context.Instance.TraceInformation ("Communications Failure with Neo PLM.  Retrying....");&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d35p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d35p1:string&gt;Neuron&lt;/d35p1:string&gt;&lt;d35p1:string&gt;Neuron.Pipelines&lt;/d35p1:string&gt;&lt;d35p1:string&gt;Neuron.Esb&lt;/d35p1:string&gt;&lt;d35p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d35p1:string&gt;&lt;d35p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d35p1:string&gt;&lt;d35p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d35p1:string&gt;&lt;d35p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d35p1:string&gt;&lt;d35p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d35p1:string&gt;&lt;d35p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d35p1:string&gt;&lt;d35p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d35p1:string&gt;&lt;d35p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d35p1:string&gt;&lt;d35p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d35p1:string&gt;&lt;d35p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d35p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typecde6b061d0f411596a785fde1d8e73&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="AlwaysBranchConditionOfESBMessagexAPWb1W4" /&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Else&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d33p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;ad4694af-e38f-4c2f-a220-f10e42f2e723&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="RethrowPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d35p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;7b2b7551-1354-43b8-b972-e41e6c3ba077&lt;/Id&gt;&lt;Name&gt;Rethrow&lt;/Name&gt;&lt;Uniquename /&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;/Branches&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Catch&gt;&lt;Finally&gt;&lt;Bindings xmlns:d28p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;ff862a4d-ba93-4fd7-a52a-cbecdf144108&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children /&gt;&lt;/Finally&gt;&lt;Try&gt;&lt;Bindings xmlns:d28p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;a0536a9b-d98c-4760-89a0-dc31240e1454&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageServiceEndpointPipelineStep"&gt;&lt;Bindings xmlns:d30p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;80874816-448a-40ef-8d00-4203f68237a6&lt;/Id&gt;&lt;Name&gt;Create Lab Result History&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d6p1:Category&gt;General&lt;/d6p1:Category&gt;&lt;d6p1:Description&gt;This service serves as a proxy for the external service that is provided by Neo PLM, Inc.  It is here for ease of configuration only.  Nothing is ever processed by this item.&lt;/d6p1:Description&gt;&lt;d6p1:MaxServiceInstances&gt;100&lt;/d6p1:MaxServiceInstances&gt;&lt;d6p1:MessagePattern&gt;Request-Reply&lt;/d6p1:MessagePattern&gt;&lt;d6p1:Policy /&gt;&lt;d6p1:ServiceBinding&gt;REST&lt;/d6p1:ServiceBinding&gt;&lt;d6p1:ServiceConnector&gt;NeoPLM Local Integration Service - Rest Transaction Proxy&lt;/d6p1:ServiceConnector&gt;&lt;d6p1:ServiceId&gt;afd7e3f1-61d8-432b-aa89-f6df498f1d2a&lt;/d6p1:ServiceId&gt;&lt;d6p1:ServicePoolTimeout&gt;PT1M&lt;/d6p1:ServicePoolTimeout&gt;&lt;d6p1:ServiceUrl&gt;https://BogusServer/&lt;/d6p1:ServiceUrl&gt;&lt;d6p1:ThrowExceptionOnFault&gt;true&lt;/d6p1:ThrowExceptionOnFault&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d30p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;d2ceecf4-5eea-4403-b152-639ec0407ff2&lt;/Id&gt;&lt;Name&gt;Set Comm Successful&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d30p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Set Communication Success
context.Data.SetProperty ("Neo", "CommSuccess", "true");

context.Instance.TraceInformation ("Communication Success.");
&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d30p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d30p1:string&gt;Neuron&lt;/d30p1:string&gt;&lt;d30p1:string&gt;Neuron.Pipelines&lt;/d30p1:string&gt;&lt;d30p1:string&gt;Neuron.Esb&lt;/d30p1:string&gt;&lt;d30p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d30p1:string&gt;&lt;d30p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d30p1:string&gt;&lt;d30p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d30p1:string&gt;&lt;d30p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d30p1:string&gt;&lt;d30p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d30p1:string&gt;&lt;d30p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d30p1:string&gt;&lt;d30p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d30p1:string&gt;&lt;d30p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d30p1:string&gt;&lt;d30p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d30p1:string&gt;&lt;d30p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d30p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typed86a6fa43014865a8da4028bd205e3&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Try&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;Condition&gt;&lt;Code&gt;//if (context.Data.GetProperty("Neo", "CommSuccess") == "false")
//	return true;
//else
//	return false;
return context.Data.GetProperty("Neo", "CommSuccess") != "true";&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d26p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d26p1:string&gt;Neuron&lt;/d26p1:string&gt;&lt;d26p1:string&gt;Neuron.Pipelines&lt;/d26p1:string&gt;&lt;d26p1:string&gt;Neuron.Esb&lt;/d26p1:string&gt;&lt;d26p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d26p1:string&gt;&lt;d26p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d26p1:string&gt;&lt;d26p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d26p1:string&gt;&lt;d26p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d26p1:string&gt;&lt;d26p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d26p1:string&gt;&lt;d26p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d26p1:string&gt;&lt;d26p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d26p1:string&gt;&lt;d26p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d26p1:string&gt;&lt;d26p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d26p1:string&gt;&lt;d26p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d26p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;TurnOffTrackExecution&gt;false&lt;/TurnOffTrackExecution&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="AlwaysBranchConditionOfESBMessagexAPWb1W4" /&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Else&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d23p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;dfa55250-7521-4524-9a64-0ff7bcb14791&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d25p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;45693a34-b2b8-4b92-9746-3086bd7bc990&lt;/Id&gt;&lt;Name&gt;Log Message&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d25p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;context.Instance.TraceInformation ("Cannot Create a New Lab Result History in message below. Allowed Transactions do not allow creation.  \n\n " + context.Data.Text);&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d25p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d25p1:string&gt;Neuron&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Neuron.Pipelines&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Neuron.Esb&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d25p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typeddb9bd045e046c29ac07c43731cf69&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;/Branches&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="AlwaysBranchConditionOfESBMessagexAPWb1W4" /&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Update Lab Result History&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d18p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;7cb20244-0212-4c85-aef4-a5849f56d25f&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="DecisionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;86d10bc7-71da-47ef-a36d-fcd1a2ea2e41&lt;/Id&gt;&lt;Name&gt;Decision&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Branches&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="CodeBranchConditionOfESBMessagexAPWb1W4"&gt;&lt;Code&gt;//if (context.Data.GetProperty("NeoPLM", "TransactionType").ToUpper() == "CREATE")
//	return false;
//else
	return true;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d23p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d23p1:string&gt;Neuron&lt;/d23p1:string&gt;&lt;d23p1:string&gt;Neuron.Pipelines&lt;/d23p1:string&gt;&lt;d23p1:string&gt;Neuron.Esb&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d23p1:string&gt;&lt;d23p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d23p1:string&gt;&lt;d23p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d23p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;If&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d23p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;011c9a5d-8268-4f4f-8584-72f18773e47c&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d25p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;9b2fc214-4803-4cbf-b03f-bdbeb289b8f4&lt;/Id&gt;&lt;Name&gt;Map To Update Lab Result History&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d25p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;context.Instance.TraceInformation ("Updating a Lab Result History");

// Create a new Guid
string uid = context.Data.GetProperty ("NeoPLM", "LabResultHistoryUID");

// Make a dynamic object out of the original message
Newtonsoft.Json.Linq.JObject inputMessage = context.Data.ToJObject();
var labResultHistoryRequest = inputMessage.ToObject &amp;lt;dynamic&amp;gt; ();

// Retrieve the response template message
string labResultHistoryResponseTemplate = context.Configuration.JsonDocs ["Create-Update Lab Result History"].JsonFormatString;

// Create the response messaged
string labResultHistoryResponse = string.Format(labResultHistoryResponseTemplate, uid, labResultHistoryRequest.LabTestHistoryUID.ToString(), 
	                                            labResultHistoryRequest.SourceRecordUniqueID.ToString(), labResultHistoryRequest.TestResultID.ToString(), 
	                                            labResultHistoryRequest.TestResultDescription.ToString(), labResultHistoryRequest.TestResultStatus.ToString(), 
	                                            labResultHistoryRequest.EnteredResult.ToString(), labResultHistoryRequest.DisplayResult.ToString(), 
	                                            labResultHistoryRequest.TestResultEngineeringLabel.ToString(), labResultHistoryRequest.ExpectedResult.ToString(), 
	                                            labResultHistoryRequest.TestResultInstanceNumber.ToString(), labResultHistoryRequest.IsFinalResult.ToString(), 
	                                            labResultHistoryRequest.ResultDataTimeUTC.ToString("yyyy-MM-ddTHH:mm:ssZ"), labResultHistoryRequest.AdditionalData.ToString());

//Send the trace message to document the response message.
context.Instance.TraceInformation ("   Create / Update Lab Result History - Message ID: " + context.Data.Header.MessageId.ToString() + " Response Message: " + labResultHistoryResponse);
	
// Set message context to the response message 	
context.Data.Text = labResultHistoryResponse;

// Append the material lot uid to the local URL to comply with Web API 
context.Data.SetProperty("NeoPLM", "LocalMessageURL", context.Data.GetProperty ("NeoPLM", "LocalMessageURL")  + "/" +  context.Data.LocalPath + context.Data.GetProperty("NeoPLM", "LabResultHistoryUID"));

context.Instance.TraceInformation (context.Data.LocalPath);

// Setup Communication Retry Properties
context.Data.SetProperty ("Neo", "CommSuccess", "false");
context.Data.SetProperty ("Neo", "RetryCount", "0");&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d25p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d25p1:string&gt;Neuron&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Neuron.Pipelines&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Neuron.Esb&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d25p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typef1069678fc84e158097c41c1a61f40&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="RestPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d25p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;068f7944-39fb-49b2-90ef-94213180c7a7&lt;/Id&gt;&lt;Name&gt;Rest&lt;/Name&gt;&lt;Uniquename /&gt;&lt;SerializableCurrentRestRequest&gt;&amp;lt;?xml version="1.0" encoding="utf-16"?&amp;gt;&amp;lt;RestRequest xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&amp;gt;&amp;lt;Method&amp;gt;PUT&amp;lt;/Method&amp;gt;&amp;lt;URI&amp;gt;{#NeoPLM.LocalMessageURL}&amp;lt;/URI&amp;gt;&amp;lt;Body /&amp;gt;&amp;lt;BodyType&amp;gt;Raw&amp;lt;/BodyType&amp;gt;&amp;lt;BodyFormat&amp;gt;XML&amp;lt;/BodyFormat&amp;gt;&amp;lt;DeleteMessageBody&amp;gt;false&amp;lt;/DeleteMessageBody&amp;gt;&amp;lt;DeleteResponseBody&amp;gt;false&amp;lt;/DeleteResponseBody&amp;gt;&amp;lt;Parameters /&amp;gt;&amp;lt;Headers&amp;gt;&amp;lt;HeaderDataElement&amp;gt;&amp;lt;Key&amp;gt;Content-Type&amp;lt;/Key&amp;gt;&amp;lt;Value&amp;gt;application/json&amp;lt;/Value&amp;gt;&amp;lt;/HeaderDataElement&amp;gt;&amp;lt;/Headers&amp;gt;&amp;lt;AdapterEndpointProperties /&amp;gt;&amp;lt;BodyProperties /&amp;gt;&amp;lt;TestEnabled&amp;gt;FALSE&amp;lt;/TestEnabled&amp;gt;&amp;lt;TestFormat&amp;gt;TEXT&amp;lt;/TestFormat&amp;gt;&amp;lt;MaxPoolSize&amp;gt;1&amp;lt;/MaxPoolSize&amp;gt;&amp;lt;PoolTimeOut&amp;gt;1000&amp;lt;/PoolTimeOut&amp;gt;&amp;lt;AuditRequest&amp;gt;false&amp;lt;/AuditRequest&amp;gt;&amp;lt;AuditResponses&amp;gt;false&amp;lt;/AuditResponses&amp;gt;&amp;lt;AuditFailures&amp;gt;false&amp;lt;/AuditFailures&amp;gt;&amp;lt;/RestRequest&amp;gt;&lt;/SerializableCurrentRestRequest&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="WhilePipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d25p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;e9bc237b-b546-40dd-a3fc-6f9d13d0082d&lt;/Id&gt;&lt;Name&gt;While Comm Failed&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="ExceptionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d27p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;1b18ab15-8931-4743-9351-cae55db0a7f5&lt;/Id&gt;&lt;Name&gt;Exception&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Catch&gt;&lt;Bindings xmlns:d28p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;b3422633-49e6-4b28-ba78-432cbf1e7b20&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="DecisionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d30p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;d05243c3-c867-4b13-b8d9-b52e16fe5741&lt;/Id&gt;&lt;Name&gt;Retry Count&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Branches&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="CodeBranchConditionOfESBMessagexAPWb1W4"&gt;&lt;Code&gt;int count = System.Convert.ToInt32 (context.Data.GetProperty ("Neo", "RetryCount"));
int numRetries = System.Convert.ToInt32 (context.EnvironmentVariables["NeoServicesNumberofRetries"]);

if (count &amp;lt; numRetries)
{	
	// Increment counter
	count = count + 1;
	context.Data.SetProperty ("Neo", "RetryCount", count.ToString());
	context.Instance.TraceInformation ("Communication Failed.  Start of Retry Cycle " + count);
	
	return true;
}
else
{
	context.Instance.TraceInformation ("Communication Failed.  Retries Exhausted.  Rethrow Exception");
	return false;
}&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d33p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d33p1:string&gt;Neuron&lt;/d33p1:string&gt;&lt;d33p1:string&gt;Neuron.Pipelines&lt;/d33p1:string&gt;&lt;d33p1:string&gt;Neuron.Esb&lt;/d33p1:string&gt;&lt;d33p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d33p1:string&gt;&lt;d33p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d33p1:string&gt;&lt;d33p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d33p1:string&gt;&lt;d33p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d33p1:string&gt;&lt;d33p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d33p1:string&gt;&lt;d33p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d33p1:string&gt;&lt;d33p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d33p1:string&gt;&lt;d33p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d33p1:string&gt;&lt;d33p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d33p1:string&gt;&lt;d33p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d33p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;If&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d33p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;896336f3-e7f7-4fa7-ad65-7793b25d2f42&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d35p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;7aae83fa-acc0-49a2-b3a5-2fc8575881f0&lt;/Id&gt;&lt;Name&gt;Wait Time and Retry&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d35p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;int timeoutValue = System.Convert.ToInt32 (context.EnvironmentVariables["NeoServicesRetryInterval"]) * 1000;

System.Threading.Thread.Sleep (timeoutValue);

context.Instance.TraceInformation ("Communications Failure with Neo PLM.  Retrying....");&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d35p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d35p1:string&gt;Neuron&lt;/d35p1:string&gt;&lt;d35p1:string&gt;Neuron.Pipelines&lt;/d35p1:string&gt;&lt;d35p1:string&gt;Neuron.Esb&lt;/d35p1:string&gt;&lt;d35p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d35p1:string&gt;&lt;d35p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d35p1:string&gt;&lt;d35p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d35p1:string&gt;&lt;d35p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d35p1:string&gt;&lt;d35p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d35p1:string&gt;&lt;d35p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d35p1:string&gt;&lt;d35p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d35p1:string&gt;&lt;d35p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d35p1:string&gt;&lt;d35p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d35p1:string&gt;&lt;d35p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d35p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typecde6b061d0f411596a785fde1d8e73&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="AlwaysBranchConditionOfESBMessagexAPWb1W4" /&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Else&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d33p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;1486216c-3efb-41f8-9d0d-3624e1e8bbbe&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="RethrowPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d35p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;d4fd6412-67b5-4b1e-bdfb-1b56619a4782&lt;/Id&gt;&lt;Name&gt;Rethrow&lt;/Name&gt;&lt;Uniquename /&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;/Branches&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Catch&gt;&lt;Finally&gt;&lt;Bindings xmlns:d28p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;e0406677-4452-458b-8bb1-8e9958d2ef20&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children /&gt;&lt;/Finally&gt;&lt;Try&gt;&lt;Bindings xmlns:d28p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;9b1d0cc6-0637-4c89-b3b4-a58e63c74808&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageServiceEndpointPipelineStep"&gt;&lt;Bindings xmlns:d30p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;da2b315c-8baf-451f-8e4e-d11e8cbde56f&lt;/Id&gt;&lt;Name&gt;Update Lab Result History&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d6p1:Category&gt;General&lt;/d6p1:Category&gt;&lt;d6p1:Description&gt;This service serves as a proxy for the external service that is provided by Neo PLM, Inc.  It is here for ease of configuration only.  Nothing is ever processed by this item.&lt;/d6p1:Description&gt;&lt;d6p1:MaxServiceInstances&gt;100&lt;/d6p1:MaxServiceInstances&gt;&lt;d6p1:MessagePattern&gt;Request-Reply&lt;/d6p1:MessagePattern&gt;&lt;d6p1:Policy /&gt;&lt;d6p1:ServiceBinding&gt;REST&lt;/d6p1:ServiceBinding&gt;&lt;d6p1:ServiceConnector&gt;NeoPLM Local Integration Service - Rest Transaction Proxy&lt;/d6p1:ServiceConnector&gt;&lt;d6p1:ServiceId&gt;afd7e3f1-61d8-432b-aa89-f6df498f1d2a&lt;/d6p1:ServiceId&gt;&lt;d6p1:ServicePoolTimeout&gt;PT1M&lt;/d6p1:ServicePoolTimeout&gt;&lt;d6p1:ServiceUrl&gt;https://BogusServer/&lt;/d6p1:ServiceUrl&gt;&lt;d6p1:ThrowExceptionOnFault&gt;true&lt;/d6p1:ThrowExceptionOnFault&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d30p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;2fcea45a-13e3-493b-b16f-4feaa2f487c2&lt;/Id&gt;&lt;Name&gt;Set Comm Successful&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d30p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Set Communication Success
context.Data.SetProperty ("Neo", "CommSuccess", "true");

context.Instance.TraceInformation ("Communication Success.");
&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d30p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d30p1:string&gt;Neuron&lt;/d30p1:string&gt;&lt;d30p1:string&gt;Neuron.Pipelines&lt;/d30p1:string&gt;&lt;d30p1:string&gt;Neuron.Esb&lt;/d30p1:string&gt;&lt;d30p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d30p1:string&gt;&lt;d30p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d30p1:string&gt;&lt;d30p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d30p1:string&gt;&lt;d30p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d30p1:string&gt;&lt;d30p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d30p1:string&gt;&lt;d30p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d30p1:string&gt;&lt;d30p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d30p1:string&gt;&lt;d30p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d30p1:string&gt;&lt;d30p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d30p1:string&gt;&lt;d30p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d30p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typed86a6fa43014865a8da4028bd205e3&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Try&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;Condition&gt;&lt;Code&gt;//if (context.Data.GetProperty("Neo", "CommSuccess") == "false")
//	return true;
//else
//	return false;
return context.Data.GetProperty("Neo", "CommSuccess") != "true";&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d26p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d26p1:string&gt;Neuron&lt;/d26p1:string&gt;&lt;d26p1:string&gt;Neuron.Pipelines&lt;/d26p1:string&gt;&lt;d26p1:string&gt;Neuron.Esb&lt;/d26p1:string&gt;&lt;d26p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d26p1:string&gt;&lt;d26p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d26p1:string&gt;&lt;d26p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d26p1:string&gt;&lt;d26p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d26p1:string&gt;&lt;d26p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d26p1:string&gt;&lt;d26p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d26p1:string&gt;&lt;d26p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d26p1:string&gt;&lt;d26p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d26p1:string&gt;&lt;d26p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d26p1:string&gt;&lt;d26p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d26p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;TurnOffTrackExecution&gt;false&lt;/TurnOffTrackExecution&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="AlwaysBranchConditionOfESBMessagexAPWb1W4" /&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Else&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d23p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;59a9107e-2a54-47b5-80aa-504f264c9c84&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d25p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;c6210e74-5f09-4676-81c3-45d744c9c946&lt;/Id&gt;&lt;Name&gt;Log Message&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d25p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;context.Instance.TraceInformation ("Cannot Update the Lab Result History in message below. Allowed Transactions do not allow update.  \n\n " + context.Data.Text);&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d25p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d25p1:string&gt;Neuron&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Neuron.Pipelines&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Neuron.Esb&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d25p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typed5e23e9f6b945a1a804e5a13a78c5f&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;/Branches&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;/Branches&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="AlwaysBranchConditionOfESBMessagexAPWb1W4" /&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Else&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d13p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;373a2f6e-5cf5-4468-9357-f68f00d30a44&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;1a180946-e881-4d4b-9326-08d31df7f395&lt;/Id&gt;&lt;Name&gt;Invalid Message - Throw Exception&lt;/Name&gt;&lt;Uniquename&gt;1d410ffd-c6b4-4871-9313-b1a12c9d4e91&lt;/Uniquename&gt;&lt;BreakPointLines xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;System.Xml.Schema.XmlSchemaException xMlex= new System.Xml.Schema.XmlSchemaException("   Create / Update Lab Result History - Message ID: " + context.Data.Header.MessageId.ToString() + " - message received did not match expected type of LabResultHistorySaveRequest \n\n.  Message = " + context.Data.Text);

throw xMlex;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d15p1:string&gt;Neuron&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Pipelines&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Esb&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d15p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typefe031f105404189bcaba2e2f628f34&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;/Branches&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/OnValid&gt;&lt;Properties xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Schemas xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;ValidationFlags&gt;ReportValidationWarnings&lt;/ValidationFlags&gt;&lt;d6p1:SchemaLocation i:nil="true" /&gt;&lt;d6p1:SchemaNames&gt;EnterpriseHelper;Guid&lt;/d6p1:SchemaNames&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="PopContextPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;0da8bd87-f2aa-4faa-a403-14bcdde465f6&lt;/Id&gt;&lt;Name&gt;PopContext&lt;/Name&gt;&lt;Uniquename /&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageTraceMessagePipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;940b9159-44d6-4a2e-9c8a-43efd1bb0e58&lt;/Id&gt;&lt;Name&gt;TraceMessage&lt;/Name&gt;&lt;Uniquename /&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Try&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="PushContextPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d4p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;6ed82f22-76de-4617-bab5-2664c35207a8&lt;/Id&gt;&lt;Name&gt;PushContext&lt;/Name&gt;&lt;Uniquename /&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Steps&gt;&lt;/ESBMessagePipeline&gt;</PipelineBlob>
  <IsProcessFlow>false</IsProcessFlow>
</ESBMessagePipelineStorage>